<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>quik</title>
  <link rel="icon" href="icons/quik_icon.png" type="image/png">

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Highlight.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

<style>
    /* Renk Değişkenleri - Root ve Body.Dark */
    :root {
      --bg-color: #f7f7f8;
      --text-color: #333;
      --primary-color: #007bff;
      --sidebar-bg: #ffffff;
      --input-bg: #ffffff;
      --bubble-user-bg: #dcf8c6;
      --bubble-assistant-bg: #ececec;
      --topbar-bg: #ffffff;
      --code-bg: #f7f7f8;
      --code-text: #333;
      --code-border: #ddd;
      --hover-bg: #3e3f4b;
      --modal-shadow: rgba(0, 0, 0, 0.5);
      --sidebar-width: 260px;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --accent-color: #6c757d;
    }
    body.dark {
      transition: none;
      --bg-color: #202020;
      --text-color: #e0e0e0;
      --primary-color: #0a84ff;
      --sidebar-bg: #171717; 
      --input-bg: #303030;
      --bubble-user-bg: #055160;
      --bubble-assistant-bg: #333333;
      --topbar-bg: #000000;
      --code-bg: #171717;
      --code-text: #f0f0f0;
      --code-border: #333;
      --success-color: #34c759;
      --danger-color: #ff4d4f;
      --warning-color: #ffca2c;
      --accent-color: #adb5bd;
    }

    body.dark .top-bar {
      background-color: var(--bg-color);
      box-shadow: none;
    }


/* Link colour in dark mode */
a {
  color: #3B82F6;   /* vivid blue for all links */
}

a:hover {
  text-decoration: underline;  /* optional: nice hover cue */
}


    * {
      box-sizing: border-box;
    }
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-color);
  overflow-y: auto;
  overflow-x: hidden; /* YENİ EKLENDİ: Yatay taşmayı gizle */
  opacity: 0; /* Başlangıçta görünmez */
  animation: fadeIn 1s ease forwards; /* 0.5 saniyede animasyon */
}

    /* Fade-in ve hafif kayma animasyonu */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px); /* Aşağıdan yukarı doğru hafif kayma */
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sabit Toggle Butonu (sol üst köşe) */
#toggle-sidebar-btn {
  position: fixed;
  display: flex;
  align-items: center;
  justify-content: center;
  top: 9px;
  left: 10px;
  z-index: 306;
  background-color: var(--background-bg);
  border: none;
  height: 40px;
  width: 40px;
  cursor: pointer;
  color: var(--text-color);
  transition: transform 0.3s, left 0.5s cubic-bezier(0.2, 1, 0.4, 1);
  border-radius: 12px;
}

/* --- Kenar Çubuğu Açıkken Kapatma Düğmesinin Konumlandırılması (Tüm Ekran Boyutları İçin) --- */

/* MASAÜSTÜ (genişliği sabit olan kenar çubuğu için) */
@media (min-width: 769px) {
  body.sidebar-open #toggle-sidebar-btn {
    /* Konumu sabit sidebar genişliğine göre hesapla */
    /* Hesap: 260px (sidebar) - 40px (düğme) - 10px (sağ boşluk) = 207px */
    left: calc(var(--sidebar-width) - 50px);
  }
}

/* MOBİL (genişliği yüzdesel olan kenar çubuğu için) */
@media (max-width: 768px) {
  body.sidebar-open #toggle-sidebar-btn {
    /* Mobil'de sidebar genişliği: calc(100% - 53px) */
    /* Hesap: (100% - 53px) - 40px (düğme) - 10px (sağ boşluk) = 100% - 106px */
    left: calc(100% - 106px);
  }
}

    #toggle-sidebar-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark #toggle-sidebar-btn {
      color: #f0f0f0;
    }
    body.dark #toggle-sidebar-btn:hover {
      color: var(--sidebar-bg);
      background-color: #c0c0c0;
    }

    /* Dark modda ikonlar normalde ters çevrilmiş olsun */
    body.dark #toggle-sidebar-btn img,
    body.dark .new-chat-btn img,
    body.dark #web-search-btn img {
      filter: invert(1);
    }

    /* Hover durumunda filtreyi kaldırarak ikonların doğal rengine dönmesini sağla */
    body.dark #toggle-sidebar-btn:hover img,
    body.dark .new-chat-btn:hover img,
    body.dark #web-search-btn:hover img {
      filter: none;
    }

    /* Uygulama konteyneri */
    #app {
      display: flex;
      min-height: 100vh;
      overflow: visible;
    }

    /* Sidebar */
/* 1. ADIM: .sidebar'ı HAREKETSİZ ve GÖRÜNMEZ bir içerik katmanı yapalım. */
.sidebar {
  position: absolute; /* Konumunu tiny-sidebar'a göre ayarlayacağız */
  top: 0;
  left: 0;
  width: var(--sidebar-width);
  height: 100%;
  background-color: transparent; /* Arka planı tamamen şeffaf, çünkü rengi tiny-sidebar verecek */
  z-index: 304; /* Animasyonlu katmanın bir arkasında */
  display: flex;
  flex-direction: column;
  padding: 0.5rem;
  pointer-events: none; /* Kapalıyken tıklanamaz olsun */
  /* HAREKETLE İLGİLİ TÜM KODLAR (transform, transition) SİLİNDİ. */
}

@media (max-width: 768px) {
  .sidebar {
    width: calc(100% - 53px); /* Mobildeki sidebar genişliğiyle aynı yap */
  }
}

/* sidebar içindeki sohbet listesi vb. başta görünmesin */
.sidebar > * {
  opacity: 0;
}

/* sidebar açılınca içeriği ve tıklama özelliğini geri getir */
body.sidebar-open .sidebar {
  pointer-events: auto;
}
body.sidebar-open .sidebar > * {
  opacity: 1;
}

/* 2. ADIM: .tiny-sidebar'ı ana aktör yapalım. Animasyon, renk ve çizgi onda olacak. */
.tiny-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 62px; 
  height: 100vh;
  background-color: white;
  /* --- YENİ BORDER KURALI --- */
  /* Çizgi artık hep burada ve animasyondan etkilenmiyor. */
  border-right: 1px solid rgba(128, 128, 128, 0.2); 
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 10px; 
  box-sizing: border-box;
  /* ANİMASYON: Genişlik pürüzsüzce değişecek */
  transition: width 0.5s cubic-bezier(0.2, 1, 0.4, 1); 
  z-index: 303; /* Her zaman en üstte bu görünecek */
  overflow: hidden; 
}

body.dark .tiny-sidebar {
  background-color: #202020;
}

.tiny-sidebar:hover {
  overflow: visible;
}

/* sidebar açılınca tiny-sidebar'ı hedef genişliğe getir */
body.sidebar-open .tiny-sidebar {
  width: var(--sidebar-width);
}

/* ESKİ .sidebar.open kuralına artık ihtiyacımız yok. */

/* Mobil için tiny sidebar genişliği */
@media (max-width: 768px) {
  body.sidebar-open .tiny-sidebar {
    width: calc(100% - 53px); /* Mobilde sidebar genişliği */
  }
}

    .sidebar-header {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      text-align: center;
      margin: 0;
      padding: 5.25rem 0;

      display: flex;
      align-items: center;
      justify-content: center;
    }

.sidebar-ender {
  position: sticky; /* Sayfa kaysa bile altta sabit kalmasını sağlar */
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 2.5rem 0.5rem; /* Dikey ve yatay boşluk */
  background-color: transparent; /* Arka plan rengi tema ile uyumlu */

  display: flex;
  flex-direction: column; /* Butonlar alt alta gelsin */
  gap: 0.5rem; /* Butonlar arası boşluk */
  margin-top: auto; /* Kendini flex container'ın en altına itsin */
}

    #sidebar-brand {
      position: fixed;
      left: 10px;
      top: 9px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 12px;
      border: 1px solid transparent;
      cursor: pointer;
    }

#sidebar-brand:hover {
  background-color: #c0c0c0;
}


    body.dark #sidebar-brand:hover {
      color: var(--sidebar-bg);
    }

    #sidebar-brand-icon {
      width: 24px;
      height: 24px;
      vertical-align: middle;
    }

    body.dark #sidebar-brand-icon {
      filter: brightness(0) invert(1);
    }

    body.dark #sidebar-brand:hover #sidebar-brand-icon {
      filter: none;
    }


body.sidebar-open #toggle-sidebar-btn:hover {
  background-color: #c0c0c0;
  transition: transform 0.15s ease, color 0.15s ease;
}

body.dark.sidebar-open #toggle-sidebar-btn:hover {
  color: var(--sidebar-bg);
}

    .close-sidebar-btn {
      display: none;
    }

#new-chat-btn,
#sidebar-search-toggle {
    position: fixed !important;
    height: 40px;
    width: 40px;
    background-color: transparent;
    border: none;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-color);
    overflow: hidden;

}

/* Konumlarını ayrı ayrı belirtiyoruz */
#new-chat-btn { top: 74px !important; left: 10px !important; z-index: 303 !important; }
/* Yeni */
#sidebar-search-toggle { top: 114px; left: 10px; z-index: 305 !important; }



/* Butonların içindeki metni VARSAYILAN OLARAK GİZLE */
#new-chat-btn .btn-text,
#sidebar-search-toggle .btn-text {
    display: none;
    font-size: 0.8rem;
    font-weight: 600;
    white-space: nowrap;
}

/* Sidebar AÇIKKEN butonların kendisini genişlet */
body.sidebar-open #sidebar-search-toggle {
    width: calc(var(--sidebar-width) - 20px);
    justify-content: flex-start;
    padding-left: 10px;
    gap: 12px;
}

body.sidebar-open #new-chat-btn {
    width: calc(var(--sidebar-width) - 20px);
    justify-content: flex-start;
    padding-left: 9.5px;
    gap: 12px;
}

/* Sidebar AÇIKKEN butonların içindeki metni GÖRÜNÜR YAP */
body.sidebar-open #new-chat-btn .btn-text,
body.sidebar-open #sidebar-search-toggle .btn-text {
    display: inline;
}

body.sidebar-open #new-chat-btn[data-tooltip]::after,
body.sidebar-open #sidebar-search-toggle[data-tooltip]::after {
    display: none !important;
}

/* --- Ortak Hover ve Dark Mode Stilleri --- */

/* Hover */
#new-chat-btn:hover,
#sidebar-search-toggle:hover {
    background-color: #c0c0c0;
}

/* Dark Mode İkon */
body.dark #new-chat-btn img,
body.dark #sidebar-search-toggle img {
    filter: invert(1);
}
body.dark #new-chat-btn:hover img,
body.dark #sidebar-search-toggle:hover img {
    filter: none;
}

/* Dark Mode Metin */
body.dark #new-chat-btn:hover .btn-text,
body.dark #sidebar-search-toggle:hover .btn-text {
    color: var(--sidebar-bg);
}

    .new-chat-btn:hover {
      background-color: #c0c0c0;
    }

    .new-chat-btn[data-tooltip] {
      position: absolute;
    }

    .new-chat-btn[data-tooltip]::after,
    .sidebar-search-toggle[data-tooltip]::after {
      right: auto !important;
      left: 12.8px !important;
      top: 50% !important;
      transform: translate(50%, -50%) !important;
    }

    .help-btn[data-tooltip]::after {
  top: 50% !important;
  left: calc(100% + 15px) !important;
  transform: translateY(-50%) !important;
    }

    /* Tıklama sonrası tooltip’i gizle */
    [data-tooltip].no-tooltip::after {
      opacity: 0 !important;
      visibility: hidden !important;
    }

    body.dark .new-chat-btn img {
      filter: brightness(0) invert(1);
    }

    body.dark .new-chat-btn:hover {
      color: var(--sidebar-bg);
    }

    body.dark .new-chat-btn:hover img {
      filter: none; /* ikon doğal renginde (muhtemelen siyah) görünsün */
    }

.chat-history-list {
    list-style: none;
    padding-left: 5px;
    padding-right: 0;
    margin: 0;
    flex: 1;
    scrollbar-width: auto;
    scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
    overflow-y: auto;
    /* Başlangıçta tamamen görünmez ve sola kaydırılmış */
    opacity: 0;
    pointer-events: none;
    transform: translateX(-100%); /* Soldan içeri kaydır */
    transition: opacity 0.15s ease, transform 0.35s ease; /* Opaklık ve konum değişimi için geçiş */

}

body.sidebar-open .chat-history-list {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0); /* Normal konumda (tamamen içeri) */
}

    /* Tarih Grubu (Başlık ve Sohbetler) */
    .chat-history-group {
      margin-bottom: 0.5rem;
    }

    /* Tarih Başlığı */
    .chat-history-header {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-color);
      padding: 0.25rem 0.25rem;
      margin-top: 0.25rem;
    }

.chat-history-list::-webkit-scrollbar {
  width: 6px;
}

.chat-history-list::-webkit-scrollbar-track {
  background: transparent;
}

.chat-history-list::-webkit-scrollbar-thumb {
  background-color: rgba(85, 85, 85, 0.2);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

.chat-history-list::-webkit-scrollbar-thumb:hover {
  background-color: rgba(85, 85, 85, 0.5);
}


/* Chat History Date (Tarih Bilgisi) */
.chat-history-date {
  font-size: 0.8rem; /* Küçük font boyutu */
  color: var(--accent-color); /* Soluk renk (örneğin, #6c757d) */
  white-space: nowrap; /* Tarih tek satırda kalsın */
  margin-right: 0.5rem; /* Butonlarla arasında boşluk */
}

/* Aktif Durumda Tarih Rengi */
.chat-history-item.active .chat-history-date {
  color: #000000; /* Light modda siyah */
}

body.dark .chat-history-item.active .chat-history-date {
  color: var(--sidebar-bg); /* Dark modda sidebar rengi */
}

/* Hover Durumunda Tarih Rengi */
.chat-history-item:hover .chat-history-date {
  color: var(--text-color); /* Hover’da metin rengiyle uyumlu */
}

body.dark .chat-history-item:hover .chat-history-date {
  color: var(--text-color);
}


    /* Chat History Item (Her Bir Sohbet Öğesi) */
    .chat-history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 8px;
      background-color: transparent;

      position: relative;
    }

.chat-history-item:hover {
  background-color: #c0c0c0;
}



body.dark .chat-history-item:hover {
  background-color: #333; /* Dark modda koyu gri */
}

.chat-history-item.active {
  background-color: #c0c0c0; /* Her zaman sabit arka plan rengi */
  transition: none; /* Hover geçişini devre dışı bırak, sabit renk için */
}

body.dark .chat-history-item.active {
  background-color: #c0c0c0;
  color: #fff;
}

.chat-history-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.8rem;
  padding-top: 6px;
  padding-bottom: 6px;
  font-weight: 500;
  color: var(--text-color);
  flex: 1; /* Başlık alanı genişlesin */
  margin-right: 0.5rem;
}

.chat-history-item.active .chat-history-title {
  color: #000000; /* Light modda siyah metin */
}

/* History Actions (Düzenleme ve Silme Butonları) */
.history-actions {
  position: relative;
  display: flex;
  align-items: center;
  min-width: 30px; /* İkon görünmediğinde yer tutar, kayma olmaz */
}

.more-options-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: none; /* Varsayılan olarak gizli */
  transition: opacity 0.2s ease;
  position: absolute;
  opacity: 0;
}

.chat-history-item:hover .more-options-btn {
  opacity: 1;
  display: block;
}

.more-options-btn img {
  width: 20px;
  height: 20px;
}

.dropdown-menu {
  position: absolute;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  min-width: 100px;
  display: none;
}

body.dark .dropdown-menu {
  background-color: #343434;
}

.dropdown-item {
  display: block;
  width: 100%;
  padding: 8px 12px;
  background-color: transparent;
  border: none;
  text-align: left;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-color);
  border-radius: 12px;
}

.dropdown-item:hover {
  background: #c0c0c0;
}

body.dark .dropdown-item:hover {
  color: var(--sidebar-bg);
}

body.dark .dropdown-item.edit-btn:hover img {
  filter: none;
}

body.dark .dropdown-item.delete-btn:hover img {
  filter: none;
}

body.dark .dropdown-item.edit-btn img {
  filter: invert(1);
}

body.dark .dropdown-item.delete-btn img {
  filter: invert(1);
}

body.dark .chat-history-item.active .more-options-btn img {
  filter: none; /* Hafif gri arka plan */
}

.history-actions button img {
  width: 12px;
  height: 12px;
  margin-top: 4px;
  filter: none;
  opacity: 1;
}

body.dark .chat-history-item:hover .more-options-btn img {
  filter: invert(1); /* Dark modda ikonlar beyaz */
}

body.dark .chat-history-item.active .more-options-btn img {
  filter: none; /* Dark modda ikonlar beyaz */
}

/* Dark mode’da ikonu tersine çevir */
body.dark .history-icon {
  filter: brightness(0) invert(1);
}

    /* Main İçerik */
.main-content {
  flex: 1;
  margin-left: 62px; 
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  position: relative;
  transition: margin-left 0.5s cubic-bezier(0.2, 1, 0.4, 1); 
}
    .main-content.sidebar-open {
      margin-left: 260px;
    }

body.sidebar-open .main-content {
  margin-left: var(--sidebar-width); 
}


@media (max-width: 768px) {
  body.sidebar-open .main-content {
    margin-left: 62px !important;
  }
}

.top-bar {
  position: relative; /* Üst eleman içinde absolute konumlandırma için */
  /* mevcut stil özellikleriniz: örnek */
  display: flex;
  align-items: center;
  justify-content: flex-end; /* Örneğin sağda başka butonlar varsa */
  padding: 1.5rem 3rem;
  background-color: var(--topbar-bg);
  z-index: 100;
  height: 58px;
}

/* Sohbet başlığının yer alacağı alan */
.top-bar-title {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 1rem;
  font-weight: bold;
  color: var(--text-color);
  padding: 0.5rem;
  border-radius: 12px;
}

.top-bar-title:hover {
  background: #c0c0c0;
  color: var(--text-color);
}

body.dark .top-bar-title:hover {
  color: var(--bg-color);
}




    .dark-mode-toggle {
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 7px;
      right: 7px;
      z-index: 304;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      border-radius: 12px;
    }

    .dark-mode-toggle:hover {
      background-color: #c0c0c0;
    }

    .dark-mode-toggle img {
      transition: filter 0s;
    }

    body.dark .dark-mode-toggle img {
      filter: invert(1);
    }

    body.dark .dark-mode-toggle:hover img {
      filter: none;
    }

    body.dark .dark-mode-toggle:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }

    .scroll-wrapper {
      width: 100%;
      height: calc(100vh - 150px);
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .chat-container {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      padding-top: 1rem;
      background-color: var(--bg-color);
      max-width: 760px;
      margin: 0 auto;
      width: 100%;
      scroll-behavior: smooth;
    }

    @media (max-width: 768px) {
      .chat-container {
        padding: 0.5rem;
        max-width: 100%;
      }
    }

    .chat-container::after {
      content: "";
      display: block;
      height: 50px; /* Chat input yüksekliğine göre ayarlayın */
    }

.welcome-message {
  position: absolute; /* absolute yerine fixed, ekranın ortasında sabit kalır */
  top: 35%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 90%; /* Mobil cihazlarda daha esnek */
  max-width: 600px; /* Masaüstünde maksimum genişlik sınırı */
  box-sizing: border-box;
}

.welcome-message h1 {
  font-size: clamp(1.5rem, 4vw, 2rem); /* Esnek font boyutu: min 1.5rem, max 2rem */
  margin: 0 0 0.5rem;
}

.welcome-message p {
  font-size: clamp(1rem, 3vw, 1.5rem); /* Esnek font boyutu: min 1rem, max 1.5rem */
  margin: 0;
}

/* Media query for small screens (max-width: 768px) */
@media (max-width: 768px) {
  .welcome-message {
    top: 45%;
    width: 85%; /* Slightly narrower for smaller screens */
    padding: 0.75rem;
  }

  .welcome-message h1 {
    font-size: clamp(1.5rem, 4vw, 2rem); /* Increased from 1.25rem-1.75rem range */
  }

  .welcome-message p {
    font-size: clamp(1rem, 3vw, 1.5rem); /* Increased from 0.875rem-1.25rem range */
  }
}

/* Media query for very small screens (max-width: 480px) */
@media (max-width: 480px) {
  .welcome-message {
    width: 90%;
    padding: 0.5rem;
  }

  .welcome-message h1 {
    font-size: clamp(1.25rem, 3.5vw, 1.75rem); /* Increased from 1rem-1.5rem range */
  }

  .welcome-message p {
    font-size: clamp(0.875rem, 2.5vw, 1.25rem); /* Increased from 0.75rem-1rem range */
  }
}



/* Chat Mesaj Balonları */
.chat-bubble {
  max-width: 70%;
  margin-bottom: 0.5rem; /* Azaltılmış alt boşluk */
  margin-right: 0.2rem;
  margin-left: 0.5rem;
  border-radius: 16px;
  word-wrap: break-word;
  line-height: 1.5;       /* Sıkıştırılmış satır yüksekliği */
  font-size: 1rem;
  white-space: normal;  /* Yeni satırları korumak istemiyorsanız normal */
}

.user-bubble {
  align-self: flex-end;
  border-bottom-right-radius: 0;
  background-color: var(--input-bg);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  font-size: 1rem;
  padding-left: 1rem;
  padding-right: 1rem;
  border-radius: 24px;
  line-height: 1.5;
  margin-bottom: 2rem;
}

.assistant-bubble {
  position: relative;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  font-size: 1rem;
  white-space: normal;   /* Fazla boşluklar ortadan kalksın */
  overflow-wrap: break-word;
  max-width: 100% !important;
  flex-direction: column;
  gap: 0;
  padding-bottom: 0;
  line-height: 1.75;
  margin-bottom: 3rem;
}

.assistant-bubble pre code {
  display: block;
  background: #f8f8f8;
  overflow-x: auto;
}

.feedback-container, .feedback-button {
  margin-top: 0;
  padding-top: 0;
}

    /* Chat Input */
.chat-input {
  position: absolute;
  bottom: 20px;
  /* YENİ: Başlangıçta tiny-sidebar'ın yarısı kadar sağa ittirerek ortala */
  left: calc(50% + (62px / 2));
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: stretch;
  background-color: var(--input-bg);
  border-radius: 30px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  /* YENİ: Genişliği de tiny-sidebar'ı hesaba katacak şekilde ayarla */
  width: calc(100% - 62px - 1rem); 
  max-width: 760px;
  margin: 0 auto;
  padding: 1rem 0.5rem;
  box-sizing: border-box;
  z-index: 302;
  /* YENİ: Animasyonu sidebar ve main-content ile senkronize et */
  transition: left 0.5s cubic-bezier(0.2, 1, 0.4, 1), 
              width 0.5s cubic-bezier(0.2, 1, 0.4, 1);
}

     body.dark .chat-input {
       box-shadow: none;
    } 

    body.sidebar-open .chat-input {
      left: calc(50% + (var(--sidebar-width) / 2));
      width: calc(100% - var(--sidebar-width) - 1rem);
    }

    /* Responsive ayar: Küçük ekranlar için minimum genişlik */
@media (max-width: 768px) {
  /* --- Genel Mobil Ayarları --- */
  .chat-input {
    bottom: 0;
    padding-bottom: 1rem;
    border-radius: 30px 30px 0 0;
    max-width: none; /* Mobilde maksimum genişlik kısıtlamasına gerek yok */
  }

  /* --- Sidebar KAPALIYKEN (tiny-sidebar görünüyor) --- */
  body:not(.sidebar-open) .chat-input {
    width: calc(100% - 62px); /* Genişlik: Ekran Genişliği - tiny-sidebar Genişliği */
    left: calc(50% + 31px);    /* Konum: Ortala + (tiny-sidebar'ın yarısı kadar) sağa ittir */
  }

  /* --- Sidebar AÇIKKEN --- */
  body.sidebar-open .chat-input {
    /* Mobilde sidebar içeriğin üzerine bindiği için, input tekrar tam ortaya döner */
    width: 100%;
    left: 50%;
  }
}

@media (max-width: 480px) {
  /* --- Genel Mobil Ayarları --- */
  .chat-input {
    bottom: 0;
  }
}

#chat-input-textarea {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  font-size: 1rem;
  line-height: 1.5;
  flex: 1 1 auto; /* Esnek genişlik, küçülme ve büyüme izni */
  border: none;
  outline: none;
  background: transparent;
  resize: none;
  max-height: calc(1.35rem * 7); /* 7 satır */
  min-height: 1.35rem;
  min-width: 0; /* Flex küçülme sorunlarını önler */
  overflow-y: auto;
  margin: 0 0.5rem;
  box-sizing: border-box;
  margin-bottom: 0.5rem;
}


    body.dark #chat-input-textarea {
      color: #fff;
      caret-color: #fff;
    }

    body.dark #chat-input-textarea::placeholder {
      color: #bbb;
    }

.send-btn {
  position: absolute; /* Chat-input'a göre konumlanacak */
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  align-self: flex-end;
  justify-content: center;
  right: 10px; /* Chat-input'un sağından 10px içeride */
  bottom: -1px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

.send-btn:hover {
  background-color: #c0c0c0;
}

body.dark #send-btn {
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark #send-btn img {
  filter: brightness(0) invert(1);
}

body.dark #send-btn:hover img {
  filter: none;
}

    /* Modern Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(85, 85, 85, 0.2);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: content-box;
      transition: background-color 0.3s;
    }
    ::-webkit-scrollbar-thumb:hover {
      background-color: #555;
    }
    * {
      scrollbar-width: auto;
      scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
    }



    /* === Kod Blokları ve Kopyalama Butonu Stilleri === */
   
/* Kod bloklarına relative konumlandırma */
pre {
  position: relative;
  background: var(--code-bg);
  padding: 16px;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  overflow-x: auto;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  color: var(--code-text);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

/* Dark Mode */
body.dark pre {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
  color: var(--code-text);
}

/* Copy butonu sağ üstte */
.copy-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background-color: transparent;
  color: #777;
  border: none;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
}

.copy-btn:hover {
  background-color: #ddd;
  color: #333;
}

.btn-text {
  display: inline-block;
  transition: transform 0.3s;
}

body.dark .copy-btn {
  color: #bbb;
}

body.dark .copy-btn img {
  filter: brightness(0) invert(1);
}

body.dark .copy-btn:hover {
  background-color: #444;
  color: #fff;
}

.copy-btn.copied {
  background-color: transparent;
}

body.dark .copy-btn:hover img {
  filter: none;
}

body.dark .copy-btn.copied {
  background-color: transparent;
}

body.dark .copy-btn.copied {
  filter: none;
}

.code-block {
  background-color: var(--code-bg);
  border: 1px solid var(--code-border); 
  margin-bottom: 1.5rem;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

body.dark .code-block {
  background-color: #1e1e1e;  /* Koyu arka plan */
  border-color: #333;
  box-shadow: 0 4px 14px rgba(255,255,255,0.05);
}

/* Üstteki başlık çubuğu */
.code-header {
  position: relative;
  background: var(--code-bg);
  border-bottom: 1px solid #c0c0c0;
  padding: 8px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

body.dark .code-header {
  background-color: #2a2a2a;
  border-bottom-color: #444;
}


/* Dil adı */
.code-language {
  font-weight: 600;
  font-size: 1rem;
  color: #666;
}

body.dark .code-language {
  color: #ccc;
}

/* Asıl kod alanı (pre) */
.code-block pre {
  background: transparent;;
  padding: 12px;
  margin: 0;
  position: relative;
}

/* Copy butonu */
.code-header .copy-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: transparent;
  color: var(--text-color);
  border: none;
  padding: 4px 6px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.5rem;
  opacity: 1;
  transition: opacity 0.3s;
  z-index: 10; /* Butonu öne çıkarmak için */
}

:root .code-header .copy-btn {
  color: var(--text-color);
}

body.dark .code-header .copy-btn {
  background-color: transparent; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--text-color);
}

body.dark .code-header .copy-btn:hover {
  background-color: #c0c0c0; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--sidebar-bg);
  opacity: 1;
}

.code-header .copy-btn:hover {
  background-color: #c0c0c0;
  opacity: 1;
}

.hljs {
  color: #333;             /* Light mod */
  background-color: none;  /* .code-block backgroundı kullan */
}
body.dark .hljs {
  color: #eee;            /* Dark modda açık metin rengi */
}

pre code {
  background: none !important;
}

/* --- Web Arama Butonu Stilleri --- */
#web-search-btn {
  position: fixed;    /* Sayfanın sol altına sabitle */
  bottom: 15px;       /* Alttan 20px boşluk */
  left: 70px;         /* Soldan 20px boşluk */
  z-index: 200;       /* Chat inputtan daha üstte veya altta olmasına göre ayarla */
  width: 60px;
  height: 35px;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-color);

}

#web-search-btn:hover {
  background-color: #c0c0c0;  /* Hover durumunda benzer kutu efekti */
}

body.dark #web-search-btn {
  color: var(--text-color);
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

/* Dark modda ikonu bembeyaz yap */
body.dark #web-search-btn img {
  filter: brightness(0) invert(1);
}

body.dark #web-search-btn:hover img {
  filter: none;
}

body.dark #web-search-btn:hover {
  background-color: #c0c0c0;  /* Dark modda da aynı hover efekti */
  color: var(--sidebar-bg);
}

#web-search-btn.active {
  background-color: #96bfff;
}

#web-search-btn.active:hover {
  color: #fff;
}

#web-search-btn.active:hover img {
  filter: brightness(0) invert(1);
}

body.dark #web-search-btn.active {
  background-color: #2171cc;
}

body.dark #web-search-btn.active:hover {
  background-color: #2171cc;
}

@media (max-width: 768px) {
  #web-search-btn span {
    display: none;
  }
  #web-search-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
  }
  #web-search-btn img {
    margin-right: 0 !important;
  }
}




body.dark #send-btn.stop-state img {
  filter: brightness(0) invert(1);
}

/* Dark modda, hover durumunda ikonu normale döndür (filter sıfır) */
body.dark #send-btn.stop-state:hover img {
  filter: none;
}

/* Hover durumunda arka plan rengini #c0c0c0 yap (ara butonuyla aynı mantık) */
#send-btn.stop-state:hover {
  background-color: #c0c0c0;
}

@media (max-width: 768px) {
  #quik-icon {
    width: 36px; /* Küçük ekranlarda ikon boyutunu küçült */
  }
}

@media (max-width: 480px) {
  #quik-icon {
    width: 28px; /* Daha küçük ekranlarda daha da küçült */
  }
}

/* Logo için kapsayıcı */
.logo-container {
  display: flex;
  justify-content: center; /* Logoyu yatayda ortala */
}

@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

#quik-icon {
  width: 50px; /* Varsayılan genişlik */
  height: auto; /* Oranları korumak için otomatik yükseklik */
  max-width: 50px; /* Maksimum genişlik sınırı */
  max-height: 50px; /* Maksimum yükseklik sınırı */
  vertical-align: middle;
  opacity: 0; /* İlk başta görünmeyecek */
}

body.dark #quik-icon {
  filter: brightness(0) invert(1);
}

/* Ayarlar Butonu */
.settings-btn {
  position: fixed;
  bottom: 5px;
  left: 10px;
  width: 40px;
  height: 40px;
  background-color: transparent;
  border: none;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1000;
}

.settings-btn img {
  width: 24px;
  height: 21px;
}

.settings-btn.blurred {
  filter: blur(3px);
  pointer-events: none;
  transition: filter 0.3s ease;
  opacity: 0.8;
  z-index: 200; /* Modalın altına düşür */
}

.settings-btn:hover {
  background-color: #c0c0c0;
}

body.dark .settings-btn img {
  filter: brightness(0) invert(1);
}

body.dark .settings-btn:hover img {
  filter: none;
}

body.dark .settings-btn:hover {
  background-color: #c0c0c0;
}

    /* Modal Genel Ayarları */
    .modal {
      display: none;
      position: fixed;
      z-index: 306;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7); /* Her iki modal için aynı karartma */
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }


    /* Ayarlar Modal'ı İçin Genel Stil */
    .modal-content {
      background-color: var(--sidebar-bg);
      margin: 10% auto;
      padding: 20px;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    @media (max-width: 768px) {
      .modal-content {
        margin: 0;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-height: 100vh;
        border-radius: 12px 12px 0 0;
        overflow-y: auto;
      }
    }

    /* Kapatma Butonu */
    .settings-close {
      position: absolute;
      top: 12px;
      right: 12px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-color);
    }

body.dark .settings-close:hover {
  color: var(--sidebar-bg);
}

/* Başlık */
.modal-content h2 {
  margin: 0 0 20px;
  font-size: 1.5rem;
  color: var(--text-color);
}

/* Modal içindeki Dark Mode Toggle butonunun stili */
.dark-mode-toggle-modal {
  background: none;
  border: none;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 12px;
}

.dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
}

body.dark .dark-mode-toggle-modal img {
  filter: invert(1);
}

body.dark .dark-mode-toggle-modal:hover img {
  filter: none;
}

body.dark .dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

/* Genel Toggle Buton Stili (Web Arama gibi) */
.toggle-btn {
  background: none;
  border: none;
  padding: 5px 10px;
  border-radius: 8px;
  cursor: pointer;
  color: var(--text-color);
}

.toggle-btn:hover {
  background-color: #c0c0c0;
}

.toggle-state {
  font-size: 1rem;
}

/* Modal Arka Planı ve Animasyon */
.settings-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 999;
}
.settings-modal.show {
  opacity: 1;
  visibility: visible;
}

/* Modal İçeriği */
.settings-modal-content {
  background-color: var(--sidebar-bg);
  width: 90%;
  max-width: 700px;
  min-height: 94vh;
  margin: 3vh auto;
  border-radius: 3vh;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden; /* İç taşmayı engelle */
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

body.dark .settings-modal-content {
  background-color: var(--sidebar-bg); /* ya da sidebar rengi olarak kullandığın değişken */
}

/* Responsive Ayarlar */
@media (max-width: 768px) {
  .settings-modal-content,
  .chat-search-modal-content {
    width: 100%;
    height: 100vh !important;
    max-height:100vh !important;
    margin: 0 !important;  
    position: fixed;
    top: 0;
    left: 0;
    border-radius: 0 !important;
    overflow: hidden; /* Modalın kendisi taşmasın */
    display: flex;
    flex-direction: column; /* Dikey düzen */
  }

  .settings-nav {
    border-bottom: 1px solid var(--code-border);
  }

  .settings-nav ul {
    flex-direction: row; /* Mobil için yatay liste */
    padding: 5px 10px;
  }

  .settings-nav li {
    margin-right: 10px;
    margin-bottom: 0;
    padding: 8px 10px;
    min-width: auto; /* Mobil için sabit genişlik kaldır */
  }

  .settings-content {
    height: 100%; /* Mobil için de sabit */
    overflow-y: auto; /* Kaydırma çubuğu aktif */
  }
}


@media (max-width: 480px) {
  .settings-modal-content {
    max-height: 100vh; /* Çok küçük ekranlarda daha fazla alan */
  }

  /* Header kısmı örneğin 60px kaplıyorsa */
  .settings-body {
    height: calc(85vh - 60px); /* Header ve diğer üst elemanların yüksekliği çıkarıldı */
  }

  .settings-nav li {
    font-size: clamp(0.6875rem, 1.8vw, 0.75rem);
    padding: 6px 8px;
  }

  .settings-header h2 {
    font-size: clamp(0.875rem, 2vw, 1rem);
  }

  .settings-content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* Daha yumuşak kaydırma için */
  }

  .setting-item label,
  .setting-label {
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
  }

  .setting-item textarea {
    font-size: clamp(0.6875rem, 1.5vw, 0.75rem);
    padding: 8px;
  }

  .save-btn,
  #save-personalization {
    padding: 6px 12px;
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
  }
}

/* Header */
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 5px;
  padding-top: 10px;
  background-color: var(--nav-bg);
  border-bottom: 2px solid #c0c0c0;
  margin-bottom: 20px;
}
.settings-header h2 {
  font-size: 1.1rem; /* Esnek font boyutu */
  color: var(--text-color);
}

.settings-close {
  position: absolute; /* BU EN ÖNEMLİSİ */
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--sidebar-bg);  /* Örn: beyaz veya açık gri */
  border: none;
  width: 40px;
  height: 40px;
  top: 22px;
  right: 12px;
  border-radius: 50%; /* DAİRE YAPAR */
  cursor: pointer;
  color: var(--text-color);
  font-size: 1.2rem; /* X boyutu */
  font-weight: bold;
  z-index: 1000;
}

@media (max-width:768px) {
  .settings-close {
    top: 19px;
  }
}


/* Hover durumunda sidebar'dakine benzer davranış */
.settings-close:hover {
  background-color: #c0c0c0;
}

body.dark .settings-close:hover {
  background-color: #c0c0c0; /* Dark modda sidebar rengi */
}


/* =========================
   SEKMELİ AYARLAR EK CSS
========================= */

/* Ayarlar gövdesi: solda menü, sağda içerik */
.settings-body {
  display: flex;
  flex: 1; /* Modalın içini doldursun */
  min-height: 0; /* Flex taşmasını önler */
  height: 100%; /* Üst kapsayıcının tam yüksekliği */
  overflow: hidden; /* Taşma gizlensin */
}

/* Sol Sekme Menüsü */
.settings-nav {
  background-color: var(--nav-bg);
  overflow-x: auto; /* Yatay kaydırma mobil için */
  white-space: nowrap; /* Sekmeler tek satırda kalsın */
}

.settings-nav ul {
  list-style: none;
  margin: 0;
  padding: 0;

  flex-direction: column;
}

.settings-nav li {
  padding: 10px 12px;
  margin-right: 30px;
  margin-bottom: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-color);
  font-size: clamp(0.75rem, 2vw, 0.8rem); /* Esnek font */
  border-radius: 8px;
  display: flex;
  justify-content: flex-start;
  min-width: 160px; /* Her durumda aynı genişlik */
  font-weight: 600; /* Normalde biraz daha kalın yaparak değişimi minimize et */
  text-rendering: optimizeLegibility;
  align-items: center;
  gap: 8px; /* Yazıyla ikon arasında boşluk bırak */
}

.settings-nav li .settings-icon {
  width: 14px; /* İkon boyutu */
  height: 14px;
  flex-shrink: 0; /* Küçük ekranlarda bile ikonu küçültme */
}

/* Dark modda tüm ikonlar beyaz olur */
body.dark .settings-nav li .settings-icon {
  filter: invert(1);
}

/* AMA! Eğer aktif (seçili) sekmeyse ikon eski renginde kalmalı */
body.dark .settings-nav li.active .settings-icon,
body.dark .settings-nav li:hover .settings-icon {
  filter: none; /* Dark modda aktif ve hover durumundaki ikon değişmez */
}

.settings-nav li:hover {
  background-color: #c0c0c0;
  font-weight: 600;
}

body.dark .settings-nav li:hover {
  color: var(--sidebar-bg);
  font-weight: 600;
}

.settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 700;
  color: var(--text-color);
}

body.dark .settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 600;
  color: var(--sidebar-bg);
}

/* Sağ içerik */
.settings-content {
  flex: 1; /* Genişlik esnek kalsın */
  overflow-y: auto; /* İçerik taşarsa dikey kaydırma çubuğu */
  overflow-x: hidden; /* Yatay taşma olmasın */
  height: 100%; /* Üst kapsayıcının tam yüksekliği */
  box-sizing: border-box;
}

/* Sekme içeriğini gizle/göster */
/* Varsayılan olarak tüm sekmeleri gizle */
.tab-content {
  display: none;
  position: absolute; /* Sekmelerin üst üste binmesini önler */
  width: 100%; /* İçeriği tam oturtur */
  top: 0;
  left: 0;
}

/* Sadece aktif olan sekmeyi göster */
.tab-content.active {
  display: block !important;
  position: relative; /* Çakışmayı engeller */
}

/* Açıklayıcı Metin Stili */
.setting-description {
  padding-bottom: 0.5rem; /* Çizgiyle metin arasında boşluk */
  border-bottom: 1px solid var(--code-border); /* Mevcut çizgi mantığı */
}

/* Bildirimler Sekmesinde Açıklama ile Üstteki Ayar Arasındaki Boşluk */
#bildirimler .setting-description {
  margin-top: 0.5rem;
}

.setting-description p {
  margin: 0;
  font-size: 0.8rem; /* Biraz daha büyük ve okunabilir */
  color: var(--text-color);
  line-height: 2;
}

.note-text {
  font-size: 0.8rem; /* Boyutu biraz artırdık */
  font-style: italic; /* Eğik stil ekledik */
  color: var(--accent-color);
}

.setting-description .note-text {
  font-size: 0.8rem; /* Not kısmı daha küçük */
  color: var(--accent-color); /* Hafif gri ton (örneğin #6c757d) */
}

.progress-container {
  display: flex;
  flex-direction: column;
  align-items: flex-start; /* Sağ hizalı */
  width: 100%; /* Tam genişlik */
  margin-top: 2px; /* Üst boşluk */
}

.progress-bar {
  width: 100%;
  height: 30px;
  background-color: #e0e0e0; /* Arka plan rengi */
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 5px; /* Butonla aralık */
  position: relative; /* Çocuk eleman için referans */
  padding-left: 0.5rem;
}

.progress-bar-fill {
  height: 100%;
  border-radius: 8px;
  transition: width 0.3s ease; /* Yumuşak geçiş */
  text-align: center;
  color: #fff;
  font-size: 0.8rem;
  line-height: 30px; /* Yükseklikle uyumlu */
}

body.dark .progress-bar {
  background-color: #444; /* Dark modda arka plan */
}

.progress-text {
  font-size: 0.8rem;
  color: var(--text-color-secondary, #666); /* Varsayılan renk, temana göre değişebilir */

}

body.dark .progress-text {
  color: #bbb; /* Dark modda daha açık renk */
}

/* Maddeler Listesi Stili */
.description-list {
  list-style-type: disc; /* Maddeler için yuvarlak işaret */
}

/* Maddelerin Başlık Stili */
.description-title {
  font-size: 0.8rem; /* Daha büyük font boyutu */
  font-weight: 600; /* Orta kalınlık (bold'dan daha az yoğun) */
  color: var(--text-color); /* Vurgu rengi (örneğin mavi) */
}

/* List Item Genel Stilini Güncelle (isteğe bağlı) */
.description-list li {
  font-size: 0.8rem; /* Maddelerin geri kalanı için mevcut boyut */
  color: var(--text-color); /* Metin rengi */
  line-height: 1.5; /* Satır aralığı */
  margin-bottom: 0.25rem; /* Maddeler arası boşluk */
}

/* Dark Mode için Renk Ayarları */
body.dark .description-list li {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

/* Dark Mode için Renk Ayarları */
body.dark .setting-description {
  border-bottom: 1px solid var(--code-border); /* Dark mode'da çizgi rengi */
}

body.dark .setting-description p {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

body.dark .setting-description .note-text {
  color: #adb5bd; /* Dark mode'da not için açık gri */
}

/* Sadece örnek: .settings-list, .setting-item vb. 
   Senin mevcut CSS’inde varsa dokunma, yoksa ekleyebilirsin. */

.settings-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}

.setting-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--code-border);
  /* Ekstra margin veya padding ayarlarını burada düzenleyebilirsin */
}

.setting-item label {
  font-size: 0.8rem;
  font-weight: bold;
  color: var(--text-color);
}

/* Yeni Label Stili */
.setting-label {
  font-size: 1rem;
  color: var(--text-color);
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
}

/* Textarea Güzelleştirme */
.setting-item textarea {
  width: 100%;
  max-width: 100%;
  background-color: var(--input-bg);
  color: var(--text-color);
  border: 1px solid var(--code-border);
  border-radius: 8px;
  padding: 12px; /* Artırılmış iç boşluk */
  font-size: 0.8rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  resize: none;
  box-sizing: border-box;
  font-weight: 500; /* Hafif kalın yazı */
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.setting-item textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2); /* Odaklandığında gölge artışı */
}

/* Placeholder metninin boyutunu ayarlama */
.setting-item textarea::placeholder {
  font-size: 0.8rem;
  color: var(--accent-color); /* Mevcut renk mantığını koru */
  opacity: 0.5; /* Hafif saydamlık */
}

/* Dark Mode uyumu */
body.dark .setting-item textarea::placeholder {
  color: #adb5bd; /* Dark mode'da okunabilir gri */
}

.setting-item textarea:focus::placeholder {
  opacity: 0.5;
}

/* Kaydet Butonu Güzelleştirme */
.save-btn {
  background: linear-gradient(90deg, #007bff, #0056b3); /* Gradient efekti */
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  border: none;
  transition: transform 0.3s ease, background 0.3s ease;
}

.save-btn:hover {
  background: linear-gradient(90deg, #0056b3, #003d80); /* Hover'da koyulaşma */
  transform: scale(1.05); /* Hafif büyüme */
}

.save-btn:active {
  transform: scale(0.98); /* Tıklama efekti */
}

body.dark .save-btn {
  background: linear-gradient(90deg, #0a84ff, #0066cc); /* Dark mode için gradient */
}

body.dark .save-btn:hover {
  background: linear-gradient(90deg, #0066cc, #004d99); /* Dark mode hover */
}

/* İkon Stili */
.save-icon {
  margin-right: 5px;
  vertical-align: middle;
  filter: brightness(0) invert(1); /* Dark mode'da beyaz */
}

body.dark .save-icon {
  filter: none; /* Dark mode'da orijinal renk */
}

body.dark .save-icon:hover {
  filter: brightness(0) invert(1); /* Hover'da tersine çevirme */
}

.setting-item p {
  margin: 0;
  line-height: 1.4;
}

body.dark .setting-item textarea {
  color: #fff;
  border-color: #444;
}

.save-button-container {
  display: flex;
  justify-content: flex-start; /* Buton sağa hizalı */
  margin-top: 0; /* Butonu alta yasla */
}

#save-personalization {
  background-color: transparent;
  color: #000000;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(0, 0, 0, 0.2); /* Hafif opak, ince border */
}

body.dark #save-personalization {
  border: 1px solid rgba(255, 255, 255, 0.2);
  background-color: transparent;
  color: #fff;
}

#save-personalization:hover {
  background-color: #c0c0c0;
}

body.dark #save-personalization:hover {
  background-color: #c0c0c0;
  color: #000000;
}

/* Toggle Switch (ChatGPT Benzeri) */
.switch, .toggle-btn {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 30px;
}
.switch input, .toggle-btn input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #5a5b68;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: #fff;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--primary-color);
}
input:checked + .slider:before {
  transform: translateX(18px);
}

/* Buton (Örneğin tehlikeli butonlar) */
.danger-btn {
  background-color: #ff4b4b;
  border: none;
  color: #fff;
  padding: 7px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
  align-self: flex-start;
  margin-top: 0.5rem;
  font-size: 0.8rem;
}
.danger-btn:hover {
  background-color: #ff6666;
}

/* Select (Dil seçimi vs.) */
.setting-row select {
  width: 100%;
  max-width: 200px;
  padding: 8px;
  font-size: 1rem;
  border-radius: 8px;
  border: 1px solid var(--code-border);
  background-color: var(--input-bg);
  color: var(--text-color);
  cursor: pointer;
}
body.dark .setting-row select {
  border-color: #444;
  background-color: #1e1e1e;
}
.theme-selection {
  display: flex;
  gap: 1rem; /* Butonlar arası boşluk */
  flex-wrap: wrap; /* Küçük ekranlarda veya zoomda taşmayı önler */
  justify-content: center; /* Butonları ortalar */
}

.theme-selection .theme-btn {
  cursor: pointer;
  flex: 1; /* Eşit genişlikte büyür */
  min-width: 100px; /* Minimum genişlik, sıkışmayı önler */
  max-width: 200px; /* Maksimum genişlik sınırı */
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-size: 0.8rem;
  font-weight: 600;
  box-sizing: border-box;
}
.theme-selection .theme-btn:hover,
.theme-selection .theme-btn.active {
  background-color: #c0c0c0;
}

.theme-selection .theme-btn .theme-icon {
  width: 11px;
  height: 11px;

  object-fit: contain;
}

/* Mobil ve Küçük Ekranlar */
@media (max-width: 768px) {
  .theme-selection {
    gap: 0.75rem; /* Daha az boşluk */
    flex-direction: column; /* Dikey düzen, mobil için daha temiz */
    align-items: stretch; /* Butonlar tam genişlikte */
  }

  .theme-selection .theme-btn {
    min-width: unset; /* Mobil için minimum genişlik sınırı kaldır */
    max-width: unset; /* Tam genişlikte esneklik */
    padding: 0.75rem; /* Daha fazla dokunma alanı */
  }

}

@media (max-width: 480px) {
  .theme-selection {
    gap: 0.5rem;
  }

  .theme-selection .theme-btn {
    font-size: clamp(0.75rem, 2vw, 0.875rem); /* Esnek font boyutu */
    padding: 0.5rem;
  }

  .theme-selection .theme-btn .theme-icon {
    width: 10px;
    height: 10px;
  }
}

/* Dark mod için: */
body.dark .theme-selection .theme-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: white; /* veya istediğiniz renk */
}

body.dark .theme-selection .theme-btn:hover,
body.dark .theme-selection .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .theme-selection .theme-btn .theme-icon {
  filter: invert(1);
}

body.dark .theme-selection .theme-btn.active .theme-icon,
body.dark .theme-selection .theme-btn:not(.active):hover .theme-icon {
  filter: none;
}

/* Bildirim Switch Toggle Butonu */
.notification-switch {
  position: relative;
  display: inline-block;
  /* Ebeveyn boyut: 2.5em x 1.25em */
  width: 2.5em;   
  height: 1.25em;
  vertical-align: middle;
}


.notification-switch input {
  /* Görünmez input */
  opacity: 0;
  width: 0;
  height: 0;
}

.notification-slider {
  position: absolute;
  inset: 0;                /* top:0; right:0; bottom:0; left:0; */
  cursor: pointer;
  background-color: #c0c0c0;
  transition: 0.3s;
  border-radius: 9999px;   /* Tam yuvarlak uçlar */
  overflow: hidden;        /* İç taşmaları gizle */
}

.notification-slider:before {
  position: absolute;
  content: "";
  /* Top, ebeveynin 1em'ine denk gelecek şekilde boyutlanır */
  width: 1em;
  height: 1em;
  /* Pist kenarından 0.125em boşluk bırakalım */
  left: 0.15em;
  bottom: 0.125em;
  background-color: #fff;
  border-radius: 50%;
  transition: transform 0.2s ease-in-out;
}

/* Switch açılınca arka plan rengi ve topun kayma mesafesi */
input:checked + .notification-slider {
  background-color: #10a37f; /* Veya istediğiniz renk */
}
input:checked + .notification-slider:before {
  /* Top, sağ tarafa 1em kayacak (pist genişliğinin geri kalanı kadar) */
  transform: translateX(1.2em);
}

@media (max-width: 768px) {
  .notification-switch {
    width: 2em;    /* Biraz küçültülmüş */
    height: 1em;   /* Boyutu düşürdük */
  }
  .notification-slider:before {
    width: 0.8em;
    height: 0.8em;
    left: 0.1em;
    bottom: 0.1em;
  }
  input:checked + .notification-slider:before {
    /* 2em genişlik - top (0.8em) = 1.2em kalan; 
       kenarlardan (0.1em x2) çıkarınca ~1em kayma */
    transform: translateX(1em);
  }
}


/* Dark Mode Ayarları */
body.dark .notification-slider {
  background-color: #444;
}

body.dark input:checked + .notification-slider {
  background-color: #10a37f;
}

/* Web Arama Buton Grubu */
.web-search-toggle-group {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap; /* Zoomda alt alta kayacak */
  justify-content: center; /* Ortalı hizalama */
}

/* Web Arama Butonları */
.web-search-toggle-group .web-search-btn {
  flex: 1; /* Esnek genişlik */
  min-width: 100px; /* Minimum genişlik */
  max-width: 200px; /* Maksimum genişlik */
  padding: 0.5rem; /* Sabit padding */
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-size: 0.8rem;
  font-weight: 600;
  box-sizing: border-box;
  cursor: pointer;
}

/* Hover ve aktif durum: */
.web-search-toggle-group .web-search-btn:hover,
.web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
}

/* Web Arama Butonundaki İkon */
.web-search-toggle-group .web-search-btn .web-search-icon {
  width: 14px;
  height: 14px;
  margin-right: 0.5rem;
  object-fit: contain;
}

/* Dark Mode için */
body.dark .web-search-toggle-group .web-search-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: var(--text-color);
}

body.dark .web-search-toggle-group .web-search-btn:hover,
body.dark .web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .web-search-toggle-group .web-search-btn .web-search-icon {
  filter: brightness(0) invert(1);
}

body.dark .web-search-toggle-group .web-search-btn:not(.active):hover .web-search-icon {
  filter: none;
}

.web-search-toggle-group .web-search-btn.active .web-search-icon {
  filter: none !important;
}

/* Responsive Ayarlar: Görünüm kartındaki gibi */
@media (max-width: 768px) {
  .web-search-toggle-group {
    gap: 0.75rem;
    flex-direction: column;
    align-items: stretch;
  }
  .web-search-toggle-group .web-search-btn {
    min-width: unset;
    max-width: unset;
    padding: 0.75rem;
    font-size: clamp(0.75rem, 2vw, 0.875rem);
  }
}

@media (max-width: 480px) {
  .web-search-toggle-group {
    gap: 0.5rem;
    flex-direction: column;
    align-items: stretch;
  }
  .web-search-toggle-group .web-search-btn {
    font-size: clamp(0.75rem, 2vw, 0.875rem);
    padding: 0.5rem;
  }
  .web-search-toggle-group .web-search-btn .web-search-icon {
    width: 10px;
    height: 10px;
    margin-right: 0.4rem;
  }
}

@media (max-width: 768px) {
  .card {
    padding: 10px;
  }
}

/* Tablo Stilleri */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1.5rem;
  background-color: var(--sidebar-bg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid var(--code-border);
}

th {
  background-color: var(--code-bg);
  font-weight: 600;
  color: var(--text-color);
}

td {
  color: var(--text-color);
}

tr:last-child td {
  border-bottom: none;
}

/* Dark Mode için Tablo Stilleri */
body.dark table {
  background-color: var(--input-bg);
  box-shadow: 0 2px 8px rgba(192, 192, 192, 0.1);
}

body.dark th {
  background-color: #2a2a2a;
  color: #e0e0e0;
}

body.dark td {
  color: #e0e0e0;
}

/* Responsive Tablo */
@media (max-width: 768px) {
  table {
    font-size: 1rem;
  }
  th, td {
    padding: 8px 12px;
  }
}

    /* Model Seçici */
.model-selector {
  position: fixed;
  top: 7px;
  left: 73px;
  z-index: 101;
  /* Geçiş efektini doğrudan buraya ekleyelim ki daha pürüzsüz olsun */
  transition: left 0.275s ease;
}



    .model-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: transparent;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: var(--text-color);
      font-size: 1rem;
      font-weight: 750;
      height: 40px;
      margin-top: 2px;
      width: auto;
      gap: 0.5rem;
    }
    .model-toggle-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark .model-toggle-btn:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }
    body.dark .model-toggle-btn img {
      filter: brightness(0) invert(1);
    }
    body.dark .model-toggle-btn:hover img {
      filter: none;
    }
    .model-dropdown {
      display: none;
      position: absolute;
      top: 50px;
      left: 0;
      background-color: var(--input-bg);
      border-radius: 12px;
      min-width: 175px;
      z-index: 305;
      box-shadow: 0 0 8px rgba(192, 192, 192, 0.75);
    }

    body.dark .model-dropdown {
      box-shadow: none;
    }

    .model-dropdown.show {
      display: block;
    }
    .model-option {
      display: block;
      width: 100%;
      padding: 8px 4px;
      background: transparent;
      border: none;
      border-radius: 6px;
      text-align: left;
      color: var(--text-color);
      font-size: 1rem;
      cursor: pointer;
      padding-left: 0.36rem;
    }

    .model-option:hover {
      background-color: #c0c0c0;
    }
    body.dark .model-option:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }

@media (min-width: 769px) {
  body.sidebar-open .model-selector {
    left: calc(var(--sidebar-width) + 10px);
  }
}

@media (max-width: 768px) {

  .model-dropdown {
    width: 95px;
  }
}

.model-option:hover {
  background: #c0c0c0;
}

/* Model Adı */
.model-name {
  font-size: 1rem;
  font-weight: 600;
}

/* Model Açıklaması */
.model-description {
  font-size: 0.7rem;
  color: var(--accent-color);
  font-weight: 400;
}

/* Dark Mode Hover Durumu */
body.dark .model-option:hover {
  background-color: #c0c0c0; /* Mevcut hover arka plan rengi korundu */
  color: var(--sidebar-bg); /* Model adı rengi */
}

body.dark .model-option:hover .model-name {
  color: var(--sidebar-bg); /* Model adı için özel renk */
}

body.dark .model-option:hover .model-description {
  color: var(--sidebar-bg); /* Model açıklaması için özel renk */
}

/* Dark Mode Genel Durum */
body.dark .model-description {
  color: #adb5bd; /* Normal durumda açık gri */
}

.typing-indicator {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.typing-indicator span {
  display: block;
  width: 8px;
  height: 8px;
  background-color: var(--text-color);
  border-radius: 50%;
  animation: bounce 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
  animation-delay: 0s;
}

.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes bounce {
  0%, 80%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}

/* Feedback Kontrolleri */
.feedback-controls {
  display: inline-flex;
  gap: 0.5rem;
  padding: 0;
  opacity: 0; /* Varsayılan olarak gizli */
  margin-left: -7px;
  z-index: 300; /* Chat-input’un (302) altında */
  transition: opacity 0.2s ease; /* Pürüzsüz geçiş */
}

#code-block .copy-btn,
#chat-container .feedback-controls,
#chat-container .feedback-controls * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.assistant-bubble:hover .feedback-controls {
  opacity: 1; /* Mesajın üzerine gelince görünür */
}

.assistant-bubble a {
  color: var(--text-color);
}

.feedback-controls button {
  border: none;
  background: var(--sidebar-bg);
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  color: var(--text-color);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
  z-index: 300; /* Chat-input’un altında */
  position: relative; /* Tooltip için gerekli */
  transition: background 0.2s ease; /* Hover geçişi */
}

.feedback-controls button:hover {
  background: #c0c0c0;
}

.feedback-controls button:active {
  transform: translateY(0); /* Aktif durumda hareket yok */
}

/* Dark Mode için Buton Stilleri */
body.dark .feedback-controls button {
  background: transparent; /* Dark modda arka plan şeffaf */
  color: #c0c0c0;
  box-shadow: none;
}

body.dark .feedback-controls button:hover {
  background: #c0c0c0;
}

/* İkonların Dark Mode Ayarları */
body.dark .feedback-controls button img {
  filter: brightness(0) invert(1); /* Beyaz ikonlar */
}

body.dark .feedback-controls button:hover img {
  filter: none; /* Hover’da orijinal renk */
}

/* Kopyalandı Durumu */
.feedback-controls button.copied {
  background: transparent;
  color: #004085;
}

.feedback-controls button.copied:hover {
  background: #c0c0c0;
}

.feedback-controls button.copied img {
  filter: none; /* Kopyalandı ikonunu orijinal haliyle bırak */
}

/* Animasyonlu Durumlar */
.feedback-controls button.copied,
.feedback-controls button.liked,
.feedback-controls button.disliked {
  animation: pulse 0.3s ease;
}

/* Tooltip Stilleri */
.feedback-controls button[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  background-color: #1e1e1e; /* Sabit koyu arka plan */
  color: #fff; /* Sabit beyaz metin */
  padding: 7px 7px; /* Daha geniş iç boşluk */
  border-radius: 8px;
  font-size: 0.7rem; /* Daha okunabilir font boyutu */
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  white-space: nowrap; /* Tek satırda tut */
  text-align: center; /* Metni ortala */
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, transform 0.2s ease; /* Sidebar tarzı geçiş */
  z-index: 310; /* Feedback kontrollerinden üstte */
  pointer-events: none; /* Tooltip’in hover’ı engellemesini önler */
  margin-top: 8px;
}

.feedback-controls button[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

/* Dark Mode için Tooltip Ayarları */
body.dark .feedback-controls button[data-tooltip]::after {
  background-color: var(--input-bg); /* Koyu modda biraz daha açık gri */
  color: #fff; /* Beyaz metin */
}

/* Pulse Animasyonu */
@keyframes pulse {
  0%, 50%, 100% {
    transform: scale(1);
  }
}

/* Özel Tooltip Stilleri */
[data-tooltip] {
  position: relative;
  cursor: pointer;
  z-index: 10001; /* Butonun kendi z-index’i */
}

/* Tooltip pozisyonunu ayarlama */
[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 100%; /* Butonun hemen altına */
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 8px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 500;
  white-space: nowrap;
  opacity: 0; /* Varsayılan olarak gizli */
  visibility: hidden; /* Görünmez */
  transition-property: opacity;
  transition-timing-function: ease;
  transition-delay: 0.5s;
  z-index: 10000; /* Her şeyin üstünde */
  pointer-events: none;
}

/* Hover durumunda görünüm (JS ile kontrol edilecek) */
[data-tooltip].show-tooltip::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px));
}

#file-upload-btn[data-tooltip]::after,
#web-search-btn[data-tooltip]::after,
#send-btn[data-tooltip]::after,
#voice-record-btn[data-tooltip]::after,
#voice-page-btn[data-tooltip]::after {
  left: 50%;
  top: -9px; /* Butonun üstüne yerleştir */
  transform: translateX(-50%) translateY(-100%); /* Yatayda ortala, dikeyde yukarı kaydır */
}

/* Dark Mode */
body.dark [data-tooltip]::after {
  background-color: #e0e0e0;
  color: #333;
}

/* Hover durumunda görünüm */
[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px)); /* Varsayılan transform */
}

/* Sidebar aç/kapa butonu için özel tooltip konumlandırması */
#toggle-sidebar-btn[data-tooltip]::after,
.model-toggle-btn[data-tooltip]::after {
  top: 50% !important;
  left: calc(100% + 15px) !important;
  transform: translateY(-50%) !important;
}

.settings-btn[data-tooltip] {
  position: fixed;
}

#settings-btn[data-tooltip]::after {
  top: 50% !important;
  left: calc(100% + 15px) !important;
  transform: translateY(-50%) !important;
}

/* ==============================
   BİLDİRİMLER SEKMESİ YENİ CSS
============================== */

/* Bildirimler sekmesinin ana kapsayıcısı */
.notifications-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;           /* Kartlar arasında boşluk */
}

/* Her bildirim ayarı için “kart” görünümü */
.notification-card {
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Kart üst kısmı (ikon, isim, toggle) */
.notification-header {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Sağda toggle, solda başlık+ikon */
}

/* Başlık + ikon yan yana */
.notification-heading-left{
  display:flex;
  align-items:center;
  gap:0.5rem;         /* already there – keep it */
  flex:1;             /* NEW — lets the left part shrink/wrap */
  min-width:0;        /* NEW — enables wrapping instead of overflow */
}

/* İkon boyutu */
.notification-icon {
  width: 16px;
  height: 16px;
  object-fit: contain;
  filter: none; /* Dark mod için isterseniz invert(1) ekleyebilirsiniz */
}

/* Bildirim ayarının adı */
.notification-name {
  font-size:0.8rem;   /* already there */
  font-weight:600;    /* already there */
  white-space:normal; /* NEW — allow line-wrap */

}
/* Açıklama metni */
.notification-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

.notification-divider {
  margin: 1rem 0 1rem;
  border: none;
  border-top: 1px solid var(--line, #e5e7eb); /* fallback açık gri */
}

/* Dark mode düzenlemeleri */
body.dark .notification-card {
  background-color: var(--sidebar-bg); /* Ör: #1e1e1e */
  border-color: #444;
}

body.dark .notification-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak için */
}

/* GENEL SEKMESİ (Kart Mantığı) */
.general-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  box-sizing: border-box;
}

/* Kart Yapısı */
.general-card {
  width: 100%;
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  box-sizing: border-box;
}

/* Kart üst kısmı (ikon + başlık) */
.general-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Sol tarafta ikon + başlık ismi */
.general-heading-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* İkon boyutu */
.general-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
}

/* Ayar adı (ör. "Görünüm", "Web Arama", "Dil Seçimi") */
.general-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
}

/* Açıklama metni */
.general-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

/* Dark Mode Düzenlemeleri */
body.dark .general-card {
  background-color: var(--sidebar-bg);
  border-color: #444;
}

body.dark .general-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak isterseniz */
}

/* Dropdown (Select) Stili */
.language-selection select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: bold;
  background-color: #c0c0c0;
  color: var(--text-color);
  transition: border-color 0.3s ease;
  box-sizing: border-box;
  -webkit-appearance: none;
  -moz-appearance:    none;
  appearance:         none;
  /* 2) Sağda yer tutucu boşluk bırak */
  padding-right: 2.5em;
  /* 3) Arkaya kendi arrow ikonunuzu koyun */
  background: url("icons/arrow_down.png") no-repeat;
  background-position: calc(100% - 8px) center;
  background-size: 12px;
  cursor: pointer;
}

/* Dark Mode için */
body.dark .language-selection select {
  background-color: #c0c0c0;
  border-color: #444;
  color: #000000;
}

/* Personalization (Statik Prompt) Girişi */
.personalization-input textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background-color: var(--input-bg);
  color: var(--text-color);
  resize: none;
  box-sizing: border-box;
}

.personalization-input textarea:focus {
  outline: none;
  border-color: var(--primary-color);
}

body.dark .personalization-input textarea {
  background-color: var(--input-bg);
  border-color: #444;
  color: #e0e0e0;
}

body.dark .theme-btn {
  background-color: var(--bg-color);
  border-color: #444;
  color: white;
}
body.dark .theme-btn:hover,
body.dark .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

.data-control-card {
  display: flex;
  flex-direction: column; /* İçerik dikey olarak dizilsin */
  padding: 16px; /* Daha geniş iç boşluk */
  background-color: var(--input-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.data-control-card .description-list {
  display: block;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.data-control-card .danger-btn {
  margin: 10px 0; /* Butonun üstünde ve altında boşluk */
  align-self: flex-start; /* Sola hizalı */
}

.data-control-card p {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-color);
}

body.dark .data-control-card {
  background-color: #1e1e1e;
  border-color: #444;
  box-shadow: 0 2px 4px rgba(255, 255, 255, 0.05);
}

.general-count {
  font-size: 1rem;
}

/* File Upload Button */
.file-upload-btn {
  position: fixed;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  bottom: 15px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 10px; /* Butonu soldan 10px sağa kaydırır */
  margin-right: 10px; /* Space between file upload and web search buttons */
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

.file-upload-btn:hover {
  background-color: #c0c0c0;
}

body.dark .file-upload-btn img {
  filter: brightness(0) invert(1);
}

body.dark .file-upload-btn:hover img {
  filter: none;
}

/* File Container */
.file-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  width: 100%;
  max-width: 760px;
  margin: 0 auto;
  box-sizing: border-box;
  max-height: 200px;
  overflow-y: hidden;
  align-items: flex-start;
  flex-direction: row;
}

/* Individual File Box */
.file-box {
  display: flex;
  align-items: center;
  background-color: var(--input-bg);
  border: 1px solid var(--code-border);
  border-radius: 8px;
  padding: 0.4rem 0.4rem;
  margin-bottom: 0.15rem;
  margin-left: 0.60rem;
  flex: 0 0 auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.file-box:last-child {
  margin-bottom: 0.65rem;
}

body.dark .file-box {
  background-color: #303030;
  border-color: #444;
}

.file-icon {
  width: 20px;
  height: 20px;
  margin-right: 0.5rem;
}



.file-name {
  font-size: 0.8rem;
  color: var(--text-color);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.remove-file-btn {
  background: none;
  border: none;
  cursor: pointer;
  margin-left: 8px;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-file-btn img {
  width: 16px;
  height: 16px;
}

body.dark .remove-file-btn img {
  filter: brightness(0) invert(1);
}

body.dark .remove-file-btn:hover img {
  filter: brightness(0) invert(1);
}

/* Drop zone penceresi */
.drop-zone {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  padding: 20px;
  background-color: rgba(255, 255, 255, 0.95); /* Hafif şeffaf beyaz */
  border: 2px dashed #007bff; /* Kesikli mavi çerçeve */
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000; /* En üstte olsun */
  display: none; /* Normalde gizli */
  transition: opacity 0.3s ease;
}

.drop-zone.active {
  display: block; /* Sürükleme sırasında görünür */
  opacity: 1;
}

.drop-zone p {
  margin: 10px 0;
  font-size: 1.2rem;
  color: #333;
}

.drop-zone .subtext {
  font-size: 1rem;
  color: #666;
}

/* Dark mod uyumluluğu */
body.dark .drop-zone {
  background-color: rgba(50, 50, 50, 0.95); /* Koyu tema için */
  border-color: #1e90ff;
}

body.dark .drop-zone p {
  color: #fff;
}

body.dark .drop-zone .subtext {
  color: #ccc;
}

#voice-record-btn {
  position: absolute; /* Chat-input'a göre konumlanacak */
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  align-self: flex-end;
  justify-content: center;
  right: 70px; /* Chat-input'un sağından 10px içeride */
  bottom: 15px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}


#voice-record-btn:hover {
  background-color: #c0c0c0;
}

#voice-record-btn.recording {
  background-color: #f44336; /* Kayıt sırasında kırmızı */
}

body.dark #voice-record-btn img {
  filter: brightness(0) invert(1);
}

body.dark #voice-record-btn:hover img {
  filter: none;
}

body.dark #voice-record-btn.recording img {
  filter: brightness(0) invert(1);
}

.chat-history-title.edit-input {
  width: 80%;
  color: #000 !important;
}

.language-selection hr {
  margin-bottom: 1rem;
  margin-top: 1rem;
}

.credentials-container label {
  font-size: 0.8rem;
}

.credential-input {
  margin-bottom: 10px;
}

.credential-input label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
}

.credential-input input {
  width: 100%;
  padding: 7px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.credential-save-btn {
  padding: 8px 16px;
  background-color: #10a37f;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.credential-save-btn:hover {
  background-color: #45a049;
}

.voice-options {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
  margin-top: 0.5rem;
}

.voice-option {
  display: flex;
  align-items: center;
  gap: 10px;
}

.voice-check-btn {
  max-height: 28px;
  min-height: 28px;
  max-width: 100px;
  min-width: 100px;
  background-color: #10a37f;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.8rem;
}

.voice-check-btn:hover {
  background-color: #0056b3; /* Daha koyu mavi */
}

.voice-description {
  margin: 0;
  flex: 1; /* Kalan alanı doldurur */
}

/* Responsive: Ekran genişliği 768px ve altı için */
@media (max-width: 768px) {
  .voice-option {
    flex-direction: column;
    align-items: flex-start;
  }
  .voice-check-btn {
    width: 100%;
    max-width: none;
  }
}

/* Daha küçük ekranlar (480px altı) için de aynı ayarlar uygulanabilir */
@media (max-width: 480px) {
  .voice-option {
    flex-direction: column;
    align-items: flex-start;
  }
  .voice-check-btn {
    width: 100%;
    max-width: none;
  }
}

p.voice-description {
  font-size: 0.8rem;
}

.general-description p:last-child {
  margin-bottom: 0;
}

ul.description-list {
  margin-top: 0;
  margin-bottom: 0;
}

button.theme-btn {
  border-radius: 12px;
  padding: 0.5rem;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
      align-items: center;
      justify-content: center;
}

/* Ortak alan */
.prompt-selection {
  display:flex;
  flex-wrap:wrap;
  gap:1rem;
  margin-bottom:0.5rem;
}

/* Tema butonu varsayılanı (desktop & tablet) */
.prompt-selection .theme-btn{
  flex:1 1 180px;       /* esnek ama 180 px’den küçük olma */
  min-width:180px;
}

.prompt-selection .theme-btn.active{
  background:#c0c0c0;      /* hover ile aynı gri */
  color:var(--text-color); /* koyu modda siyah, açıkta beyaz görünsün */
}

body.dark .prompt-selection .theme-btn.active{
  background:#c0c0c0;
  color:var(--sidebar-bg);
}

/* ---------- Mobil breakpoint ---------- */
@media (max-width:600px){
  .prompt-selection .theme-btn{
    flex:1 1 120px;     /* satıra 2 veya 3 buton sığsın */
    min-width:120px;    /* daha dar izin ver */
  }
}

/* Çok dar ekran (<360 px) istersen ekstra kural ekle */
@media (max-width:360px){
  .prompt-selection .theme-btn{
    flex:1 1 100px;
    min-width:100px;
  }
}

button.theme-btn:hover {
  background: #c0c0c0;
}

  .connect-btn {
    background-color: transparent;
    color: var(--text-color);
    font-weight: 600;
    border: 1px solid #c0c0c0;
    border-radius: 8px;
    padding: 3.4px 6px;
    cursor: pointer;
    font-size: 0.65rem;
  }
  .connect-btn:hover {
    background-color: #c0c0c0;
  }

  body.dark .connect-btn:hover {
    color: var(--sidebar-bg);
  }

#gmail-profile-photo {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid var(--primary-color);
  transition: transform 0.2s ease;
}

#gmail-profile-photo:hover {
  transform: scale(1.1);
}

.danger-btn {
  background-color: var(--danger-color);
  border: none;
  color: #fff;
  padding: 7px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.danger-btn:hover {
  background-color: #ff6666;
}

body.dark .danger-btn {
  background-color: var(--danger-color);
}

body.dark .danger-btn:hover {
  background-color: #ff6666;
}

.setting-row.select {
  width: 100%;
  max-width: 300px; /* Dropdown genişliğini sınırlıyoruz */
  padding: 8px;
  font-size: 0.8rem;
  border-radius: 8px;
  border: 1px solid var(--code-border);
  background-color: var(--input-bg);
  color: var(--text-color);
  cursor: pointer;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}

body.dark .setting-row.select {
  border-color: #444;
  background-color: #1e1e1e;
  color: #fff;
}

/* Kartlar arasında boşluk */
.general-card + .general-card {
  margin-top: 1rem; /* Kartlar arasında dikey boşluk */
}

.summary-actions-container {
  display: flex;
  align-items: center;
  gap: 0.5rem; /* Dropdown ile butonlar arasında boşluk */
}

.summary-actions {
  display: flex;
  gap: 0.25rem; /* Butonlar arasında boşluk */
  opacity: 1; /* Varsayılan olarak görünür, ama devre dışıysa soluk olacak */
}

.summary-actions button:disabled {
  opacity: 0.3; /* Devre dışı butonlar soluk görünür */
  cursor: not-allowed; /* İmleç devre dışı olduğunu gösterir */
}

.summary-text {
  font-style: italic; /* Özet metnini biraz farklı gösterelim */
}



.code-block-container pre {
  background: var(--code-bg);
  padding: 16px;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  color: var(--code-text);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  user-select: none; /* Kodun seçilmesini engeller */
  pointer-events: none; /* Tıklanmasını ve düzenlenmesini engeller */
}

body.dark .code-block-container pre {
  background: var(--code-bg);
  border-color: #333;
  color: var(--code-text);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
}

.system-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
  margin-right: 10px;
}

/* Ensure the tooltip for new-chat-btn appears to the right when sidebar is closed */
body:not(.sidebar-open) .new-chat-btn[data-tooltip]::after {
  left: calc(100% + 15px) !important; /* Position it to the right of the button */
  right: auto !important;             /* Override the existing right positioning */
  top: 50% !important;                /* Vertically center it */
  transform: translateY(-50%) !important; /* Adjust for vertical centering */e
}

/* Style for the new voice page button */
#voice-page-btn {
  position: absolute; /* Chat-input'a göre konumlanacak */
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  align-self: flex-end;
  justify-content: center;
  right: 17.85px; /* Chat-input'un sağından 10px içeride */
  bottom: 15px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}


#voice-page-btn:hover {
  background-color: #c0c0c0;
}

body.dark #voice-page-btn img {
  filter: brightness(0) invert(1);
}

body.dark #voice-page-btn:hover img {
  filter: none;
}

/* Fade-out animation */
@keyframes fadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

.fade-out {
  animation: fadeOut 0.5s ease forwards;
}


.sidebar-search-wrapper {
  display: flex;
  align-items: center;
  padding-top: 0.5rem ;
  gap: 0.5rem;
}

.sidebar-search-container {
  width: 100%;           /* Ebeveynin (sidebar) tamamına uyar */
  max-width: 100%;       /* Genişlik asla sidebar'ı aşmaz */
  box-sizing: border-box;  /* Padding ve border genişliğe dahil edilir */
  display: flex;
  align-items: center;
  padding: 5px;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  height: 50px;
  background-color: var(--input-bg);
  position: absolute;
  top: -30%;
  left: 510%;
}

#sidebar-search-input {
  width: 100%;
  max-width: 100%;
  flex: 1;
  border: none;
  outline: none;
  font-size: 1rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background-color: transparent;
  color: var(--text-color);
}

.sidebar-search-close {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 1rem;
  cursor: pointer;
}

/* Chat Search Modal Stilleri */
.chat-search-modal-content {
  background-color: var(--sidebar-bg);
  width: 90%;
  max-width: 700px;
  min-height: 94vh;
  margin: 3vh auto;
  border-radius: 3vh;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

#chat-search-modal {
  display: none;
  position: fixed;
  z-index: 306;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease;
}

.chat-search-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 5px;
  padding-top: 10px;
  background-color: var(--nav-bg);
  border-bottom: 2px solid #c0c0c0;
  margin-bottom: 10px;
}

.chat-search-header h2 {
  font-size: 1.1rem;
  color: var(--text-color);
}

.chat-search-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding-top: 10px;
}

.chat-search-input-wrapper {
  display: flex;
  align-items: center;
  padding: 1rem;
  border: 1px solid var(--code-border);
  border-radius: 12px;
  background-color: var(--input-bg);
  margin-bottom: 0.5rem;
}

#chat-search-input {
  width: 100%;
  border: none;
  outline: none;
  font-size: 1rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background-color: transparent;
  color: var(--text-color);
}

#chat-search-results {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: calc(80vh - 100px); /* Arama çubuğu ve kapatma butonu için boşluk */
  overflow-y: auto; /* Çok başlık varsa kaydırma */
  scrollbar-width: thin;
  scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
}

#chat-search-results::-webkit-scrollbar {
  width: 6px;
}

#chat-search-results::-webkit-scrollbar-track {
  background: transparent;
}

#chat-search-results::-webkit-scrollbar-thumb {
  background-color: rgba(85, 85, 85, 0.2);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

#chat-search-results::-webkit-scrollbar-thumb:hover {
  background-color: rgba(85, 85, 85, 0.5);
}

.chat-search-result-item {
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--code-border);
  color: var(--text-color);
  font-size: 1rem;
}

.chat-search-result-item:hover {
  background-color: #c0c0c0;
  border-radius: 12px;
}

body.dark .chat-search-result-item:hover {
  background-color: #333;
}

.chat-search-result-item.active {
  background-color: #c0c0c0;
  font-weight: 600;
  border-radius: 12px;
}

body.dark .chat-search-result-item.active {
  background-color: #c0c0c0;
}

.search-item-title {
  font-size: 1.1rem;      /* Başlıklar biraz daha büyük görünsün */
  font-weight: bold;
  margin-bottom: 4px;
}

.search-item-snippet {
  font-size: 0.9em;     /* Sonuç metni (snippet) biraz daha küçük olsun */
  color: #666;
}

#chat-search-close {
  position: absolute; /* BU EN ÖNEMLİSİ */
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--sidebar-bg);  /* Örn: beyaz veya açık gri */
  border: none;
  width: 40px;
  height: 40px;
  top: 22px;
  right: 12px;
  border-radius: 50%; /* DAİRE YAPAR */
  cursor: pointer;
  color: var(--text-color);
  font-size: 1.2rem; /* X boyutu */
  font-weight: bold;
}

#chat-search-close:hover {
  background-color: #c0c0c0;
}

body.dark #chat-search-close:hover {
  background-color: #c0c0c0; /* Dark modda sidebar rengi */
  color: var(--sidebar-bg);
}


/* Mobil Uyumluluk */
@media (max-width: 768px) {
  .chat-search-modal-content {
    margin: 0;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 80vh;
    border-radius: 12px 12px 0 0;
    overflow-y: auto;
  }

  #chat-search-close {
    top: 19px;
  }
}

body.modal-active #sidebar-search-toggle {
  filter: blur(4px) !important;
  pointer-events: none !important;
}

.sidebar-search-toggle.blurred {
  filter: blur(3px);
  pointer-events: none;
  transition: filter 0.3s ease;
  opacity: 0.8;
}

/* Başlangıçta opaklık 0 */
#chat-title {
  opacity: 0;
}

/* Akıcı fade-in animasyonu */
@keyframes fadeInSmooth {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Fade-in sınıfı: 0.5s süreyle opacity 0'dan 1'e */
.fade-in {
  animation: fadeInSmooth 0.5s ease forwards;
}

.mic-test-section {
  margin-top: 2rem;
  background-color: var(--card-bg);
  padding: 1rem;
  border-radius: 16px;
  box-shadow: var(--shadow);
}

.mic-title {
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.mic-description {
  font-size: 0.95rem;
  color: var(--sub);
  margin-bottom: 1rem;
}

.mic-visualizer {
  width: 100%;
  height: 30px;
  background-color: #ddd;
  border-radius: 5px;
  overflow: hidden;

}

.mic-bar {
  width: 0%;
  height: 100%;
  background-color: #10b981; /* Başlangıçta yeşil */
  transition: width 0.1s linear, background-color 0.2s ease;
}

.mic-test-btn {
  padding: 0.5rem 1rem;
  border: none;
  background-color: var(--accent);
  color: #fff;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
}

body.dark .mic-visualizer {
  background-color: #333;
}

body.dark .mic-bar {
  background-color: #4ade80;
}

.theme-filter-btn {
  background-color: none;
  border: none;
  cursor: pointer;
}

/* Varsayılan (light mode için) */
.theme-filter-btn img {
  filter: none;
}

/* Dark modda filtre uygula */
body.dark .theme-filter-btn img {
  filter: invert(1);
}

.help-btn {
  position: fixed;
  bottom: 45px;      /* settings-btn ile aynı hizada */
  left: 10px;   /* Ayarlar butonundan (right:10px) solda konumlanacak, bu değeri ihtiyaca göre ayarlayın */
  border: none;
  background: none;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.3s ease, color 0.3s ease;
  color: var(--text-color);
  width: 40px;
  height: 40px;
  z-index: 302;
}

.help-btn img {
  width: 20px;
  height: 20px;
  pointer-events: none;
}

.help-btn:hover {
  background-color: #c0c0c0;
}

body.dark .help-btn img {
  filter: brightness(0) invert(1);
}

body.dark .help-btn:hover {
  background-color: #c0c0c0;
}

body.dark .help-btn:hover img {
  filter: none;
}

/* Dropdown Menü */
.help-dropdown {
  position: fixed;
  top: 9px; /* Help butonunun üstüne denk gelecek */
  right: 133px;
  background-color: var(--input-bg);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  display: none; /* Başlangıçta gizli */
  flex-direction: column;
  z-index: 306;
  width: 150px;
}

.help-item {
  background: none;
  border: none;
  text-align: left;
  width: 100%;
  padding: 0.8rem;
  font-size: 0.8rem;
  cursor: pointer;
  color: var(--text-color);
  border-radius: 12px;
}

.help-item:hover {
  background-color: #c0c0c0;
}

body.dark .help-dropdown {
  background-color: #343434;
}

body.dark .help-item:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

#confirm-modal .modal-content {
  background: var(--sidebar-bg);
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  width: 90%;
  max-width: 400px;
}
#confirm-message {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 1rem;
}

.header-toast {
  position: absolute;         /* .top-bar’a göre */
  top: 57px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-color); /* JS’te istediğin renkle ezilir */
  color: var(--sidebar-bg);
  padding: 0.5rem;
  font-weight: 600;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,.2);
  z-index: 1000;
  animation: fadeInOut 2s ease forwards;   /* Mevcut animasyonu kullan */
  pointer-events: none;       /* Tıklamayı engelleme */
}

/* Üst başlık (yazı + master switch) */
.notification-master-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:0.1rem;            /* yazı ile çizgi arasında 0.1 rem */
}

/* Yazı istersek biraz vurgulu dursun */
.notification-master-title {
  font-size:1rem;
  font-weight:600;
}

/* İnce çizgi */
.notification-divider {
  border:0;
  border-top:1px solid var(--text-color, var(--text-secondary));
  margin:0 0 0.25rem 0;               /* çizgi ile kartlar arası rahat nefes */
}

.master-notification-card {
  border: 1px solid var(--secondary);   /* sidebar’da kullandığın koyu ton */
  padding: 0;
  padding-right: 1rem;
}

.personalization-header{
  margin-bottom:1rem;      /* karttan önce küçük boşluk */
}

.progress-actions {
  display: flex;
  gap: 0.5rem;
  justify-content: flex-start;
}

@media (max-width: 768px){
  .progress-actions{
    flex-direction: column;   /* yatay → dikey */
    align-items: stretch;     /* butonları tam genişlet */
    width: 100%;
  }

  .progress-actions .danger-btn{
    width: 100%;              /* her buton satırı doldursun */
  }
}

@media (max-width: 768px){
  pre,
  pre > code,
  .code-block,
  .code-editor{
    max-height: 50vh;                 /* ekranın yarısını geçmesin */
    overflow: auto;                   /* hem dikey hem yatay scroll */
    -webkit-overflow-scrolling: touch;/* iOS’ta akıcı kaydırma */
    touch-action: pan-x pan-y;        /* dokunmayı engelleyen yok */
    pointer-events: auto;             /* olası üst katman engelini aş */
    cursor: grab;                     /* Android’de “tut” hissi verir */
  }
}

/* Varsayılan görünüm (masaüstü): yan yana */
#security-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Mobil görünüm (768px ve altı): buton aşağı insin */
@media (max-width: 480px) {
  #security-header {
    flex-direction: column;
    align-items: flex-start;
  }

  #login-btn.connect-btn {
    width: 100%;
    margin-top: 0.5rem;
  }

  #security-header .connect-btn {
    width: 100%;
  }
}

.password-field{
  position:relative;
  display:flex;
  align-items:center;
}

.password-field input{
  flex:1;
  padding-right:36px;          /* ikon için boşluk */
}

.toggle-icon{
  width:22px;
  height:22px;
  cursor:pointer;
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  user-select:none;
}

/* Sadece hover destekleyen (mouse) ortamlarda 3-nokta gizlensin */
@media (hover:hover) {
  .more-options-btn           { display:none;  opacity:0; }
  .chat-history-item:hover .more-options-btn {
    display:block; opacity:1;
  }
}

/* Dokunmatik (hover:none) cihazlarda buton daima görünsün */
@media (hover:none) {
  .more-options-btn           { display:block; opacity:1; }
}

@media (hover:none) {
  .chat-history-item:active   { background:#c0c0c0; }
}

/* ==========================================
   < 768 px ekranda: tooltip de yok, hover da yok
   ========================================== */
@media (max-width: 768px) {

  /* 1. Tooltip’i tamamen kapat
     - Tooltip’i pseudo-element ile gösteriyorsan */
  [data-tooltip]::after,
  [data-tooltip]:hover::after,
  [data-tooltip]:focus::after {
    display: none !important;
    content: none !important;
  }

  /* Eğer tooltip’i ayrı bir .tooltip kutusuyla gösteriyorsan */
  .tooltip, .tooltip-show {         /* sen hangi sınıfı kullanıyorsan */
    display: none !important;
    pointer-events: none !important;
  }
}

/* ===== Mini drop görünürlüğü ===== */
@media (max-width: 337px) {
  /* Eski üç butonu gizle */
  #file-upload-btn,
  #web-search-btn   { display:none !important; }

  /* Mini birleşik buton göster */
  #mini-drop-btn    { display:inline-flex !important; }
}

/* ===== Dropdown tasarımı ===== */
.mini-dropdown {
  position:absolute;
  left: 17px;   /* butonun sağında açılacak */
  bottom: 52px;
  background: var(--input-bg);
  border: 1px solid var(--accent);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,.3);
  display:none;
  flex-direction: column;
  z-index: 1000;
}

.mini-item {
  display:flex;
  align-items:center;
  gap:4px;
  padding:4px 10px;
  background:none;
  color:var(--text-primary);
  border:none;
  cursor:pointer;
  font-size: 0.8rem;
}

.mini-item:hover {
  background: #c0c0c0;
  border-radius: 8px;
}

body.dark .mini-item:hover {
  background: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .mini-item img {
  filter: brightness(0) invert(1); /* Matches dark mode icon behavior */
}

body.dark .mini-item:hover img {
  filter: none; /* Matches hover behavior of other buttons */
}

.mini-drop-btn {
  position: fixed;
  bottom: 15px;
  left: 17px;
  z-index: 200;
  background-color: transparent;
  border: none;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15),
              4px 0 6px -2px rgba(0, 0, 0, 0.15),
              -4px 0 6px -2px rgba(0, 0, 0, 0.15),
              0 -4px 6px -2px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 35px;
  border-radius: 12px;
  color: var(--text-color);
}

body.dark .mini-drop-btn {
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15),
              4px 0 6px -2px rgba(0, 0, 0, 0.15),
              -4px 0 6px -2px rgba(0, 0, 0, 0.15),
              0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark .mini-drop-btn img {
  filter: brightness(0) invert(1); /* Matches dark mode icon behavior */
}

body.dark .mini-drop-btn:hover img {
  filter: none; /* Matches hover behavior of other buttons */
}

body.dark .mini-drop-btn:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

.chat-input #page-down-btn {
  position: fixed;
  bottom: calc(100% + 8px);
  right: calc(50% - 14px);
  width: 28px;
  height: 28px;
  background: var(--bg-color);
  border: solid 1px #c0c0c0;
  border-radius: 16px;
  padding-left: 4px;
  padding-right: 3.25px;
  cursor: pointer;
  pointer-events: none;
  opacity: 0;
  z-index: 303;
  transform: translateY(5px);
  transition: transform 0.3s ease;     /* sadece kayma animasyonu kalsın */
}
.chat-input #page-down-btn.visible {
  pointer-events: auto;
  opacity: 1;
  transform: translateY(0);
}
.chat-input #page-down-btn img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}
body.dark .chat-input #page-down-btn img {
  filter: invert(1) brightness(0.8);
}

.help-item img {
  width: 17px;
  height: 17px;
  vertical-align: middle;
}

body.dark .help-item img {
  filter: invert(1);
}

body.dark .help-item:hover img {
  filter: invert(0);
}

#terms-modal .modal-content,
#privacy-modal .modal-content {
  padding: 1.2rem;           /* tüm içerik etrafına boşluk */
  border-radius: 1rem;     /* köşeleri yuvarla */
  color: var(--text-color);
  font-size: 0.8rem;
  line-height: 1.6;        /* satır yüksekliği */
  max-height: 80vh;        /* keep the card on screen          */
  overflow-y: auto;        /* card scrolls, backdrop doesn’t   */
}

#terms-modal h2,
#privacy-modal h2 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 20px;
  padding-top: 10px;
  background-color: var(--nav-bg);
  border-bottom: 2px solid #c0c0c0;
  margin-bottom: 10px;
  font-size: 1.1rem;
}

#terms-modal a,
#privacy-modal a {
  color: var(--text-color);
  font-weight: 600;
}

/* Ortak ikon stili */
.like-icon,
.dislike-icon,
.copy-icon,
.regen-icon {
  display: inline-block;
  width: 16px;
  height: 16px;
  background-size: contain;
  background-repeat: no-repeat;
  user-select: none;      /* Seçilemesin   */
  -webkit-user-drag: none;/* Sürüklenemesin*/
}

/* İlk hâli */
.like-icon  { background-image: url("icons/like_btn.png");   }
.dislike-icon { background-image: url("icons/dislike_btn.png"); }
.copy-icon { background-image: url("icons/copy_btn.png");   }
.regen-icon { background-image: url("icons/regenerate_btn.png");   }

/* Tıklanınca değişecek sınıf */
.like-icon.liked      { background-image: url("icons/liked_btn.png");    }
.dislike-icon.disliked{ background-image: url("icons/disliked_btn.png"); }
.copy-icon.copied { background-image: url("icons/copied_btn.png"); }

body.dark .like-icon,
body.dark .dislike-icon,
body.dark .copy-icon,
body.dark .regen-icon {
  filter: invert(1);
}

/* Dark modda buton üzerine gelince invert etkisini kaldır */
body.dark .like-btn:hover .like-icon   { filter: invert(0) !important; }
body.dark .dislike-btn:hover .dislike-icon { filter: invert(0) !important; }
body.dark .copy-btn:hover .copy-icon { filter: invert(0) !important; }
body.dark .regen-btn:hover .regen-icon { filter: invert(0) !important; }

#chat-container .code-block .copy-btn,
#chat-container .code-block .copy-btn * {
  user-select: none !important;
  -webkit-user-drag: none !important;
}

.code-header,
.code-header * {
  user-select: none !important;
  -webkit-user-drag: none !important;
}

/* user-bubble içindeki eklenen görselleri sabit boyutlandırmak için */
.chat-bubble.user-bubble .attachment-img {
  margin-top: 1rem;
  border-radius: 12px;
  width: 100%;           /* kapsayıcıya göre ölçeklensin */
  height: auto;          /* orantılı kalsın */
  object-fit: contain;   /* taşma olmasın, boşluk bıraksın */
  display: block;        /* alt alta dizilsin */
  margin-bottom: 0.5rem; /* metin ile arada boşluk */
  -webkit-user-drag: none !important;
  cursor: pointer;
}
.modal-img-container {
  position: relative;
  display: inline-block;
}

.image-modal {
  overflow-y: auto;
  z-index: 999999;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.93);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 0;
  box-sizing: border-box;
}

.image-modal[aria-hidden="false"],
.image-modal.open { /* aktif olduğunda görünür olsun */
  display: flex;
}

.image-modal__container {
  position: relative;
  display: flex;
  top: 21vh;
  left: 50%;
  align-items: center;
  justify-content: center;
  max-height: 100vh;
  width: 0;
  height: auto;
}

.image-modal__img {
  max-width: 60vw;
  max-height: 60vh;
  width: auto;
  height: auto;
  display: block;
  object-fit: contain;
  user-select: none;
  -webkit-user-drag: none;
}

@media (max-width: 600px) {
  .image-modal__container {
    max-width: 60vw;
    max-height: 60vh;
  }
  .image-modal__img {
    max-width: 60vw;
    max-height: 60vh;
  }
}








/* YENİ: Web'de Aranıyor Animasyonu */
.searching-indicator {
  position: relative;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-color);
  overflow: hidden; /* Animasyonun yazı dışına taşmasını engeller */
}

.searching-indicator::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%; /* Animasyon başlangıcında solda, görünmez alanda */
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  animation: slide-shine 2.5s infinite; /* Animasyonu tanımla */
}

/* Koyu modda parlamanın rengini biraz ayarlayalım ki daha güzel görünsün */
body.dark .searching-indicator::after {
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
}


/* Animasyonun kendisi (soldan sağa kayma) */
@keyframes slide-shine {
  0% {
    left: -100%;
  }
  50% {
    left: 100%;
  }
  100% {
    left: 100%;
  }
}


  </style>
</head>

<body>


<!-- Yeni Model Seçme Alanı -->
<div id="model-selector" class="model-selector">
  <button id="model-toggle-btn" class="model-toggle-btn" data-tooltip="Model seç">
    <span id="current-model-name">quik-est</span>
    <img src="icons/arrow_down.png" alt="Dropdown" class="dropdown-arrow" style="width: 12px; height: 12px; margin-right: 3px;" draggable="false">
  </button>
  <div id="model-dropdown" class="model-dropdown">
    <button class="model-option" data-model="quik-est">
      <span class="model-name">quik-est</span>
      <div>
        <span class="model-description">Günlük sorulara hızlı yanıtlar</span>
      </div>
    </button>
    <button class="model-option" data-model="quik-think">
      <span class="model-name">quik-think</span>
      <div>
        <span class="model-description">Akıl yürütme yoluyla çözümler</span>
      </div>
    </button>
  </div>
</div>


  <div id="app">
  <!-- Sidebar -->

  <!-- Sabit Toggle Sidebar Butonu -->
  <button id="toggle-sidebar-btn">
    <img src="icons/sidebar_close_btn.png" alt="Sidebar Icon" style="width:24px; height:21px;" draggable="false">
  </button>


<div id="tiny-sidebar" class="tiny-sidebar">
  <!-- toggle-sidebar-btn, new-chat-btn, sidebar-search-toggle buraya taşınacak (JS ile) -->



<button id="new-chat-btn" data-tooltip="Yeni Sohbet" class="new-chat-btn">
  <img src="icons/new_chat_btn.png" alt="Chat Icon" style="width:21px; height:21px;" draggable="false">
  <span class="btn-text">Yeni Sohbet</span>
</button>





<!-- Kullanım Şartları ve Gizlilik Politikası Modali -->
<button id="help-btn" class="help-btn" data-tooltip="Yardım">
  <img src="icons/question_icon.png" alt="Yardım" draggable="false">
</button>

<!-- Ayarlar Butonu -->
<button id="settings-btn" data-tooltip="Ayarlar" class="settings-btn">
  <img src="icons/settings_icon.png" alt="Settings Icon" style="width:24px; height:21px;" draggable="false">
</button>

</div>

  <div id="sidebar" class="sidebar">
<div class="sidebar-header">

<!-- Sidebar içinde, chat-history-list'ten önce eklenebilir -->
<div class="sidebar-search-wrapper">



</div>

  <span class="brand" id="sidebar-brand">
    <img src="icons/quik_icon.png" alt="Quik Logo" id="sidebar-brand-icon" draggable="false">
  </span>
</div>

<button id="sidebar-search-toggle" data-tooltip="Sohbet Ara" class="sidebar-search-toggle">
  <img src="icons/search_icon.png" alt="Ara" style="width:20px; height:20px;" draggable="false">
  <span class="btn-text">Sohbet Ara</span>
</button>



    <ul id="chat-history-list" class="chat-history-list"></ul>

  <div class="sidebar-ender">

<!-- Kullanım Şartları ve Gizlilik Politikası Modali -->
<button id="help-btn" class="help-btn" data-tooltip="Yardım">
  <img src="icons/question_icon.png" alt="Yardım" draggable="false">
</button>

<!-- Ayarlar Butonu -->
<button id="settings-btn" data-tooltip="Ayarlar" class="settings-btn">
  <img src="icons/settings_icon.png" alt="Settings Icon" style="width:24px; height:21px;" draggable="false">
</button>

  </div>

  </div>
  
  <!-- Main İçerik -->
  <div class="main-content">
<div class="top-bar">
  <!-- Diğer top bar içerikleri varsa burada kalabilir -->
  <div id="chat-title" class="top-bar-title">
</div>
</div>

    
    <div class="scroll-wrapper">
      <div id="chat-container" class="chat-container">
<div id="welcome-message" class="welcome-message" ondragstart="return false;" draggable="false">
  <div class="logo-container">
  </div>

  <h1>Nasıl yardımcı olabilirim?</h1>
</div>

        <!-- Diğer mesajlar buraya eklenir -->
      </div>
    </div>
  </div>
</div>


<!-- Chat Input kısmı -->
<div class="chat-input">
<button id="page-down-btn">
  <img src="icons/page_down_btn.png" alt="Sayfanın en altına git" />
</button>

  <div class="file-container" id="file-container"></div> <!-- Container for uploaded files -->
  <button class="file-upload-btn" id="file-upload-btn" data-tooltip="Dosya Ekle">
    <img src="icons/addfile_btn.png" alt="Add File Icon" style="width:20px; height:20px;" draggable="false">
  </button>
  <button id="web-search-btn" data-tooltip="Web Araması">
    <img src="icons/web_search_btn.png" alt="Web Search Icon" style="width:20px; height:20px; margin-right: 5px;" draggable="false">
    <span>Ara</span>
  </button>

<button id="voice-record-btn" class="voice-record-btn" data-tooltip="Ses Kaydet">
    <img src="icons/mic_btn.png" alt="Ses Kaydet" style="width: 17px; height: 17px;" draggable="false">
  </button>

<button id="voice-page-btn" data-tooltip="Sesli sohbete başla">
    <img src="icons/voice_page_icon.png" alt="Ses Sayfası" style= "width: 17px; height: 17px;" draggable="false">
  </button>




  <textarea id="chat-input-textarea" placeholder="quik uygulamasına ileti gönder..."></textarea>
    <!-- Mini birleşik buton -->
<button id="mini-drop-btn" class="mini-drop-btn" data-tooltip="Daha Fazla" style="display:none;">
  <img src="icons/more_vert.png" alt="Daha Fazla" draggable="false" style= "width: 17px; height: 17px;">
</button>

<!-- Açılır menü -->
<div id="mini-dropdown" class="mini-dropdown">
  <button id="mini-file"  class="mini-item"><img src="icons/addfile_btn.png" style= "width: 17px; height: 17px;">Dosya</button>
  <button id="mini-web"   class="mini-item"><img src="icons/web_search_btn.png" style= "width: 17px; height: 17px;">Web</button>
</div>
  <button id="send-btn" class="send-btn" data-tooltip="Gönder">
    <img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;" draggable="false">
  </button>
</div>

<div id="drop-zone" class="drop-zone">
  <p>Dosyalarınızı buraya bırakın</p>
  <p class="subtext">Dosyalarınızı buraya bırakarak sohbete ekleyin</p>
</div>



<div id="help-dropdown" class="help-dropdown">
  <button class="help-item" id="terms-btn">
    <img src="icons/terms_icon.png" alt="Terms Icon" style="width:17px; height:17px; margin-right: 8px;">
    Kullanım Şartları
  </button>
  <button class="help-item" id="privacy-btn">
    <img src="icons/privacy_icon.png" alt="Privacy Icon" style="width:17px; height:17px; margin-right: 8px;">
    Gizlilik Politikası
  </button>
  <button class="help-item" id="excusive-help-btn">
    <img src="icons/excusive_help_icon.png" alt="Help Icon" style="width:17px; height:17px; margin-right: 8px;">
    Yardım
  </button>
</div>

<!-- Kullanım Şartları Modali -->
<div id="terms-modal" class="modal">
  <div class="modal-content settings-modal-content">
    <span id="terms-close" class="modal-close settings-close">&times;</span>
    <div class="modal-body">

      <h2>Kullanım Şartları</h2>

    <p>
      İşbu Kullanım Şartları ve Kişisel Verilerin Korunması Politikası, <strong>BRIQ - Intelligence Labs</strong> tarafından geliştirilen ve işletilen <strong>quik</strong> adlı dijital hizmet platformunun (web sitesi, mobil uygulama ve diğer çevrimiçi servisler dâhil) kullanımına ilişkin hükümleri içermektedir. Hizmeti kullanarak, bu şartları okuduğunuzu, anladığınızı ve kabul ettiğinizi beyan etmiş olursunuz.
    </p>
    
    <h3>1. Hizmetin Kapsamı</h3>
    <p>
      quik, kullanıcılarına yapay zekâ tabanlı asistan hizmetleri sunar. Bu hizmetler; metin tabanlı bilgi alma, öneri üretme, sohbet etkileşimi, dosya yükleme ve çeşitli entegrasyonlar aracılığıyla bilgi akışı sağlamayı kapsar. BRIQ, hizmet içeriğinde değişiklik yapma, geçici veya kalıcı olarak durdurma hakkını saklı tutar.
    </p>
    <p>
      Platform, sivil toplum kuruluşlarının, toplulukların ve bireylerin sosyal dayanışma ve gelişim faaliyetlerini desteklemek amacıyla tasarlanmıştır. Sunulan yapay zekâ hizmetleri, kullanıcı sorguları doğrultusunda özelleştirilmiş yanıtlar üretir ve 7/24 erişilebilir durumdadır.
    </p>
    
    <h3>2. Kullanıcı Yükümlülükleri</h3>
    <ul>
      <li>Kullanıcı, quik hizmetlerini sadece yasal ve etik kurallar çerçevesinde kullanmalıdır.</li>
      <li>Yanıltıcı, yasa dışı, müstehcen, ayrımcı veya nefret içeren içerikler paylaşmak yasaktır.</li>
      <li>Hesap bilgilerinizin gizliliğinden siz sorumlusunuz; şifre paylaşımı yapılmamalıdır.</li>
      <li>Yazılımsal veya teknik yollarla hizmetin aksatılmasına neden olacak eylemler yasaktır (ör. bot saldırıları, tersine mühendislik, kaynak kod müdahalesi).</li>
      <li>quik sistemini, diğer kullanıcılara zarar verecek veya onları rahatsız edecek şekilde kullanmak yasaktır.</li>
      <li>Hizmeti kullanırken üçüncü tarafların haklarını ihlal eden içerikler paylaşmamak kullanıcının sorumluluğundadır.</li>
      <li>Platform üzerinden yasadışı ürün veya hizmetlerin reklamını yapmak, pazarlamak veya satışını gerçekleştirmek kesinlikle yasaktır.</li>
      <li>Platforma giriş yaparken doğru ve güncel bilgiler sağlamak zorunludur.</li>
    </ul>
    
    <h3>3. Fikri Mülkiyet Hakları</h3>
    <p>
      quik'e ait tüm içerikler (metin, grafik, ikonlar, yazılım kodları, algoritmalar ve model çıktıları) <strong>BRIQ</strong> veya lisans alınmış üçüncü taraflara aittir. Kullanıcı, bu içerikleri izinsiz şekilde çoğaltamaz, dağıtamaz veya ticari amaçla kullanamaz.
    </p>
    <p>
      Kullanıcılar tarafından platforma yüklenen içerikler üzerindeki mülkiyet hakları kullanıcıya ait olmaya devam eder. Ancak, kullanıcı bu içerikleri platforma yükleyerek, BRIQ'e söz konusu içerikleri hizmetin sağlanması ve iyileştirilmesi amacıyla kullanma, saklama, işleme ve görüntüleme hakkı tanımış olur. Bu lisans, kullanıcının quik platformundaki hesabını silmesi durumunda sona erer.
    </p>
    
    <h3>4. Kişisel Verilerin İşlenmesi</h3>
    <p>
      BRIQ, 6698 sayılı Kişisel Verilerin Korunması Kanunu (KVKK) kapsamında veri sorumlusu olarak hareket etmektedir. Platformda toplanan ve işlenen kişisel veriler şunları içerebilir:
    </p>
    <ul>
      <li><strong>Kimlik Bilgileri:</strong>&nbsp;Ad, soyad, doğum tarihi</li>
      <li><strong>İletişim Bilgileri:</strong>&nbsp;E-posta adresi, telefon numarası, adres</li>
      <li><strong>Hesap Bilgileri:</strong>&nbsp;Kullanıcı adı, şifre (şifrelenmiş formatta)</li>
      <li><strong>Kullanım Verileri:</strong>&nbsp;Sorgular, etkileşimler, platforma yüklenen dosyalar</li>
      <li><strong>Teknik Veriler:</strong>&nbsp;IP adresi, cihaz bilgileri, çerezler, kullanım istatistikleri</li>
    </ul>
    <p>
      Bu veriler, aşağıdaki amaçlarla işlenmektedir:
    </p>
    <ul>
      <li>Hizmetin sunulması ve kişiselleştirilmesi</li>
      <li>Kullanıcı hesaplarının yönetilmesi</li>
      <li>Kullanıcı desteğinin sağlanması</li>
      <li>Hizmetin güvenliğinin ve kalitesinin iyileştirilmesi</li>
      <li>Yasal yükümlülüklerin yerine getirilmesi</li>
      <li>Hizmet kullanımına ilişkin analiz ve istatistik oluşturulması</li>
    </ul>
    <p>
      Kişisel verileriniz, yasal zorunluluklar dışında üçüncü taraflarla paylaşılmaz. Bazı durumlarda, hizmetin sağlanması için gerekli olan üçüncü taraf hizmet sağlayıcılarıyla (örneğin bulut depolama, analitik servisleri) veri paylaşımı yapılabilir. Bu durumda, söz konusu üçüncü tarafların da KVKK ve ilgili mevzuata uygun hareket etmeleri sağlanır.
    </p>
    <p>
      Kişisel verileriniz, ilgili mevzuatta öngörülen veya işlendikleri amaç için gerekli olan süre kadar muhafaza edilir. Hesabınızı sildiğinizde, kişisel verileriniz makul bir süre içinde sistemlerimizden silinir veya anonimleştirilir.
    </p>
    
    <h3>5. Kullanıcı Hakları</h3>
    <p>
      KVKK'nın 11. maddesi uyarınca, kişisel verilerinizle ilgili olarak aşağıdaki haklara sahipsiniz:
    </p>
    <ul>
      <li>Kişisel verilerinizin işlenip işlenmediğini öğrenme</li>
      <li>Kişisel verileriniz işlenmişse buna ilişkin bilgi talep etme</li>
      <li>Kişisel verilerinizin işlenme amacını ve bunların amacına uygun kullanılıp kullanılmadığını öğrenme</li>
      <li>Yurt içinde veya yurt dışında kişisel verilerinizin aktarıldığı üçüncü kişileri bilme</li>
      <li>Kişisel verilerinizin eksik veya yanlış işlenmiş olması hâlinde bunların düzeltilmesini isteme</li>
      <li>Kişisel verilerinizin silinmesini veya yok edilmesini isteme</li>
      <li>İşlenen verilerin münhasıran otomatik sistemler vasıtasıyla analiz edilmesi suretiyle aleyhinize bir sonucun ortaya çıkmasına itiraz etme</li>
      <li>Kişisel verilerinizin kanuna aykırı olarak işlenmesi sebebiyle zarara uğramanız hâlinde zararın giderilmesini talep etme</li>
    </ul>
    <p>
      Bu haklarınızı kullanmak için <a href="mailto:kvkk@briq.org">kvkk@briq.org</a> adresine e-posta gönderebilir veya aşağıda belirtilen iletişim adresimize yazılı başvuruda bulunabilirsiniz.
    </p>
    
    <h3>6. Yapay Zeka Kullanımı ve Veri İşleme</h3>
    <p>
      Quik platformu, yapay zeka teknolojilerini kullanarak hizmet sunmaktadır. Bu kapsamda:
    </p>
    <ul>
      <li>Platform, kullanıcı sorguları ve girdileri doğrultusunda otomatik içerik üretmektedir.</li>
      <li>Üretilen içerikler, yapay zeka algoritmalarına dayalı olup, %100 doğruluk garantisi verilmemektedir.</li>
      <li>Kullanıcı verileri, yapay zeka sisteminin iyileştirilmesi amacıyla anonimleştirilerek kullanılabilir.</li>
      <li>Kullanıcılar tarafından platforma yüklenen dosyalar ve paylaşılan içerikler, sistem tarafından analiz edilebilir ancak üçüncü taraflarla paylaşılmaz.</li>
      <li>Yapay zeka sistemi, kullanıcı tercihlerini ve davranışlarını öğrenerek kişiselleştirilmiş bir deneyim sunabilir.</li>
    </ul>
    <p>
      Yapay zeka modelimiz, genel kaynaklardan ve yasal olarak elde edilmiş verilerle eğitilmiştir. Model, ayrımcılık, nefret söylemi ve zararlı içerik üretimini engellemek için tasarlanmıştır ancak otomatik sistemlerin doğası gereği istenmeyen çıktılar üretebilir. Böyle durumlarda lütfen geri bildirimde bulununuz.
    </p>
    
    <h3>7. Dosya Yükleme ve Güvenlik</h3>
    <p>
      Kullanıcılar, platforma aşağıdaki koşullar çerçevesinde dosya yükleyebilirler:
    </p>
    <ul>
      <li>İzin verilen dosya türleri: .pdf, .doc, .docx, .txt, .jpg, .jpeg, .png (maksimum 25MB)</li>
      <li>Yüklenen tüm dosyalar virüs ve zararlı yazılım taramasından geçirilir.</li>
      <li>Telif hakkı ihlali içeren, yasadışı veya uygunsuz içerikli dosyaların yüklenmesi yasaktır.</li>
      <li>Yüklenen dosyalar, kullanıcı izni olmadan üçüncü taraflarla paylaşılmaz.</li>
      <li>BRIQ, uygunsuz içerik barındıran dosyaları önceden bildirmeksizin silme hakkını saklı tutar.</li>
    </ul>
    <p>
      Yüklenen dosyalar, kullanıcının hesabı aktif olduğu sürece sistemde saklanır. Hesap silme işlemi sonrasında, dosyalar 30 gün içinde otomatik olarak silinir.
    </p>
    
    <h3>8. Hizmette Değişiklik ve Erişim</h3>
    <p>
      BRIQ, quik hizmetine dair içerik, kullanıcı arayüzü, algoritmalar ve fonksiyonellikler üzerinde dilediği zaman değişiklik yapabilir. Bu kapsamda, kullanıcı deneyimini optimize etmek amacıyla sistemsel güncellemeler önceden bildirilmeksizin devreye alınabilir.
    </p>
    <p>
      Platform, planlı bakım çalışmaları, güvenlik güncellemeleri veya teknik aksaklıklar nedeniyle geçici olarak erişilemez olabilir. BRIQ, planlanmış bakımlar hakkında kullanıcıları önceden bilgilendirmeye çalışacaktır, ancak acil durumlarda bu mümkün olmayabilir.
    </p>
    <p>
      Hizmet, 7/24 erişilebilir olarak tasarlanmıştır ancak belirli coğrafi bölgelerde veya ağ koşullarında performans farklılıkları görülebilir. BRIQ, hizmetin kesintisiz şekilde sunulacağını garanti etmez.
    </p>
    
    <h3>9. Sorumluluğun Sınırlandırılması</h3>
    <p>
      Quik tarafından sunulan bilgiler ve çıktılar, yalnızca öneri niteliğindedir. BRIQ, hizmetin %100 doğrulukta çalışacağını taahhüt etmez. Kullanıcı, üretilen çıktılara dayanarak aldığı kararlarda kendi sorumluluğunu taşır. Hizmetin geçici olarak kullanılamaması, veri kaybı veya hatalı bilgi aktarımı gibi durumlardan BRIQ sorumlu tutulamaz.
    </p>
    <p>
      Quik platformunun kullanımından kaynaklanabilecek dolaylı, dolaysız, özel, arızi veya cezai zararlardan BRIQ sorumlu değildir. Bu sorumluluk reddi, aşağıdakileri içerir ancak bunlarla sınırlı değildir:
    </p>
    <ul>
      <li>Yapay zeka çıktılarına dayanarak alınan kararlar nedeniyle ortaya çıkabilecek zararlar</li>
      <li>Hizmetin kullanılamaması nedeniyle yaşanan iş kaybı veya fırsat maliyeti</li>
      <li>Sistemde yaşanabilecek veri kayıpları veya güvenlik ihlalleri</li>
      <li>Üçüncü taraf entegrasyonlarından kaynaklanan sorunlar</li>
      <li>Kullanıcılar arasında paylaşılan içeriklerden doğan anlaşmazlıklar</li>
    </ul>
    <p>
      Platform üzerinden sağlanan bilgiler, profesyonel tavsiye (tıbbi, hukuki, finansal vb.) yerine geçmez. Önemli kararlar için mutlaka ilgili alanda uzman kişilere danışılmalıdır.
    </p>
    
    <h3>10. Platform Kullanımı</h3>
    <p>
      Quik platformu, BRIQ çalışanlarının kullanımı için tasarlanmamıştır. Bu çalışanlar, platforma erişim sağlamak için Quik uygulaması tarafından onay almalıdır. BRIQ, kullanıcılar tarafından bilerek veya bilmeyerek sağlanan kişisel verileri, tespit edildiği takdirde sistemden silme hakkını saklı tutar.
    </p>
    <p>
      Ebeveynler ve yasal vasiler, çocukların platform kullanımını denetlemekle ve çocukların kişisel verilerinin korunmasını sağlamakla yükümlüdür. Çocuklara yönelik içerik oluşturma veya çocuklarla ilgili veri toplama amacıyla platformun kullanılması yasaktır.
    </p>
    
    <h3>11. Ödeme Koşulları ve İadeler</h3>
    <p>
      Quik platformunun bütün hizmetleri BRIQ çalışanlarına ücretsiz olarak sunulmaktadır. Gelecekte sunulabilecek ücretli hizmetlere ilişkin ücretlendirme politikaları ayrıca belirtilecektir. Ücretli hizmetler için aşağıdaki koşullar geçerli olacaktır:
    </p>
    <ul>
      <li>Ödeme bilgilerinin doğru ve güncel olmasından kullanıcı sorumludur.</li>
      <li>Abonelik temelli hizmetler, aksi belirtilmedikçe otomatik yenileme özelliğine sahiptir.</li>
      <li>İptal edilen aboneliklerde, fatura döneminin sonuna kadar hizmet sunulmaya devam eder.</li>
      <li>Hizmet kalitesinde ciddi aksaklıklar yaşanması durumunda, son 14 gün içinde yapılan ödemeler için iade talep edilebilir.</li>
      <li>İade talepleri:&nbsp;&nbsp;<a href="mailto:iade@briq.org">iade@briq.org</a>&nbsp;adresine gönderilmelidir.</li>
    </ul>
    
    <h3>12. Hizmetin Sonlandırılması</h3>
    <p>
      BRIQ, kullanıcıların bu kullanım şartlarına aykırı davrandığını tespit ettiğinde, ilgili kullanıcıların hizmete erişimini geçici veya kalıcı olarak durdurabilir. Ayrıca, güvenlik veya bakım amaçlı olarak hizmet geçici süreyle durdurulabilir.
    </p>
    <p>
      Kullanıcı, dilediği zaman hesabını kapatma hakkına sahiptir. Hesap kapatma işlemi, kullanıcı profilindeki "Hesabımı Sil" seçeneği üzerinden gerçekleştirilebilir. Hesap silme işlemi sonrasında:
    </p>
    <ul>
      <li>Kişisel verileriniz 30 gün içinde sistemden silinir veya anonimleştirilir.</li>
      <li>Yüklediğiniz içerikler sistemden kaldırılır.</li>
      <li>Yasal yükümlülükler gereği saklanması gereken veriler, yasal süre boyunca muhafaza edilir.</li>
    </ul>
    <p>
      BRIQ, teknik, ekonomik veya stratejik nedenlerle Quik platformunu tamamen sonlandırma hakkını saklı tutar. Böyle bir durumda, kullanıcılara en az 30 gün önceden bildirim yapılacaktır.
    </p>
    
    <h3>13. Üçüncü Taraf Bağlantıları</h3>
    <p>
      Quik platformunda bazı entegrasyonlar veya yönlendirmeler üçüncü taraf web sitelerine yapılabilir. Bu sitelerin içerikleri BRIQ'in sorumluluğunda değildir. Kullanıcı, bu sitelere eriştiğinde kendi gizlilik politikalarını ve kullanım şartlarını ayrıca değerlendirmelidir.
    </p>
    <p>
      Platformda yer alan üçüncü taraf hizmetleri (ödeme sistemleri, analitik araçları, vb.) kendi kullanım koşullarına ve gizlilik politikalarına tabidir. Bu hizmetleri kullanmadan önce ilgili koşulları incelemeniz önerilir.
    </p>
    
    <h3>14. Teknik ve İdari Güvenlik Önlemleri</h3>
    <p>
      BRIQ, kullanıcı verilerinin güvenliğini sağlamak için aşağıdaki teknik ve idari önlemleri almaktadır:
    </p>
    <ul>
      <li>Veri şifreleme protokolleri (SSL/TLS)</li>
      <li>Düzenli güvenlik güncellemeleri ve zafiyet taramaları</li>
      <li>İki faktörlü kimlik doğrulama seçeneği</li>
      <li>Erişim kontrolleri ve yetkilendirme sistemleri</li>
      <li>Düzenli veri yedekleme işlemleri</li>
      <li>Personel için veri güvenliği eğitimleri</li>
      <li>Fiziksel güvenlik önlemleri (sunucu güvenliği vb.)</li>
    </ul>
    <p>
      Herhangi bir veri ihlali durumunda, yasal gerekliliklere uygun olarak ilgili kişilere ve düzenleyici kurumlara bildirimde bulunulacaktır.
    </p>
    
    <h3>15. Şikayet ve Destek Yönetimi</h3>
    <p>
      Quik platformu ile ilgili her türlü soru, sorun ve şikayetleriniz için aşağıdaki kanallardan destek alabilirsiniz:
    </p>
    <ul>
      <li><strong>Platform içi yardım merkezi:</strong>&nbsp;Quik - Yapay zeka destek elemanı</li>
      <li><strong>E-posta:</strong>&nbsp;<a href="mailto:destek@briq.org">destek@briq.org</a></li>
      <li><strong>Çevrimiçi destek formu:</strong>&nbsp;<a href="https://quik-help@briq.org/destek">quik-help@briq.org/destek</a></li>
      <li><strong>Telefon:</strong>&nbsp;+90 312 212 60 13 (Hafta içi 09:00-17:30)</li>
    </ul>
    <p>
      Şikayetler, alındıktan sonra en geç 72 saat içinde değerlendirilecek ve çözüm süreci başlatılacaktır. Karmaşık sorunlar için bu süre uzayabilir ancak her durumda süreç hakkında bilgilendirileceksiniz.
    </p>
    
    <h3>16. Güncellemeler</h3>
    <p>
      BRIQ, Kullanım Şartları üzerinde dilediği zaman değişiklik yapabilir. Güncel metin her zaman uygulama içinden veya <a href="https://quik-chatbot.briq.org">quik-chatbot.briq.org</a> üzerinden erişilebilir olacaktır. Kullanıcılar, değişiklikleri takip etmekle yükümlüdür. Güncel şartların yayımlanmasının ardından hizmeti kullanmaya devam etmek, yeni şartların kabul edildiği anlamına gelir.
    </p>
    <p>
      Önemli değişiklikler durumunda, kullanıcılara e-posta veya platform üzerinden bildirim gönderilecektir. Değişikliklerin yürürlüğe girmesinden önce kullanıcılara en az 15 gün süre tanınacaktır.
    </p>
    
    <h3>17. Uygulanacak Hukuk ve Yetki</h3>
    <p>
      İşbu şartlar, <strong>T.C. yasalarına</strong> tabidir. Taraflar arasında çıkabilecek uyuşmazlıklar öncelikle uzlaşma yoluyla çözülmeye çalışılır. Çözülemediği takdirde <strong>Ankara Mahkemeleri ve İcra Daireleri</strong> yetkilidir.
    </p>
    <p>
      Bu sözleşme, tüketici hakları ve elektronik ticaret ile ilgili yürürlükteki mevzuat hükümlerine tabidir. Sözleşmenin herhangi bir hükmünün geçersiz olması durumunda, diğer hükümler geçerliliğini korur.
    </p>
    
    <h3>18. Mücbir Sebepler</h3>
    <p>
      Doğal afetler, salgın hastalıklar, savaş, terör eylemleri, hükümet kısıtlamaları, internet altyapısındaki aksaklıklar gibi BRIQ'in kontrolü dışında gelişen durumlar nedeniyle hizmetin sunulamaması veya aksaması halinde, BRIQ sorumlu tutulamaz. Mücbir sebep durumunun sona ermesinin ardından hizmet mümkün olan en kısa sürede normale döndürülecektir.
    </p>
    
    <h3>19. İletişim</h3>
    <ul>
      <li><strong>E-posta:</strong>&nbsp;<a href="mailto:destek@briq.org">destek@briq.org</a></li>
      <li><strong>Kişisel Veri Talepleri:</strong>&nbsp;<a href="mailto:kvkk@briq.org">kvkk@briq.org</a></li>
      <li><strong>Telefon:</strong>&nbsp;+90 312 212 60 13</li>
      <li><strong>Web:</strong>&nbsp;<a href="https://www.briq.org">www.briq.org</a></li>
    </ul>
    <p><i>Bu şartların son güncellenme tarihi: 01 Temmuz 2025</i></p>
    <p><i>
      BRIQ, kullanıcı verilerinin güvenliği ve gizliliği konusunda yasal sorumluluklarını titizlikle yerine getirir. Bu politika, BRIQ'in etik değerleriyle uyumlu olarak hazırlanmıştır.
    </i></p>
    </div>
  </div>
</div>

<!-- Gizlilik Politikası Modali -->
<div id="privacy-modal" class="modal">
  <div class="modal-content settings-modal-content">
    <span id="privacy-close" class="modal-close settings-close">&times;</span>
    <div class="modal-body">
    <h2>Gizlilik Politikası</h2>

    <p>
      Bu Gizlilik Politikası, <strong>Quik</strong> adlı dijital ürün ve hizmetlerin kullanımı sırasında elde edilen verilerin işlenmesi ve korunmasına ilişkin ilkeleri tanımlar. <strong>Quik</strong> markası, <strong>BRIQ Intelligence Labs</strong> tarafından geliştirilmiş ve işletilmektedir. BRIQ, kullanıcı mahremiyetine yüksek düzeyde önem verir ve kişisel verilerin güvenliğini mevzuatlara uygun biçimde sağlamayı taahhüt eder.
    </p>
    
    <h3>1. Kapsam</h3>
    <p>
      Bu politika, Quik'e ait mobil uygulama, web sitesi ve entegre hizmetler aracılığıyla elde edilen kişisel verileri kapsar. Politika, sadece Quik tarafından toplanan verileri içerir; üçüncü taraf hizmet sağlayıcıların politikaları ayrıca geçerlidir.
    </p>
    <p>
      Bu gizlilik politikası, aşağıdaki platformlar ve kanallar üzerinden toplanan tüm verileri kapsamaktadır:
    </p>
    <ul>
      <li>Quik mobil uygulaması (iOS ve Android)</li>
      <li>Quik web platformu (quik.briq.org)</li>
      <li>Quik'e bağlı API servisleri ve entegrasyonlar</li>
      <li>Quik müşteri hizmetleri ve teknik destek kanalları</li>
      <li>Quik resmi sosyal medya hesapları ve iletişim kanalları</li>
    </ul>
    
    <h3>2. Toplanan Bilgi Türleri</h3>
    <ul>
      <li><strong>Kimlik Bilgileri:</strong>&nbsp;Ad, soyad, kullanıcı adı, doğum tarihi, cinsiyet, fotoğraf (profil resmi olarak yüklendiği takdirde)</li>
      <li><strong>İletişim Bilgileri:</strong>&nbsp;E-posta adresi, IP adresi, telefon numarası (isteğe bağlı), posta adresi (isteğe bağlı)</li>
      <li><strong>Oturum Bilgileri:</strong>&nbsp;Giriş-çıkış saatleri, cihaz tipi, tarayıcı bilgisi, işletim sistemi, cihaz tanımlayıcıları, ağ bilgileri</li>
      <li><strong>Davranış Verileri:</strong>&nbsp;Uygulama içi gezinti, tıklama ve etkileşim kayıtları, kullanılan özellikler, arama geçmişi, içerik tercihleri, içerik yükleme ve paylaşım davranışları</li>
      <li><strong>Tanımlama Bilgileri (Çerezler):</strong>&nbsp;Kullanıcı tercihlerinin takibi, oturum bilgilerinin korunması, hizmet performansının optimizasyonu</li>
      <li><strong>Konum Verileri:</strong>&nbsp;Genel konum bilgisi (ülke/şehir düzeyinde, hassas konum verileri isteğe bağlıdır)</li>
      <li><strong>İçerik ve Dosya Verileri:</strong>&nbsp;Kullanıcının platforma yüklediği dosyalar, paylaştığı içerikler, notlar, yorumlar ve mesajlar</li>
      <li><strong>Ödeme Bilgileri:</strong>&nbsp;Ücretli hizmetler için kullanılan (ancak tam olarak saklanmayan) ödeme bilgileri</li>
      <li><strong>Anket ve Geri Bildirim Verileri:</strong>&nbsp;Kullanıcının gönüllü olarak sağladığı değerlendirme, şikayet ve öneriler</li>
    </ul>
    
    <h3>3. Verilerin Toplanma Yöntemleri</h3>
    <p>
      Veriler doğrudan kullanıcıdan (kayıt formu, giriş işlemi vb.) ya da otomatik sistemler aracılığıyla (çerezler, oturum kaydı, cihaz tespiti) toplanır.
    </p>
    <p>
      Veri toplama yöntemlerimiz aşağıdaki kanalları içerir:
    </p>
    <ul>
      <li><strong>Doğrudan Kullanıcı Girişi:</strong>&nbsp;Kayıt formları, profil güncelleme, tercih belirleme, sohbet etkileşimleri</li>
      <li><strong>Otomatik Veri Toplama:</strong>&nbsp;Çerezler, piksel etiketleri, sunucu günlükleri, uygulama analitikleri</li>
      <li><strong>Cihaz Bilgileri:</strong>&nbsp;Kullanılan cihazın özellikleri, ekran çözünürlüğü, bağlantı türü, cihaz kimliği</li>
      <li><strong>Kullanım Verileri:</strong>&nbsp;Etkileşim süreleri, sayfa görüntüleme, tıklama davranışları, kullanım sıklığı</li>
      <li><strong>Entegrasyonlar:</strong>&nbsp;Üçüncü taraf hizmetlerle entegrasyonlar aracılığıyla (Google, Apple, Facebook ile giriş gibi) alınan ve paylaşılan veriler</li>
      <li><strong>Müşteri Hizmetleri:</strong>&nbsp;Destek talepleri, çağrı kayıtları, e-posta yazışmaları sırasında paylaşılan bilgiler</li>
    </ul>
    
    <h3>4. Verilerin Kullanım Amaçları</h3>
    <ul>
      <li>Kullanıcı hesabı oluşturmak ve yönetmek</li>
      <li>Kimlik doğrulama ve yetkilendirme yapmak</li>
      <li>Teknik destek ve müşteri hizmetleri sunmak</li>
      <li>Sistem güvenliğini sağlamak</li>
      <li>Kullanıcı deneyimini kişiselleştirmek</li>
      <li>Hizmetlerimizi geliştirmek ve iyileştirmek</li>
      <li>Yapay zeka modellerini eğitmek ve optimize etmek (anonimleştirilmiş verilerle)</li>
      <li>Kullanıcı davranış analizleri ve istatistikler oluşturmak</li>
      <li>Hizmet kalitesini ve performansını izlemek</li>
      <li>Dolandırıcılık ve kötüye kullanımı önlemek</li>
      <li>Platformun kullanımına ilişkin istatistikler oluşturmak</li>
      <li>Pazarlama faaliyetleri yürütmek (kullanıcının izni olması durumunda)</li>
      <li>Hizmet güncellemeleri ve önemli değişiklikler hakkında bilgilendirmek</li>
      <li>Mevzuat gerekliliklerini yerine getirmek</li>
    </ul>
    
    <h3>5. Hukuki Dayanak</h3>
    <p>
      Veriler, 6698 sayılı KVKK, Avrupa Birliği Genel Veri Koruma Tüzüğü (GDPR) gibi ulusal ve uluslararası düzenlemelere uygun olarak; <strong>açık rıza</strong>, <strong>sözleşmenin ifası</strong>, <strong>hukuki yükümlülük</strong> ve <strong>meşru menfaat</strong> gerekçeleriyle işlenir.
    </p>
    <p>
      Verilerinizi işlerken dayandığımız yasal dayanaklar aşağıdadır:
    </p>
    <ul>
      <li><strong>Açık Rıza:</strong>&nbsp;Belirli veri işleme faaliyetleri için açık rızanızı talep ederiz. Örneğin, pazarlama iletişimleri için e-posta adresinizi kullanmak veya konum verilerinizi işlemek gibi.</li>
      <li><strong>Sözleşmenin İfası:</strong>&nbsp;Quik kullanım koşullarını kabul ettiğinizde, sizinle aramızda bir sözleşme kurulur. Bu sözleşmenin gereklerini yerine getirmek için verilerinizi işleriz.</li>
      <li><strong>Hukuki Yükümlülük:</strong>&nbsp;Vergi mevzuatı, bilgi güvenliği düzenlemeleri, elektronik ticaret kanunları gibi yasal yükümlülüklerimizi yerine getirmek için veri işleme faaliyetleri gerçekleştirebiliriz.</li>
      <li><strong>Meşru Menfaat:</strong>&nbsp;Güvenlik önlemleri almak, dolandırıcılığı önlemek, hizmet kalitesini artırmak gibi meşru menfaatlerimiz doğrultusunda verilerinizi işleyebiliriz.</li>
      <li><strong>Hayati Çıkarların Korunması:</strong>&nbsp;Nadir durumlarda, sizin veya başka bir kişinin hayati çıkarlarını korumak için veri işleme gerekli olabilir.</li>
      <li><strong>Kamu Yararına Faaliyet:</strong>&nbsp;Kamu sağlığı, bilimsel araştırma gibi kamu yararına faaliyetler için veriler anonim hale getirilerek kullanılabilir.</li>
    </ul>
    
    <h3>6. Çerezler ve Takip Teknolojileri</h3>
    <p>
      Çerezler (cookies), kullanıcı tercihlerini hatırlamak ve analitik toplamak amacıyla kullanılır. Kullanıcı, çerez kullanımına ilişkin tercihlerini tarayıcı ayarlarından değiştirebilir.
    </p>
    <p>
      Quik platformunda aşağıdaki çerez ve takip teknolojileri kullanılmaktadır:
    </p>
    <ul>
      <li><strong>Zorunlu Çerezler:</strong>&nbsp;Platformun temel işlevleri için gerekli olan ve devre dışı bırakılamayan çerezlerdir. Bunlar güvenlik, kimlik doğrulama ve temel site fonksiyonları için kullanılır.</li>
      <li><strong>Performans Çerezleri:</strong>&nbsp;Ziyaretçilerin siteyi nasıl kullandıklarına dair bilgi toplar. Bu çerezler, sitenin performansını ve kullanıcı deneyimini iyileştirmemize yardımcı olur.</li>
      <li><strong>İşlevsellik Çerezleri:</strong>&nbsp;Kullanıcı tercihlerini (dil seçimi, bölge ayarları vb.) hatırlayarak daha kişiselleştirilmiş bir deneyim sunmak için kullanılır.</li>
      <li><strong>Analitik Çerezler:</strong>&nbsp;Ziyaretçi davranışlarını analiz etmek için kullanılır. Bu çerezler, hangi sayfaların daha popüler olduğu, kullanıcıların sitede ne kadar zaman geçirdiği gibi bilgileri toplar.</li>
      <li><strong>Piksel Etiketleri (Web Beacons):</strong>&nbsp;Web sayfalarına yerleştirilen ve kullanıcı davranışlarını izleyen küçük grafik dosyalarıdır.</li>
      <li><strong>Yerel Depolama (Local Storage):</strong>&nbsp;Tarayıcınızın yerel depolama alanında bazı verileri saklayarak uygulama performansını iyileştirmek için kullanılır.</li>
    </ul>
    <p>
      Çerez tercihlerinizi yönetmek için:
    </p>
    <ul>
      <li>Platformumuzun çerez ayarları panelini kullanabilirsiniz</li>
      <li>Tarayıcı ayarlarınızdan çerezleri kabul edip etmemeyi seçebilirsiniz</li>
      <li>"Gizli mod" veya "inkognito" pencerelerinde gezinti yapabilirsiniz</li>
      <li>Çerez engelleyici eklentiler kullanabilirsiniz</li>
    </ul>
    <p>
      Çerezleri tamamen devre dışı bırakmanız durumunda, platformumuzun bazı işlevlerinin düzgün çalışmayabileceğini lütfen unutmayın.
    </p>
    
    <h3>7. Üçüncü Taraflara Aktarım</h3>
    <p>
      Kişisel veriler, yalnızca aşağıdaki durumlarda sınırlı ve güvenli şekilde aktarılır:
    </p>
    <ul>
      <li>Sunucu barındırma ve teknik altyapı hizmet sağlayıcıları</li>
      <li>Yetkili kamu kurumları (mahkeme kararları veya kanun gereği)</li>
      <li>Analitik ve istatistik hizmetleri (anonimleştirilmiş veri)</li>
      <li>Ödeme işlemcileri ve finans kuruluşları (ücretli hizmetler için)</li>
      <li>Müşteri destek hizmetleri sağlayıcıları</li>
      <li>Bulut depolama sağlayıcıları</li>
      <li>Güvenlik ve doğrulama hizmeti sağlayıcıları</li>
      <li>Yazılım geliştirme ve bakım ortakları</li>
    </ul>
    <p>
      Hiçbir koşulda kullanıcı verileri ticari amaçla satılmaz veya paylaşılmaz.
    </p>
    <p>
      Veri aktarımı yaptığımız tüm üçüncü taraflarla, verilerin güvenliğini ve gizliliğini sağlamak amacıyla veri işleme sözleşmeleri imzalanmıştır. Bu sözleşmeler, söz konusu tarafların verilerinizi yalnızca belirtilen amaçlar için kullanmasını ve yeterli güvenlik önlemlerini almasını şart koşar.
    </p>
    <p>
      Verileriniz, yalnızca gerekli durumlarda ve aşağıdaki güvenlik önlemleri altında yurtdışına aktarılabilir:
    </p>
    <ul>
      <li>Avrupa Komisyonu tarafından yeterli koruma sağladığı kabul edilen ülkelere</li>
      <li>Standart veri koruma maddeleri veya bağlayıcı şirket kuralları gibi uygun güvenceler sunan ülkelere</li>
      <li>Kullanıcının açık rızası olması durumunda diğer ülkelere</li>
    </ul>
    
    <h3>8. Veri Güvenliği</h3>
    <p>
      BRIQ, teknik ve idari tedbirler ile veri güvenliğini sağlamak amacıyla aşağıdaki yöntemleri kullanır:
    </p>
    <ul>
      <li><strong>Şifreleme Teknolojileri:</strong>&nbsp;AES-256 bit şifreleme, TLS 1.3 protokolü, HTTPS bağlantıları, uçtan uca şifrelenmiş iletişim</li>
      <li><strong>Erişim Kontrol Sistemleri:</strong>&nbsp;Çok faktörlü kimlik doğrulama, en az yetki prensibi, rol tabanlı erişim kontrolleri, otomatik oturum sonlandırma</li>
      <li><strong>Güvenlik İzleme:</strong>&nbsp;7/24 güvenlik izleme, anormal davranış tespiti, yetkisiz erişim önleme sistemleri, DDoS koruma çözümleri</li>
      <li><strong>Düzenli Testler:</strong>&nbsp;Zafiyet taramaları, penetrasyon testleri, güvenlik duvarı testleri, kod güvenliği analizleri</li>
      <li><strong>Veri Yedekleme:</strong>&nbsp;Günlük yedeklemeler, coğrafi olarak ayrı lokasyonlarda yedekleme, felaket kurtarma planları</li>
      <li><strong>Personel Eğitimi:</strong>&nbsp;Düzenli veri güvenliği eğitimleri, sosyal mühendislik farkındalık programları</li>
      <li><strong>Fiziksel Güvenlik:</strong>&nbsp;Veri merkezlerinde 24 saat kamera gözetimi, biyometrik erişim kontrolleri, çevresel tehdit önlemleri</li>
      <li><strong>Veri Anonimleştirme:</strong>&nbsp;Analiz ve istatistik amaçlı kullanımlarda veri anonimleştirme teknikleri</li>
      <li><strong>Güvenlik Belgelendirmesi:</strong>&nbsp;ISO 27001 Bilgi Güvenliği Yönetim Sistemi standartlarına uygunluk</li>
    </ul>
    <p>
      Herhangi bir veri ihlali durumunda, yasal yükümlülüklerimiz çerçevesinde en geç 72 saat içinde ilgili denetim otoritelerine ve etkilenen kullanıcılara bildirimde bulunulacaktır.
    </p>
    
    <h3>9. Saklama Süresi</h3>
    <p>
      Veriler, yasal zorunluluklar ve işleme amacı gereğince saklanır; süresi sona erdiğinde güvenli biçimde silinir, yok edilir veya anonimleştirilir. Örnek:
    </p>
    <ul>
      <li><strong>Hesap Bilgileri:</strong>&nbsp;Hesap aktif olduğu sürece ve hesabın kapatılmasından sonra 90 gün</li>
      <li><strong>Oturum Kayıtları:</strong>&nbsp;2 yıl</li>
      <li><strong>Mesajlaşma İçerikleri:</strong>&nbsp;Aktif hesaplarda süresiz, hesap kapatıldıktan sonra 90 gün</li>
      <li><strong>İşlem Kayıtları:</strong>&nbsp;5 yıl</li>
      <li><strong>Ödeme Bilgileri:</strong>&nbsp;Son işlemden sonra 2 yıl</li>
      <li><strong>Destek Talepleri:</strong>&nbsp;3 yıl</li>
      <li><strong>Güvenlik Kayıtları:</strong>&nbsp;3 yıl</li>
      <li><strong>İşlem Logları:</strong>&nbsp;18 ay</li>
      <li><strong>Analitik Veriler:</strong>&nbsp;Anonimleştirilmiş formda 5 yıl</li>
      <li><strong>Muhasebe Kayıtları:</strong>&nbsp;10 yıl (Vergi Usul Kanunu kapsamında)</li>
    </ul>
    <p>
      Veri saklama sürelerimiz, aşağıdaki kriterler göz önünde bulundurularak belirlenmektedir:
    </p>
    <ul>
      <li>Yasal yükümlülükler ve zamanaşımı süreleri</li>
      <li>Veri işleme amacının gerektirdiği süre</li>
      <li>Sektör standartları ve iyi uygulamalar</li>
      <li>Olası hukuki uyuşmazlıklarda delil teşkil etme potansiyeli</li>
    </ul>
    <p>
      Yasal saklama süresi sona eren veriler, düzenli veri temizleme işlemleri kapsamında güvenli şekilde silinir veya anonim hale getirilir. Bu işlemler, veri silme politikalarına uygun olarak gerçekleştirilir ve kayıt altına alınır.
    </p>
    
    <h3>10. Kullanıcı Hakları</h3>
    <p>
      KVKK ve GDPR kapsamında, kullanıcılar aşağıdaki haklara sahiptir:
    </p>
    <ul>
      <li><strong>Bilgi Edinme Hakkı:</strong>&nbsp;Hangi kişisel verilerinizin işlendiğini öğrenme</li>
      <li><strong>Erişim Hakkı:</strong>&nbsp;İşlenen kişisel verilerinize erişim talep etme ve bunların kopyalarını alma</li>
      <li><strong>Düzeltme Hakkı:</strong>&nbsp;Yanlış veya eksik kişisel verilerinizin düzeltilmesini isteme</li>
      <li><strong>Silme Hakkı (Unutulma Hakkı):</strong>&nbsp;Belirli koşullar altında verilerinizin silinmesini talep etme</li>
      <li><strong>İşleme Sınırlandırma Hakkı:</strong>&nbsp;Verilerinizin işlenmesini sınırlandırma talebinde bulunma</li>
      <li><strong>Veri Taşınabilirliği Hakkı:</strong>&nbsp;Verilerinizi yapılandırılmış, yaygın olarak kullanılan ve makine tarafından okunabilir bir formatta alma</li>
      <li><strong>İtiraz Hakkı:</strong>&nbsp;Meşru menfaat temelinde yapılan veri işlemelerine itiraz etme</li>
      <li><strong>Otomatik Karar Almaya İtiraz:</strong>&nbsp;Otomatik karar alma (profilleme dahil) süreçlerine tabi olmama</li>
      <li><strong>Rızayı Geri Çekme Hakkı:</strong>&nbsp;Daha önce verdiğiniz rızayı istediğiniz zaman geri çekme</li>
      <li><strong>Şikayet Hakkı:</strong>&nbsp;Veri koruma otoritesine şikayette bulunma</li>
    </ul>
    <p>
      Bu haklarınızı kullanmak için aşağıdaki yöntemlerle bizimle iletişime geçebilirsiniz:
    </p>
    <ul>
      <li><strong>E-posta:</strong>&nbsp;<a href="mailto:kvkk@briq.org">kvkk@briq.org</a></li>
      <li><strong>Güvenli Online Form:</strong>&nbsp;<a href="https://quik.briq.org/veri-basvuru">quik.briq.org/veri-basvuru</a></li>
      <li><strong>Quik Uygulaması:</strong>&nbsp;Hesap ayarları > Gizlilik > Veri Talepleri bölümü</li>
    </ul>
    <p>
      Talebiniz alındıktan sonra, kimlik doğrulama işlemi gerçekleştirilir ve 30 gün içerisinde talebinizi yanıtlarız. Talebin karmaşıklığına bağlı olarak bu süre 60 güne kadar uzatılabilir, ancak böyle bir durumda sizi bilgilendiririz.
    </p>
    
    <h3>11. Çocukların Gizliliği</h3>
    <p>
      Quik platformu, 18 yaşın altındaki çocukların kullanımını hedeflememektedir. Bilerek 18 yaş altındaki kişilerden kişisel veri toplamayız. Eğer bir ebeveyn veya vasi, çocuğunun bize kişisel veri sağladığını düşünüyorsa, lütfen bizimle iletişime geçin ve bu bilgileri sistemlerimizden silmek için gerekli adımları atacağız.
    </p>
    <p>
      18 yaşın altındaki bir çocuğa ait kişisel veri topladığımızı fark ettiğimizde, bu verileri sistemlerimizden en kısa sürede sileriz. Ebeveynler veya yasal vasiler, çocuklarının verilerinin toplanması, kullanılması veya ifşa edilmesiyle ilgili sorular için <a href="mailto:kvkk@briq.org">kvkk@briq.org</a> adresinden bizimle iletişime geçebilirler.
    </p>
    
    <h3>12. Yapay Zeka ve Veri İşleme</h3>
    <p>
      Quik platformunda kullanılan yapay zeka teknolojilerinin veri işleme faaliyetleri aşağıdaki şekilde gerçekleşir:
    </p>
    <ul>
      <li>Yapay zeka modellerimiz, kullanıcı sorguları ve etkileşimleri doğrultusunda kişiselleştirilmiş içerik ve yanıtlar üretir.</li>
      <li>Kullanıcı verileri, yapay zeka sistemlerinin eğitilmesi ve geliştirilmesi için yalnızca anonimleştirilmiş formda kullanılabilir.</li>
      <li>Yapay zeka sistemlerimiz, kullanıcı davranışlarını öğrenerek daha doğru ve kişiselleştirilmiş yanıtlar vermek için kullanım modellerini analiz eder.</li>
      <li>Kullanıcılara tam kontrol sağlamak adına, yapay zeka özelliklerini ayarlar menüsünden kişiselleştirme ve sınırlandırma imkanı sunulur.</li>
      <li>Yapay zeka sistemlerimiz, kişiselleştirilmiş içerik üretmek amacıyla kullanıcı tercihlerini ve davranışlarını öğrenir, ancak hassas kişisel veri kategorileri (sağlık verileri, dini inançlar, siyasi görüşler vb.) varsayılan olarak kullanılmaz.</li>
    </ul>
    <p>
      Yapay zeka sistemlerimiz, ayrımcılık yapmaması, önyargılı olmaması ve kişilik haklarına saygılı olması için düzenli olarak denetlenir ve test edilir. Kullanıcılar, yapay zeka sisteminin ürettiği sonuçlara itiraz etme veya doğruluğunu sorgulama hakkına sahiptir.
    </p>
    
    <h3>13. Uluslararası Veri Transferleri</h3>
    <p>
      BRIQ, veri depolama ve işleme amacıyla Türkiye sınırları dışında bulunan sunuculara veri aktarımı yapabilir. Bu aktarımlar, aşağıdaki güvenceler sağlanarak gerçekleştirilir:
    </p>
    <ul>
      <li>Avrupa Komisyonu'nun yeterlilik kararı bulunan ülkelere aktarım</li>
      <li>Standart veri koruma maddeleri veya bağlayıcı şirket kuralları gibi uygun güvenceler sağlanması</li>
      <li>İlgili kişinin açık rızası alınarak veri aktarımı yapılması</li>
      <li>Sözleşmenin ifası veya hukuki yükümlülükler için gerekli olması durumunda veri aktarımı</li>
    </ul>
       <p>
      Uluslararası veri transferlerimiz, KVKK ve GDPR gerekliliklerine uygun olarak gerçekleştirilir. Veri transferi sırasında gerekli tüm teknik ve idari önlemler alınır ve veri sahiplerinin hakları her aşamada korunur.
    </p>
    
    <h3>14. Politika Güncellemeleri</h3>
    <p>
      Bu Gizlilik Politikası, teknolojik gelişmeler, mevzuat değişiklikleri veya Quik hizmetlerinde yapılan güncellemeler doğrultusunda zaman zaman değiştirilebilir. Politika değişiklikleri, güncellenmiş metnin platformumuzda yayımlanmasıyla yürürlüğe girer.
    </p>
    <p>
      Politika üzerinde önemli değişiklikler yapıldığında, kullanıcılara bildirim gönderilir veya uygulama içi bildirim yoluyla bilgilendirme sağlanır. Değişikliklerden sonra hizmetlerimizi kullanmaya devam etmeniz, güncellenmiş politikayı kabul ettiğiniz anlamına gelir.
    </p>
    <p>
      Kullanıcıların, Gizlilik Politikası’nı düzenli aralıklarla gözden geçirmeleri tavsiye edilir.
    </p>
    
    <h3>15. İletişim Bilgileri</h3>
    <p>
      Gizlilik Politikası veya veri işleme uygulamalarımız hakkında sorularınız, talepleriniz veya şikayetleriniz olması durumunda bizimle aşağıdaki kanallar üzerinden iletişime geçebilirsiniz:
    </p>
    <ul>
      <li><strong>E-posta:</strong>&nbsp;<a href="mailto:kvkk@briq.org">kvkk@briq.org</a></li>
      <li><strong>Telefon:</strong>&nbsp;+90 312 474 31 00</li>
      <li><strong>Online İletişim Formu:</strong>&nbsp;<a href="https://quik.briq.org/iletisim">quik.briq.org/iletisim</a></li>
    </ul>
    <p>
      Tüm veri işleme faaliyetlerimiz, kullanıcılarımızın güvenliği ve memnuniyeti öncelikli olacak şekilde yürütülmektedir.
    </p>

    </div>
  </div>
</div>


<!-- Yeni: Sidebar arama butonu, settings-btn'ün solunda -->


<!-- Sohbet Arama Modalı -->
<div id="chat-search-modal" class="modal">
  <div class="modal-content chat-search-modal-content">
    <!-- Kapatma Butonu -->
    <span id="chat-search-close" class="modal-close settings-close">&times;</span>
    <!-- Arama Başlığı -->
    <div class="chat-search-header">
      <h2>Sohbet Ara</h2>
    </div>
    <!-- Arama Alanı -->
    <div class="chat-search-body">
      <div class="chat-search-input-wrapper">
        <input id="chat-search-input" type="text" placeholder="Başlık veya içerik ara..." />
      </div>
      <!-- Arama Sonuçları -->
      <ul id="chat-search-results" class="chat-search-results"></ul>
    </div>
  </div>
</div>



<!-- Ayarlar Modal'ı (GÜNCELLENMİŞ, Estetik) -->
<div id="settings-modal" class="modal">
  <div class="modal-content settings-modal-content">
    <!-- Kapat Butonu -->
    <span id="settings-close" class="modal-close settings-close">&times;</span>
    <!-- Başlık -->
    <div class="settings-header">
      <h2>Ayarlar</h2>
    </div>

    <!-- Ayarlar Gövdesi -->
    <div class="settings-body">
      <!-- SOL: Sekme Menüsü -->
      <nav class="settings-nav" aria-label="Ayar Kategorileri">
        <ul>

  <li class="active" data-tab="genel">
    <img src="icons/genel.png" class="settings-icon" alt="Genel" draggable="false">
    Genel
  </li>

  <li data-tab="bildirimler">
    <img src="icons/bildirimler.png" class="settings-icon" alt="Bildirimler" draggable="false">
    Bildirimler
  </li>

<li data-tab="kisisellestirme">
    <img src="icons/kisisellestirme.png" class="settings-icon" alt="Kişiselleştirme" draggable="false">
    Kişiselleştirme
  </li>

<li data-tab="konusma">
    <img src="icons/konusma.png" class="settings-icon" alt="Konuşma" draggable="false">
    Konuşma
  </li>

<li data-tab="gecmis">
    <img src="icons/gecmis.png" class="settings-icon" alt="Geçmiş" draggable="false">
    Geçmiş
  </li>

<li data-tab="bagliuygulamalar">
    <img src="icons/bagli_uygulamalar.png" class="settings-icon" alt="Bağlı Uygulamalar" draggable="false">
    Bağlı Uygulamalar
  </li>

<li data-tab="bagliprogramlar">
    <img src="icons/bagli_programlar.png" class="settings-icon" alt="Bağlı Programlar" draggable="false">
    Bağlı Programlar
  </li>

<li data-tab="hesap">
    <img src="icons/hesap.png" class="settings-icon" alt="Hesap" draggable="false">
    Hesap
  </li>

        </ul>
      </nav>

      <!-- SAĞ: Sekme İçerikleri -->
      <div class="settings-content">


<!-- GENEL Sekmesi (YENİ) -->
<div class="tab-content active" id="genel">
  <div class="general-container">
<!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
<div class="notifications-container">

<!-- 0. Kart : Genel özellikler -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/genel.png" alt="Genel" class="notification-icon" draggable="false">
      <span class="notification-name">Genel Seçenekler</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    Görünüm, Web Arama ve Dil tercihini buradan yapabilirsin.
  </p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

    <!-- 1. Kart: Görünüm -->
<div class="general-card" style= "margin-top:1rem;">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/appearance.png" alt="Görünüm" class="general-icon" draggable="false">
      <span class="general-name">Görünüm</span>
    </div>
  </div>
  <p class="general-description">
    Tema seçimini buradan yapabilirsiniz.
  </p>
  <div class="theme-selection">
    <button id="light-mode-btn" class="theme-btn">
      <img src="icons/aydinlik.png" alt="Aydınlık Mod" class="theme-icon" draggable="false">
      Aydınlık
    </button>
    <button id="dark-mode-btn" class="theme-btn">
      <img src="icons/karanlik.png" alt="Karanlık Mod" class="theme-icon" draggable="false">
      Karanlık
    </button>
    <button id="system-mode-btn" class="theme-btn">
      <img src="icons/sistem.png" alt="Sistem Modu" class="theme-icon" draggable="false">
      Sistem
    </button>
  </div>
</div>

    <!-- 2. Kart: Web Arama -->
    <div class="general-card">
      <div class="general-header">
        <div class="general-heading-left">
          <img src="icons/web_search.png" alt="Web Arama" class="general-icon" draggable="false">
          <span class="general-name">Web Arama</span>
        </div>
      </div>
      <p class="general-description">
        Web aramasını açıp kapatabilir veya devre dışı bırakabilirsiniz.
      </p>
<div class="web-search-toggle-group">
  <button id="web-search-on-btn" class="web-search-btn active">
    <img src="icons/web_search_btn.png" alt="Web Açık" class="web-search-icon" draggable="false">
    Açık
  </button>
  <button id="web-search-off-btn" class="web-search-btn">
    <img src="icons/web_search_btn_cancel.png" alt="Web Kapalı" class="web-search-icon" draggable="false">
    Kapalı
  </button>
  <button id="web-search-disable-btn" class="web-search-btn">
    <img src="icons/web_search_disable.png" alt="Devre Dışı" class="web-search-icon" draggable="false">
    Devre Dışı
  </button>
</div>
</div>

<!--3. Kart: Dil Seçimi Kartı -->
<div class="general-card">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/language.png" alt="Dil Seçimi" class="general-icon" draggable="false">
      <span class="general-name">Dil Seçimi</span>
    </div>
  </div>
  <p class="general-description">
    Uygulama arayüzü için tercih ettiğiniz dili seçin.
  </p>
  <div class="language-selection">
    <select id="language-select">
      <option value="tr">Türkçe</option>
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
      <!-- Diğer diller ekleyebilirsiniz -->
    </select>
  </div>
</div>

  </div> <!-- /general-container -->
</div>

<!-- BİLDİRİMLER Sekmesi (YENİ) -->
<div class="tab-content" id="bildirimler">
  <!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
  <div class="notifications-container">

<!-- 0. Kart : Tüm Bildirimler (master) -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/bildirimler.png" alt="Bildirim" class="notification-icon" draggable="false">
      <span class="notification-name">Bildirim Ayarları</span>
    </div>

    <!-- Ana anahtar -->
    <label class="notification-switch">
      <input type="checkbox" id="toggle-all-notifications" checked>
      <span class="notification-slider"></span>
    </label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description">
    Bildirimleri açabilir veya kapayabilirsin. Bildirimleri açman önerilir.
  </p>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

    <!-- 1. Kart: Gelen Mesaj bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <!-- İkon (opsiyonel) -->
        <div class="notification-heading-left">
          <img src="icons/notification.png" alt="Bildirim" class="notification-icon" draggable="false">
          <span class="notification-name">Gelen Mesaj Bildirimi</span>
        </div>

        <!-- Switch (Toggle) -->
        <label class="notification-switch">
          <input type="checkbox" id="toggle-unread-messages" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Gelen mesajları uygulama üzerinden bildirir.
      </p>
    </div>

    <!-- 2. Kart: Okunmamış bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/unread_message.png" alt="Masaüstü" class="notification-icon" draggable="false">
          <span class="notification-name">Okunmamış Mesaj Bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-desktop-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Okunmamış mesajları uygulama üzerinden bildirir.
      </p>
    </div>

    <!-- 3. Kart: Hatırlatıcı bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/reminder_notification.png" alt="E-posta" class="notification-icon" draggable="false">
          <span class="notification-name">Hatırlatıcı Bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-email-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Planlı görevlerinizi uygulama üzerinden bildirir.
      </p>
    </div>

<!-- 4. Kart: Dosya İndirme Bildirimi -->
<div class="notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/download.png" alt="Dosya İndirme" class="notification-icon" draggable="false">
      <span class="notification-name">İndirme Bildirimi</span>
    </div>
    <label class="notification-switch">
      <input type="checkbox" id="toggle-download-notifications" checked>
      <span class="notification-slider"></span>
    </label>
  </div>
  <p class="notification-description">
    İndirilen dosyalar hakkında uygulama üzerinden bildirim gönderir.
  </p>
</div>
  </div> <!-- /notifications-container -->
</div>

<!-- KİŞİSELLEŞTİRME Sekmesi (Yeni, card mantığında) -->
<div class="tab-content" id="kisisellestirme">

<!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
<div class="notifications-container">

<!-- 0. Kart : Kişisel Asistan Modu -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/kisisellestirme.png" alt="Kişiselleştirme" class="notification-icon" draggable="false">
      <span class="notification-name">Kişisel Asistan Modu</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    quik modelinin sana nasıl davranması gerektiğini belirleyebilirsin.
  </p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

  <div class="general-card" style="margin-top:1.25rem; padding-top:0.5rem;">

  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/instructions.png" alt="Özel Talimatlar" class="notification-icon" draggable="false" style="margin-top: 0.5rem;">
      <span class="notification-name" style="margin-top: 0.5rem;">Özel Talimatlar</span>
    </div>
  </div>

  <!-- Açıklama -->
  <p class="notification-description">
    Kendi talimatını belirleyebilir veya üç farklı talimattan birini seçebilirsin.
  </p>

    <!-- Kartın Üst Barı (Top Bar) -->
    <div class="card-topbar">
      <div class="general-heading-left">
      </div>
    </div>

    <!-- Prompt Seçenekleri (Theme-btn stilinde) -->
    <div class="prompt-selection">
      <button type="button" class="theme-btn" onclick="setPrompt('special', this)">
        <div style="text-align: center;">
          <strong>Özel</strong><br>
          <small>Sizin Kararınız</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('professional', this)">
        <div style="text-align: center;">
          <strong>Profesyonel</strong><br>
          <small>Saygı ve Ciddiyet</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('energetic', this)">

        <div style="text-align: center;">
          <strong>Enerjik</strong><br>
          <small>Canlılık ve Motivasyon</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('friendly', this)">

        <div style="text-align: center;">
          <strong>Samimi</strong><br>
          <small>Empati ve Samimiyet</small>
        </div>
      </button>
    </div>

    <!-- Statik Prompt Girişi -->
    <div class="personalization-input">
      <textarea 
        id="static-prompt" 
        placeholder="Örnek: 'Her zaman kısa ve öz cevap ver' veya 'Bana esprili bir şekilde yanıt ver'" 
        rows="7" 
        style="width: 100%;"
      ></textarea>
    </div>

    <!-- Ayarları Kaydet Butonu -->
    <div class="save-button-container">
      <button id="save-personalization" class="theme-btn">Kişiselleştirmeyi Kaydet</button>
    </div>
  </div>
</div>

<!-- KONUŞMA Sekmesi (Bildirimler tarzında yeniden tasarlandı) -->
<div class="tab-content" id="konusma">

<!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
<div class="notifications-container">

<!-- 0. Kart : Kişisel Asistan Modu -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/konusma.png" alt="Konuşma" class="notification-icon" draggable="false">
      <span class="notification-name">Sesli Konuşma Modu</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    Seçtiğiniz kişi, konuşma tarzını ve üslubunu etkileyebilir.
  </p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">
  <div class="notifications-container">

<!-- 1 Kart: Sesli Konuşma Seçimi + Ses Deneme Butonları -->
<div class="notification-card" style="margin-top:1rem; padding-top:0.5rem;">

  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/voice_chat.png" alt="Sesli Konuşma" class="notification-icon" draggable="false" style="margin-top: 0.5rem;">
      <span class="notification-name" style="margin-top: 0.5rem;">Asistan Seçimi</span>
    </div>
  </div>

  <!-- Açıklama -->
  <p class="notification-description">
    Sky, Gia, Dan ve Dom adlı sesli konuşma asistanlarını keşfet.
  </p>

  <!-- Kişi Seçimi -->
<div class="language-selection" style="margin-top:0.5rem;">
  <select id="conversation-person">
    <option value="sky">Sky</option>
    <option value="gia">Gia</option>
    <option value="dan">Dan</option>
    <option value="dom">Dom</option>
  </select>
</div>

  <!-- Ses Stili Deneme Butonları -->
  <div class="voice-options">
    <div class="voice-option">
      <button class="voice-check-btn" id="voice-btn-sky" onclick="toggleVoice('sky')">Sky'ı Dene</button>
      <p class="voice-description"><strong>Sky:</strong> Dengeli ve sakin bir üslupla iletişim kurar.</p>
    </div>
    <div class="voice-option">
      <button class="voice-check-btn" id="voice-btn-gia" onclick="toggleVoice('gia')">Gia'yı Dene</button>
      <p class="voice-description"><strong>Gia:</strong> Heyecanlı ve enerjik bir üslubu vardır.</p>
    </div>
    <div class="voice-option">
      <button class="voice-check-btn" id="voice-btn-dan" onclick="toggleVoice('dan')">Dan'ı Dene</button>
      <p class="voice-description"><strong>Dan:</strong> Canlı ve dinamik bir üsluba sahiptir.</p>
    </div>
    <div class="voice-option">
      <button class="voice-check-btn" id="voice-btn-dom" onclick="toggleVoice('dom')">Dom'u Dene</button>
      <p class="voice-description"><strong>Dom:</strong> Doğrudan ve kararlı bir tarzda konuşur.</p>
    </div>
  </div>
</div>


<!-- 3. Kart: Mikrofon Testi -->
<div class="notification-card" id="mic-test-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/mic_test.png" alt="Mikrofon Testi" class="notification-icon" draggable="false">
      <span class="notification-name">Mikrofon Testi</span>
    </div>
  </div>

  <p class="notification-description">
    Testi başlattığınızda ses seviyeniz aşağıdaki çubukta görünecektir.
  </p>

  <div class="voice-option">
    <div class="mic-visualizer">
      <div class="mic-bar" id="mic-bar"></div>
    </div>

    <!-- Butonlar -->
    <button class="voice-check-btn" id="start-mic-btn" onclick="startMicTest()">Testi Başlat</button>
    <button class="voice-check-btn" id="stop-mic-btn" onclick="stopMicTest()" style="display: none;">Testi Durdur</button>
  </div>
</div>
</div>
</div>


<!-- GEÇMİŞ Sekmesi -->
<div class="tab-content" id="gecmis">

<!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
<div class="notifications-container">

<!-- 0. Kart : Geçmişinizi Yönetin -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/gecmis.png" alt="Geçmiş" class="notification-icon" draggable="false">
      <span class="notification-name">Geçmişinizi Yönetin</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    Sohbet geçmişini ve arşivini buradan yönetebilirsin.</p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

  <div class="settings-list">
    <div class="general-card" style="margin-top:1rem;">
      <div class="card-topbar">
        <div class="general-heading-left">
	<img src="icons/stock_message.png" alt="Geçmiş" class="notification-icon" draggable="false">
          <span class="general-name">Mevcut Sohbet Sayısı: <span id="chat-count">0</span>/200</span>
        </div>
      </div>
      <p class="general-description">En fazla 200 sohbet saklanabilir. Eğer bu sınır aşılırsa en eski sohbetler otomatik olarak arşivlenir. Arşiv hakkında daha fazla bilgi için tıkla.</p>
      <div class="description-list">
        <span class="general-count">
          <div class="progress-container">
            <div id="progress-bar" class="progress-bar">
              <div id="progress-bar-fill" class="progress-bar-fill"></div>
            </div>
            <!-- NEW: action row -->
<div class="progress-actions">
  <button id="archive-all-chats"  class="danger-btn" style="background-color: #2d30e5;">Bütün Sohbetleri Arşivle</button>
  <button id="delete-all-chats"   class="danger-btn">Bütün Sohbetleri Sil</button>
</div>
          </div>
        </span>
      </div>
    </div>

    <!-- Sohbet Özetleyici Kartı -->
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
<img src="icons/summary.png" alt="Özet" class="notification-icon" draggable="false">
          <span class="general-name">Sohbet Özetleyici</span>
        </div>
      </div>
      <p class="general-description">Seçilen sohbet başlığının özeti aşağıda gösterilir.</p>
      <div class="description-list">
        <span class="general-count summary-actions-container">
          <select id="chat-summary-dropdown" class="setting-row select">
            <option value="" disabled selected>Sohbet Seçin</option>
          </select>
          <!-- Düzenleme ve Silme Butonları -->
          <div class="history-actions summary-actions">
<button class="edit-btn theme-filter-btn" id="edit-summary-btn" disabled style="background: none;">
  <img src="icons/edit_btn.png" alt="Düzenle" draggable="false">
</button>
<button class="delete-btn theme-filter-btn" id="delete-summary-btn" disabled style="background: none;">
  <img src="icons/delete_btn.png" alt="Sil" draggable="false">
</button>
          </div>
        </span>
      </div>
      <p class="general-description summary-text" style="display: none;"></p> <!-- Özetin gösterileceği alan -->
    </div>
  </div>
</div>


<!-- BAĞLI PROGRAMLAR Sekmesi -->
<div class="tab-content" id="bagliprogramlar">
  <div class="settings-list">

<!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
<div class="notifications-container">

<!-- 0. Kart : Geçmişinizi Yönetin -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/bagli_programlar.png" alt="Programları Ayarla" class="notification-icon" draggable="false">
      <span class="notification-name">Programları Ayarla (Beta)</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    MsSQL ve Python programlarını sistemine entegre et.</p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

    <div class="notifications-container">
      <!-- SQL Kartı -->
      <div class="notification-card" style="margin-top: 1rem;">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/sql_icon.png" alt="MsSQL" class="notification-icon" draggable="false">
            <span class="notification-name">MsSQL</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-sql" onchange="toggleCodeBlock('sql')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          MsSQL sorgularınızı quik ile kolayca hazırlayın ve çalıştırın.
        </p>
        <div id="sql-code" class="code-block-container" style="display: none;">
          <pre><code class="language-sql">SELECT MemberTable* 
FROM MemberTable 
WHERE FullName = 'quik' 
LIMIT 1;</code></pre>
        </div>
      </div>
      
      <!-- Python Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/python_icon.png" alt="Python" class="notification-icon" draggable="false">
            <span class="notification-name">Python</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-python" onchange="toggleCodeBlock('python')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          Python kodlarınızı quik ile kolayca hazırlayın ve çalıştırın.
        </p>
        <div id="python-code" class="code-block-container" style="display: none;">
          <pre><code class="language-python">class quikAssistant:
    def __init__(self, name):
        self.name = name
    
    def respond(self, message):
        return f"{self.name}: {message}"

quik = quikAssistant("quik")
print(quik.respond("Merhaba dostum"))</code></pre>
        </div>
      </div>
      
      <!-- JavaScript Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/javascript_icon.png" alt="JavaScript" class="notification-icon" draggable="false">
            <span class="notification-name">JavaScript (Yakında)</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-javascript" onchange="toggleCodeBlock('javascript')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          JavaScript ile kodlamaya başlayın, quik size yol göstersin!
        </p>
        <div id="javascript-code" class="code-block-container" style="display: none;">
          <pre><code class="language-javascript">const quikChat = {
  init: function() {
    console.log("quik hazır!");
  },
  sendMessage: function(msg) {
    return `quik: ${msg} aldım, buradayım!`;
  }
};

quikChat.init();
console.log(quikChat.sendMessage("Nasılsın?"));</code></pre>
        </div>
      </div>

      <!-- CSS Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/css_icon.png" alt="CSS" class="notification-icon" draggable="false">
            <span class="notification-name">CSS (Yakında)</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-css" onchange="toggleCodeBlock('css')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          CSS ile tasarım mı, quik ile hemen CSS'e başlayın.
        </p>
        <div id="css-code" class="code-block-container" style="display: none;">
          <pre><code class="language-css">.havali-quik {
  padding: 10px;
  font-size: 10px;
  font-weight: 1000;
}
</code></pre>
        </div>
      </div>
      
    </div>
  </div>
</div>



<!-- BAĞLI UYGULAMALAR Sekmesi -->
<div class="tab-content" id="bagliuygulamalar">
  <div class="notifications-container">
    
<!-- 0. Kart : Kişisel Asistan Modu -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/google_icon.png" alt="Konuşma" class="notification-icon" draggable="false" style="filter: invert(0);">
      <span class="notification-name">Google Uygulamaları</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description" style="margin-bottom:1rem;">
    Google uygulamalarına bağlanarak deneyiminizi üst seviyeye taşıyın.
  </p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">
  <div class="notifications-container">

<!-- Gmail Kartı (BAĞLI UYGULAMALAR Sekmesi içinde) -->
<div class="notification-card" style="margin-top: 1rem;">
  <div class="notification-header" id="security-header">
    <div class="notification-heading-left">
      <img src="icons/gmail_icon.png" alt="Gmail" class="notification-icon" draggable="false" style="filter: invert(0);">
      <span class="notification-name">Google Mail</span>
    </div>
      <button class="connect-btn" id="login-btn" onclick="connectGmail()">Bağlan</button>
  </div>
  <p class="notification-description">
    Google Mail entegrasyonu ile e-postalarınıza erişim sağlanır.
  </p>
</div>

    <!-- Google Drive Kartı -->
<div class="notification-card">
  <div class="notification-header" id="security-header">
    <div class="notification-heading-left">
      <img src="icons/gdrive_icon.png" alt="Google Drive" class="notification-icon" draggable="false" style="filter: invert(0);">
      <span class="notification-name">Google Drive</span>
    </div>
    <button class="connect-btn" id="login-btn" onclick="connectGoogleDrive()">Bağlan</button>
  </div>
  <p class="notification-description">
    Google Drive entegrasyonu ile dosyalarınıza erişim sağlanır.
  </p>
</div>

    <!-- Google Chat Kartı -->
    <div class="notification-card">
      <div class="notification-header" id="security-header">
        <div class="notification-heading-left">
          <img src="icons/gtalk_icon.png" alt="Google Chat" class="notification-icon" draggable="false" style="filter: invert(0);">
          <span class="notification-name">Google Chat</span>
        </div>
        <button class="connect-btn" id="login-btn" onclick="connectGtalk()">Bağlan</button>
      </div>
      <p class="notification-description">
        Google Chat entegrasyonu ile mesajlarınıza cevap üretilir.
      </p>
 </div>

    <!-- Google Drive Kartı -->
<div class="notification-card">
  <div class="notification-header" id="security-header">
    <div class="notification-heading-left">
      <img src="icons/google_calendar_icon.png" alt="Google Takvim" class="notification-icon" draggable="false" style="filter: invert(0);">
      <span class="notification-name">Google Takvim</span>
    </div>
    <button class="connect-btn" id="login-btn" onclick="connectGoogleCalendar()">Bağlan</button>
  </div>
  <p class="notification-description">
    Google Takvim entegrasyonu ile takviminize erişim sağlanır.
  </p>
</div>


<!-- Başlık : Microsoft uygulamaları -->
  <div class="notifications-container">
    
<!-- 0. Kart : Microsoft uygulamaları -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/microsoft_icon.png" alt="Microsoft" class="notification-icon" draggable="false" style="filter: invert(0);">
      <span class="notification-name">Microsoft Uygulamaları</span>
    </div>

    <!-- Ana anahtar -->
<label class="notification-switch" draggable="false"
       style="pointer-events: none;" aria-hidden="true" tabindex="-1">
</label>
  </div>

  <!-- Açıklama istersen bırak, istemezsen bu <p>’yi silebilirsin -->
  <p class="notification-description">
    Microsoft uygulamalarına bağlanarak deneyiminizi üst seviyeye taşıyın.
  </p>
  </div>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">


    <!-- Microsoft OneDrive Kartı -->
    <div class="notification-card">
      <div class="notification-header" id="security-header">
        <div class="notification-heading-left">
          <img src="icons/onedrive_icon.png" alt="OneDrive" class="notification-icon" draggable="false" style="filter: invert(0);">
          <span class="notification-name">Microsoft OneDrive</span>
        </div>
        <button class="connect-btn" id="login-btn" onclick="connectMicrosoft()">Bağlan</button>
      </div>
      <p class="notification-description">
        OneDrive entegrasyonu ile dosyalarınıza erişim sağlanır.
      </p>
    </div>

  </div>
</div>

<!-- HESAP Sekmesi -->
<div class="tab-content" id="hesap">
  <div class="notifications-container">
    
<!-- 0. Kart : Hesap Ayarları -->
<div class="notification-card master-notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/hesap.png" alt="Hesap" class="notification-icon" draggable="false">
      <span class="notification-name">Hesap Ayarları</span>
    </div>
    
    <label class="notification-switch" draggable="false"
      style="pointer-events: none;" aria-hidden="true" tabindex="-1">
    </label>
  </div>

    <p class="notification-description">
    quik uygulamasına giriş yap ve iki aşamalı doğrulamayı aktif et.
    </p>
</div>

<!-- İnce ayraç -->
<hr class="notification-divider">

<!-- 1. Kart: Hesap Girişi -->
  <div class="notification-card">
    <div class="notification-header" id="security-header">
      <div class="notification-heading-left">
        <img src="icons/hesap.png" alt="Hesap" class="notification-icon" draggable="false">
        <span class="notification-name">Hesap</span>
      </div>
      <button class="connect-btn"
        id="login-btn"
        onclick="redirectToRegister(this)">Oturum Aç</button>
  </div>
  <p class="notification-description" id="login-info-text">
    quik uygulamasından daha iyi faydalanmak için giriş yapmalısınız.
  </p>
  </div>
    
<!-- 2. Kart: Hesap Güvenliği -->
 <div class="notification-card">
  <div class="notification-header" id="security-header">
    <div class="notification-heading-left">
      <img src="icons/security.png" alt="Güvenlik" class="notification-icon" draggable="false">
      <span class="notification-name">Güvenlik</span>
    </div>
      <button class="connect-btn" id="login-btn">İki Aşamalı Doğrulama</button>
  </div>
  <p class="notification-description" id="login-info-text">
    Hesabınızın güvenliğini artırmak için iki aşamalı doğrulamayı açın.
  </p>
  </div>

  </div> <!-- /notifications-container -->
</div> <!-- /tab-content -->

      </div><!-- /settings-content -->
    </div><!-- /settings-body -->
  </div><!-- /settings-modal-content -->
</div><!-- /settings-modal -->



<!-- Silme Onay Modali -->
<div id="confirm-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h2 id="confirm-message">Tüm sohbetleri silmek istediğinizden emin misiniz?</h2>
    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 20px;">
      <button class="connect-btn" onclick="confirmAction()" style="padding:10px; font-size: 0.85rem;">Evet</button>
      <button class="connect-btn" onclick="cancelAction()" style="padding:10px; font-size: 0.85rem;">Hayır</button>
    </div>
  </div>
</div>

<!-- Başlık Düzenleme Modali -->
<div id="edit-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h2>Yeni Başlık Girin</h2>
    <input type="text" id="new-title-input" placeholder="Yeni başlık..." style="width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc;">
    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 20px;">
      <button class="connect-btn" onclick="confirmEditTitle()" style="padding:10px; font-size: 0.85rem;">Tamam</button>
      <button class="connect-btn" onclick="cancelEditTitle()" style="padding:10px; font-size: 0.85rem;">İptal</button>
    </div>
  </div>
</div>


<!-- Görsel Lightbox Modal -->
<div id="image-modal" class="image-modal">
  <div class="image-modal__container">
    <img id="modal-img" class="image-modal__img" src="" alt="Görsel" />
  </div>
</div>








  <!-- Marked ve Highlight.js Kütüphaneleri -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

  <script>
    
/* ======================
     GLOBAL DEĞİŞKENLER & STATE
====================== */
let conversations = [];
let currentConversation = null;
let currentAssistantBubble = null;
let currentFetchAbortController = null;
let isStreaming = false;
let enableWebSearch = false;
let selectedModel = localStorage.getItem("selectedModel") || "quik-est"; // Yeni: Seçilen model
let globalFeedbackTooltipDelayed = false;
let botSettings = {
  staticPrompt: localStorage.getItem("staticPrompt") || "" // Varsayılan boş prompt
};

const chatContainer = document.getElementById("chat-container");
const chatInput = document.getElementById("chat-input-textarea");
const sendBtn = document.getElementById("send-btn");
const voicePageBtn = document.getElementById("voice-page-btn");
const newChatBtn = document.getElementById("new-chat-btn");
const chatHistoryList = document.getElementById("chat-history-list");
const sidebar = document.getElementById("sidebar");
const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
const welcomeMessage = document.getElementById("welcome-message");
const sidebarBrand = document.getElementById("sidebar-brand");
const mainContent = document.querySelector(".main-content");
const scrollWrapper = document.querySelector(".scroll-wrapper");


/* ======================
     LOCAL STORAGE İŞLEMLERİ
====================== */
function saveConversations() {
  localStorage.setItem("conversations", JSON.stringify(conversations));
}

function loadConversations() {
  const saved = localStorage.getItem("conversations");
  if (saved) {
    conversations = JSON.parse(saved);
    // Mevcut sohbetlere timestamp ekle (eğer yoksa)
    conversations = conversations.map(conv => ({
      ...conv, timestamp: conv.timestamp || Date.now() // Varsayılan olarak şu anki zaman
    }));
    if (conversations.length > 0) {
      currentConversation = null;
    }
  }
}

function updateChatCount() {
  const chatCountSpan = document.getElementById("chat-count");
  const progressBar = document.getElementById("progress-bar");
  if (chatCountSpan && progressBar) {
    const currentCount = conversations.length;
    chatCountSpan.textContent = currentCount;
    const percentage = Math.round((currentCount / 200) * 100);

    // Progress bar doldurma
    let fillElement = progressBar.querySelector(".progress-bar-fill");
    if (!fillElement) {
      fillElement = document.createElement("div");
      fillElement.className = "progress-bar-fill";
      progressBar.appendChild(fillElement);
    }

    // Yüzdeye göre renk ve genişlik ayarla
    fillElement.style.width = `${percentage}%`;
    fillElement.textContent = `${percentage}% dolu`;

    if (percentage <= 33) {
      fillElement.style.backgroundColor = "#4CAF50"; // Yeşil (az yüklü)
    } else if (percentage <= 66) {
      fillElement.style.backgroundColor = "#FFC107"; // Sarı (orta yüklü)
    } else {
      fillElement.style.backgroundColor = "#F44336"; // Kırmızı (çok yüklü)
    }
  }
}

// İlk yüklemede ve her değişiklikte güncelle
loadConversations();
updateChatCount();

/* ======================
     YARDIMCI FONKSİYONLAR
====================== */

// Tüm tooltip’li elementlere fonksiyonu uygula
document.addEventListener("DOMContentLoaded", () => {

  // Sidebar toggle butonuna tooltip ekleme
  const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
  if (toggleSidebarBtn && toggleSidebarBtn.dataset.tooltip) {
    console.log("Sidebar butonu bulundu:", toggleSidebarBtn.dataset.tooltip);
  } else {
    console.log("Sidebar butonu bulunamadı veya tooltip yok.");
  }

  // Diğer tooltip’li butonlara tooltip ekleme
  const otherButtons = document.querySelectorAll('[data-tooltip]');
  console.log("Toplam tooltip’li buton sayısı:", otherButtons.length);
  otherButtons.forEach(button => {
    console.log("Diğer buton işleme alındı:", button.dataset.tooltip);
// Tüm tooltip’li butonları seç
  const tooltipButtons = document.querySelectorAll("[data-tooltip]");

  tooltipButtons.forEach(button => {
    button.addEventListener("click", () => {
      // Tıklama anında tooltip’i gizle
      button.classList.add("no-tooltip");

      // Fare ayrıldığında veya 1 saniye sonra tooltip’i tekrar aktif et
      const resetTooltip = () => {
        button.classList.remove("no-tooltip");
      };

      // Fare ayrıldığında reset
      button.addEventListener("mouseleave", resetTooltip, { once: true });

      // Alternatif olarak, 1 saniye sonra reset (isteğe bağlı)
      setTimeout(() => {
        button.classList.remove("no-tooltip");
      }, 1000);
    });
  });


  });
});

function renderChatHistory() {
  chatHistoryList.innerHTML = ""; // Clear once

  const groupedConversations = conversations.reduce((acc, conv) => {
    const dateKey = formatRelativeDate(conv.timestamp);
    if (!acc[dateKey]) acc[dateKey] = [];
    acc[dateKey].push(conv);
    return acc;
  }, {});

  const sortedDates = Object.keys(groupedConversations).sort((a, b) => {
    const dateA = groupedConversations[a][0].timestamp;
    const dateB = groupedConversations[b][0].timestamp;
    return dateB - dateA;
  });

  sortedDates.forEach((date) => {
    const headerLi = document.createElement("li");
    headerLi.className = "chat-history-group";
    headerLi.innerHTML = `<div class="chat-history-header">${date}</div>`;
    chatHistoryList.appendChild(headerLi);

    const sortedConversations = groupedConversations[date].sort(
      (a, b) => b.timestamp - a.timestamp
    );
    sortedConversations.forEach((conv) => {
      const li = document.createElement("li");
      li.className = `chat-history-item${
        currentConversation?.id === conv.id ? " active" : ""
      }`;
      li.dataset.id = conv.id;

      const favoriteIcon = conv.favorite
        ? `<img src="icons/favorite_btn.png" alt="Favorited" style="width:12px; height:12px; margin-right:5px;" draggable="false">`
        : "";

      li.innerHTML = `
        <span class="chat-history-title">${favoriteIcon}${conv.title || "Yeni Sohbet"}</span>
        <div class="history-actions">
          <button class="more-options-btn"><img src="icons/more_options.png" alt="Seçenekler" draggable="false" /></button>
        </div>
      `; // Dropdown menüyü henüz eklemiyoruz

      // Dropdown menüsünü oluştur
      const dropdownMenu = document.createElement("div");
      dropdownMenu.className = "dropdown-menu";
      // style.display = "none"; CSS'den geldiği için burada ayarlamaya gerek yok
      dropdownMenu.innerHTML = `
        <button class="dropdown-item edit-btn">
          <img src="icons/edit_btn.png" alt="Düzenle" draggable="false" style="width:10px; height:10px; margin-right:5px;" />
          <span>Düzenle</span>
        </button>
        <button class="dropdown-item delete-btn">
	<span style="color: red;">
  	<img src="icons/delete_btn.png" alt="Sil" draggable="false" 
     	  style="width:10px; height:10px; margin-right:5px; filter: invert(21%) sepia(99%) saturate(7484%) hue-rotate(359deg) brightness(93%) contrast(119%);" />
  	Sil
	</span>
        </button>
      `;
      // Dropdown menüsünü body yerine li'ye ekle!
      li.appendChild(dropdownMenu);

      // More-options-btn click handler
      const moreOptionsBtn = li.querySelector(".more-options-btn");
      moreOptionsBtn.addEventListener("click", (e) => {
        e.stopPropagation(); // Olayın li'ye yayılmasını engelle

        // Diğer tüm açık dropdown'ları kapat
        document.querySelectorAll(".dropdown-menu").forEach((menu) => {
          if (menu !== dropdownMenu) {
            menu.style.display = "none";
          }
        });

        // Mevcut dropdown'un görünürlüğünü tersine çevir
        const isCurrentlyVisible = dropdownMenu.style.display === "block";
        dropdownMenu.style.display = isCurrentlyVisible ? "none" : "block";

        // Eğer menü açılıyorsa, konumunu ayarla
        if (!isCurrentlyVisible) {
          // Butonun li içerisindeki konumuna göre hesaplama yap
          const buttonRightEdge = moreOptionsBtn.offsetLeft + moreOptionsBtn.offsetWidth;
          const buttonVerticalCenter = moreOptionsBtn.offsetTop + moreOptionsBtn.offsetHeight / 2;

          // Menüyü butonun sağına ve dikeyde ortalayacak şekilde konumlandır
          // (Dropdown'un yüksekliğini bilmemiz gerekebilir, ölçüm yapabilir veya sabit varsayabiliriz)
          // Önce gösterip sonra ölçmek daha doğru sonuç verir:
          dropdownMenu.style.left = `${buttonRightEdge + 65}px`; // Butonun sağına 5px boşlukla
          dropdownMenu.style.top = `${buttonVerticalCenter - dropdownMenu.offsetHeight / 2}px`; // Dikeyde ortala

          // --- Kenar Taşması Kontrolü (Opsiyonel ama Önerilir) ---
          // Menünün ekran dışına taşıp taşmadığını kontrol et
          const menuRect = dropdownMenu.getBoundingClientRect(); // Viewport'a göre konum
          const listRect = chatHistoryList.getBoundingClientRect(); // Liste konteynerinin konumu

          // Sağ kenar taşması
          if (menuRect.right > listRect.right) {
             // Butonun soluna almayı deneyebiliriz
             dropdownMenu.style.left = `${moreOptionsBtn.offsetLeft - dropdownMenu.offsetWidth - 5}px`;
          }
          // Alt kenar taşması (gerekirse yukarı kaydır)
           if (menuRect.bottom > window.innerHeight) {
             dropdownMenu.style.top = `${moreOptionsBtn.offsetTop - dropdownMenu.offsetHeight + moreOptionsBtn.offsetHeight / 2 }px`; // Yukarı kaydır
           }
          // Üst kenar taşması (gerekirse aşağı kaydır)
           if (menuRect.top < 0) {
             dropdownMenu.style.top = `${moreOptionsBtn.offsetTop + moreOptionsBtn.offsetHeight / 2}px`; // Aşağı kaydır
           }
           // --- ---
        }
      });

      // --- Edit ve Delete Butonları için Olay Dinleyicileri (Değişiklik Yok) ---

      // Edit button handler
      dropdownMenu.querySelector(".edit-btn").addEventListener("click", (e) => {
        e.stopPropagation();
        dropdownMenu.style.display = "none"; // Close dropdown
        const titleSpan = li.querySelector(".chat-history-title");
        // ... (geri kalan edit kodu aynı)
        const currentTitle = conv.title || "Yeni Sohbet";
        const input = document.createElement("input");
        input.type = "text";
        input.value = currentTitle;
        input.className = "chat-history-title edit-input";
        input.style.width = "80%";
        const computedStyle = window.getComputedStyle(titleSpan);
        input.style.fontFamily = computedStyle.fontFamily;
        input.style.fontSize = computedStyle.fontSize;
        input.style.fontWeight = computedStyle.fontWeight;
        input.style.color = computedStyle.color;
        input.style.userSelect = "text";
        input.addEventListener("click", (event) => event.stopPropagation());
        input.addEventListener("mousedown", (event) => event.stopPropagation());
        input.addEventListener("mouseup", (event) => event.stopPropagation());
        titleSpan.replaceWith(input);
        input.focus();

        function finishEditing() {
            const newTitle = input.value.trim() || currentTitle;
            conv.title = newTitle;

            // aktif sohbet düzenleniyorsa tarayıcı başlığını da güncelle
            if (currentConversation && currentConversation.id === conv.id) {
                document.title = newTitle || "quik";
            }

            renderChatHistory();
            saveConversations();
            updateTopBarTitle();
            goToChat(conv.id);
            populateChatSummaryDropdown();
        }

        input.addEventListener("blur", finishEditing);
        input.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                event.preventDefault();
                event.stopPropagation();
                input.blur();
            } else if (event.key === "Escape") {
                event.preventDefault();
                event.stopPropagation();
                // input.value = currentTitle; // Değişikliği geri al
                input.blur(); // Blur yine finishEditing'i tetikler, en iyisi render'ı çağırmak
                conv.title = currentTitle; // Değişikliği geri al (önemli)
                renderChatHistory(); // Esc ile iptalde listeyi eski haline getir
                saveConversations(); // Geri alınan hali kaydet
                populateChatSummaryDropdown();
                updateTopBarTitle();
            }
        });
      });

      // Delete button handler
      dropdownMenu.querySelector(".delete-btn").addEventListener("click", (e) => {
        e.stopPropagation();
        dropdownMenu.style.display = "none";

        openConfirmModal(() => {
          // 1) Sohbeti diziden çıkar ve kaydet
          conversations = conversations.filter(c => c.id !== conv.id);
          saveConversations();

          const deletedIsActive = currentConversation?.id === conv.id;

          if (deletedIsActive) {
            // ── Aktif sohbet silindi ──
            currentConversation = null;
            chatContainer.innerHTML = "";
            chatContainer.appendChild(welcomeMessage);
            welcomeMessage.style.display = "block";
            saveLastConversationId(null);
            goToHome();                        // Yalnızca bu durumda ana sayfa
            document.title = "quik";
          } else {
            // ── Başka bir sohbet silindi ──
            // URL ve currentConversation dokunulmaz
            saveLastConversationId(currentConversation?.id || null);
          }

          // Ortak güncellemeler
          renderChatHistory();
          updateChatCount();
          populateChatSummaryDropdown();
          updateTopBarTitle();
        }, "Bu sohbeti silmek istediğinize emin misiniz?");
      });

      // --- li Tıklama Olayı (Değişiklik Yok) ---
      li.addEventListener("click", (e) => {
        // Eğer tıklanan yer buton veya menü ise li tıklamasını tetikleme
        if (
          moreOptionsBtn.contains(e.target) ||
          dropdownMenu.contains(e.target) ||
          li.querySelector('.edit-input')?.contains(e.target) // Düzenleme input'una tıklanınca da engelle
        ) {
          return;
        }

        currentConversation = conv;
        saveLastConversationId(currentConversation.id);
        renderChat();
        renderChatHistory();
        closeChatSearch();

        // Aktif sınıfı tekrar ayarla (renderChatHistory içinde yapılıyor ama garanti olsun)
        document.querySelectorAll(".chat-history-item").forEach((item) => item.classList.remove("active"));
        const activeItem = document.querySelector(`.chat-history-item[data-id="${conv.id}"]`);
        if (activeItem) activeItem.classList.add("active");


        document.title = currentConversation.title || "quik";
        updateTopBarTitle();
        goToChat(conv.id);
      });


      chatHistoryList.appendChild(li);
    });
  });
}

// --- Global Click Listener Güncellemesi ---
// Bu listener'ı renderChatHistory DIŞINA taşı (zaten öyleymiş, ama içeriğini güncelle)

// Önceki global listener'ı kaldır (eğer birden fazla eklenmesini önlemek için)
// document.removeEventListener("click", handleGlobalClick); // Eğer bir isim verdiyseniz

// Yeni global click listener
function handleGlobalClick(e) {
    // Açık olan bir dropdown menü var mı kontrol et
    const openDropdown = document.querySelector(".dropdown-menu[style*='display: block']");

    if (openDropdown) {
        const parentLi = openDropdown.closest('.chat-history-item');
        const triggerButton = parentLi?.querySelector('.more-options-btn');

        // Tıklama, açık olan menünün veya onu açan butonun dışındaysa menüyü kapat
        if (!openDropdown.contains(e.target) && !(triggerButton && triggerButton.contains(e.target))) {
            openDropdown.style.display = 'none';
        }
    }
}

// Listener'ı ekle (sayfa yüklendiğinde bir kere)
document.addEventListener("click", handleGlobalClick);

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    document.querySelectorAll(".dropdown-menu").forEach(menu => {
      menu.style.display = "none";
    });
  }
});


function formatRelativeDate(timestamp) {
  const now = new Date();
  const date = new Date(timestamp);

  // Normalize to start of the day (00:00:00)
  const startOfToday = new Date(now.setHours(0, 0, 0, 0));
  const startOfInputDate = new Date(date.setHours(0, 0, 0, 0));

  // Calculate difference in days
  const diffTime = startOfToday - startOfInputDate;
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return "Bugün"; // Same calendar day
  if (diffDays === 1) return "Dün";   // Previous calendar day
  if (diffDays >= 2 && diffDays <= 6) return `${diffDays} Gün Önce`; // 2 to 6 days ago
  return date.toLocaleDateString("tr-TR", { day: "numeric", month: "long", year: 'numeric' }); // Older dates
}

function isUserAtBottom(threshold = 50) {
  return chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - threshold;
}

function scrollChatToBottom() {
  setTimeout(() => {
    scrollWrapper.scrollTop = scrollWrapper.scrollHeight;
  }, 100);
}

// Mevcut mesajları yüklerken feedback butonlarını eklemek için renderChat güncellemesi
function renderChat() {
  chatContainer.innerHTML = "";
  if (currentConversation && currentConversation.messages.length > 0) {
    currentConversation.messages.forEach(msg => {
      const bubble = appendMessageBubble(msg.sender, msg.text, msg.id, msg.images || []);
      if (msg.sender === "assistant" && msg.complete) {
        addFeedbackControls(bubble, msg.text);
      }
    });
  } else {
    chatContainer.appendChild(welcomeMessage);
  }
  styleCodeBlocks();
  scrollChatToBottom();
}


// appendMessageBubble fonksiyonunu geri dönüş değeriyle güncelle
function appendMessageBubble(sender, text, messageId, imagesB64 = []) {
  const bubble = document.createElement("div");
  bubble.className = "chat-bubble " + (sender === "user" ? "user-bubble" : "assistant-bubble");
  bubble.dataset.msgId = messageId;

  let innerHTML = "";

  // ➋ Eğer user ve elinde Base64 resimler varsa; each görseli <img> olarak ekle
  if (sender === "user" && imagesB64.length > 0) {
    imagesB64.forEach(b64 => {
    innerHTML += `
      <img 
        src="data:image/jpeg;base64,${b64}" 
        alt="attachment" 
        class="attachment-img"
      />
    `;
    });
  }

  // ➌ Sonra metni parse et
  innerHTML += marked.parse(text);
  bubble.innerHTML = innerHTML;

  // ➍ Eğer assistant ise kod bloklarını highlight et
  if (sender === "assistant") {
    bubble.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }
 chatContainer.appendChild(bubble);
 // Her yeni balon oluşturulduğunda lightbox dinleyicisini tetikle
if (window.enableImageModal) window.enableImageModal();
  chatContainer.appendChild(bubble);
  scrollChatToBottom();
  return bubble;
}
// Düz metni tabloya çeviren yardımcı fonksiyon
function convertTextToTable(text) {
  const lines = text.trim().split("\n");
  const rows = lines.map(line => line.split("|").map(cell => cell.trim()).filter(cell => cell));

  if (rows.length < 2 || rows[0].length < 2) return marked.parse(text); // Tablo değilse normal işleme

  let html = '<table>\n<thead>\n<tr>';
  rows[0].forEach(header => {
    html += `<th>${header}</th>`;
  });
  html += '</tr>\n</thead>\n<tbody>';

  for (let i = 1; i < rows.length; i++) {
    if (rows[i].length > 0 && !rows[i][0].startsWith("---")) { // Ayırıcı satırı atla
      html += '<tr>';
      rows[i].forEach(cell => {
        html += `<td>${cell}</td>`;
      });
      html += '</tr>';
    }
  }
  html += '</tbody>\n</table>';
  return html;
}

function createAssistantBubble(assistantMessageId) {
  currentAssistantBubble = document.createElement("div");
  currentAssistantBubble.className = "chat-bubble assistant-bubble";

  // ID’yi dataset’e atıyoruz
  if (assistantMessageId) {
    currentAssistantBubble.dataset.msgId = assistantMessageId;
  }

  const contentDiv = document.createElement("div");
  contentDiv.className = "assistant-content";

  // CANIM DOSTUMUN İSTEDİĞİ KISIM BURASI!
  // Eğer enableWebSearch aktif ise "Web'de aranıyor..." yazısını göster
  if (enableWebSearch) {
    contentDiv.innerHTML = `<div class="searching-indicator">Web'de aranıyor...</div>`;
  } else {
    // Değilse, normal "..." animasyonunu göster
    contentDiv.innerHTML = `
      <div class="typing-indicator">
        <span></span>
        <span></span>
        <span></span>
      </div>
    `;
  }
  
  currentAssistantBubble.appendChild(contentDiv);
  chatContainer.appendChild(currentAssistantBubble);
  scrollChatToBottom();
  return currentAssistantBubble;
}

function removeTrailingWhitespaceNodes(container) {
  while (
    container.lastChild &&
    container.lastChild.nodeType === Node.TEXT_NODE &&
    container.lastChild.textContent.trim() === ""
  ) {
    container.removeChild(container.lastChild);
  }
}

function updateAssistantBubble(text) {
  const contentDiv = currentAssistantBubble.querySelector('.assistant-content');
  if (contentDiv) {

    // Ardından render işlemini yapın
    contentDiv.innerHTML = marked.parse(text);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }
  if (isUserAtBottom()) scrollChatToBottom();
}

function startNewConversation() {
  if (conversations.length >= 200) conversations.shift();
  const id = generateStrongUUID(); // Benzersiz ve uzun ID üretimi
  currentConversation = {
    id: id,
    title: "Yeni Sohbet",
    messages: [],
    timestamp: Date.now(),
    isNew: true
  };
  conversations.push(currentConversation);
  saveConversations();
  renderChat();
  renderChatHistory();
  updateTopBarTitle();
  goToChat(id); // URL'yi güncelle
}


function openSidebar() {
  sidebar.classList.add("open");
  mainContent.classList.add("sidebar-open");
  document.body.classList.add("sidebar-open");

  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu kapat"; // title yerine dataset
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_open_btn.png";
    img.alt = "Sidebar Open Icon";
  }
}

function closeSidebar() {
  sidebar.classList.remove("open");
  mainContent.classList.remove("sidebar-open");
  document.body.classList.remove("sidebar-open");

  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu aç";
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_close_btn.png";
    img.alt = "Sidebar Close Icon";
  }

}

function setSendButtonToStopState() {
  let img = sendBtn.querySelector('img');
  if (!img) {
    img = document.createElement("img");
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
    img.style.width = "50px";
    img.style.height = "50px";
    sendBtn.appendChild(img);
  } else {
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
  }
  sendBtn.classList.add("stop-state");
  if (document.body.classList.contains("dark")) img.classList.add("dark-icon");
  else img.classList.remove("dark-icon");
  sendBtn.style.borderRadius = "12px";
  updateButtonVisibility();
}

function setSendButtonToSendState() {
  sendBtn.innerHTML = `<img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;">`;
  sendBtn.style.backgroundColor = "";
  sendBtn.style.borderRadius = "";
  sendBtn.classList.remove("stop-state");
  updateButtonVisibility();
}

function updateButtonVisibility() {
  const hasText = chatInput.value.trim().length > 0;
  const isStopState = sendBtn.classList.contains('stop-state');

  // Butonları görünür/gizli yapacak yardımcı fonksiyonlar
  const showButton = (btn) => {
    btn.style.visibility = 'visible';
    btn.style.opacity = '1';
    btn.style.pointerEvents = 'auto';
  };

  const hideButton = (btn) => {
    btn.style.visibility = 'hidden';
    btn.style.opacity = '0';
    btn.style.pointerEvents = 'none';
  };

  if (isStopState) {
    // Mesaj gönderimi devam ediyorsa, her zaman durdurma butonu görünür.
    showButton(sendBtn);
    hideButton(voicePageBtn);
  } else {
    // Mesaj gönderimi yoksa, input'un doluluğuna göre buton değişir.
    if (hasText) {
      showButton(sendBtn);
      hideButton(voicePageBtn);
    } else {
      hideButton(sendBtn);
      showButton(voicePageBtn);
    }
  }
}

document.addEventListener("DOMContentLoaded", () => {
  
  // ... diğer DOMContentLoaded kodlarınız ...

  updateButtonVisibility(); // Sayfa yüklendiğinde butonların doğru durumda başlamasını sağlar.
  chatInput.addEventListener('input', updateButtonVisibility); // Yazı yazıldığında veya silindiğinde anında kontrol eder.

});

function addFeedbackControls(bubble, answerText) {
  if (!bubble) {
    console.error("Feedback eklenemedi: Bubble tanımlı değil.");
    return;
  }

  // Mesajı tekrar render et
  const contentDiv = bubble.querySelector('.assistant-content');
  if (contentDiv) {
    contentDiv.innerHTML = marked.parse(answerText);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }

  // Feedback butonlarını ekle
  const feedbackDiv = document.createElement("div");
  feedbackDiv.className = "feedback-controls";

  // 1) Beğen Butonu
  const likeBtn  = document.createElement("button");
  likeBtn.classList.add("like-btn"); 

  // <span> kullan, background-image ile ikon yükle
  const likeIcon = document.createElement("span");
  likeIcon.className = "like-icon";        // CSS’te tanımlayacağız
  likeIcon.setAttribute("aria-label", "Beğen");
  likeIcon.setAttribute("role", "img");    // Erişilebilirlik

  /* Seçilemez + sürüklenemez */
  likeIcon.draggable = false;
  likeIcon.style.userSelect = "none";

  likeBtn.appendChild(likeIcon);
  likeBtn.dataset.tooltip = "Beğendim";

  likeBtn.addEventListener("click", () => {
    if (likeIcon.classList.contains("liked")) return;   // Zaten beğenilmişse
    likeIcon.classList.add("liked");
    dislikeIcon.classList.remove("disliked");
    console.log("Cevap beğenildi:", answerText);
  });


  // 2) Beğenme Butonu
  const dislikeBtn  = document.createElement("button");
  dislikeBtn.classList.add("dislike-btn"); 

  // İkonu <img> yerine <span> olarak tanımla
  const dislikeIcon = document.createElement("span");
  dislikeIcon.className = "dislike-icon";          // CSS’te .dislike-icon → icons/dislike_btn.png
  dislikeIcon.setAttribute("aria-label", "Beğenme");
  dislikeIcon.setAttribute("role", "img");

  /* Seçim / kopyalama / sürükleme koruması */
  dislikeIcon.draggable        = false;
  dislikeIcon.style.userSelect = "none";

  dislikeBtn.appendChild(dislikeIcon);
  dislikeBtn.dataset.tooltip = "Beğenmedim"; // title yerine dataset

  dislikeBtn.addEventListener("click", () => {
    if (dislikeIcon.classList.contains("disliked")) return;     // Zaten beğenilmemişse çık

    dislikeIcon.classList.add("disliked");  // Arka planı icons/disliked_btn.png yapacak CSS sınıfı
    likeIcon.classList.remove("liked");     // Like ikonunu sıfırla
    console.log("Cevap beğenilmedi:", answerText);
  });


/* ────────────── KOPYALA BUTONU ────────────── */
const copyBtn  = document.createElement("button");
copyBtn.classList.add("copy-btn");               // CSS için
const copyIcon = document.createElement("span"); // <img> yerine <span>
copyIcon.className = "copy-icon";                // icons/copy_btn.png  → CSS’te
copyIcon.setAttribute("aria-label", "Kopyala");
copyIcon.setAttribute("role", "img");
copyIcon.draggable        = false;               // Sürükleme engeli
copyIcon.style.userSelect = "none";              // Seçim engeli
["contextmenu", "copy"].forEach(evt =>           // Sağ tık / Ctrl+C engeli
  copyIcon.addEventListener(evt, e => e.preventDefault())
);


copyBtn.appendChild(copyIcon);
copyBtn.dataset.tooltip = "Kopyala";

copyBtn.addEventListener("click", async () => {
  try {
    /* Markdown → HTML */
    const htmlContent = marked.parse(answerText);

    /* Plain-text (Markdown işaretlerini temizle) */
    const plainText = answerText
      .replace(/\*\*/g, '')
      .replace(/\*/g, '')
      .replace(/_/g, '')
      .replace(/~~/g, '');

    /* Clipboard’a ikili formatta yaz */
    const data = [new ClipboardItem({
      'text/html':  new Blob([htmlContent], { type: 'text/html' }),
      'text/plain': new Blob([plainText], { type: 'text/plain' })
    })];
    await navigator.clipboard.write(data);

    copyBtn.classList.add("copied");     // Animasyon için
    copyIcon.classList.add("copied");    // icons/copied_btn.png → CSS’te
  } catch (err) {
    console.error("Kopyalama hatası:", err);
    /* Fallback: düz metin */
    await navigator.clipboard.writeText(answerText);
    copyBtn.classList.add("copied");
    copyIcon.classList.add("copied");
  }

  setTimeout(() => {
    copyBtn.classList.remove("copied");
    copyIcon.classList.remove("copied");
  }, 2000);
});

/* ────────────── YENİDEN ÜRET BUTONU ────────────── */
const regenBtn  = document.createElement("button");
regenBtn.classList.add("regen-btn");             // CSS için
const regenIcon = document.createElement("span");
regenIcon.className = "regen-icon";              // icons/regenerate_btn.png → CSS
regenIcon.setAttribute("aria-label", "Yeniden Üret");
regenIcon.setAttribute("role", "img");
regenIcon.draggable        = false;
regenIcon.style.userSelect = "none";
["contextmenu", "copy"].forEach(evt =>
  regenIcon.addEventListener(evt, e => e.preventDefault())
);

regenBtn.appendChild(regenIcon);
regenBtn.dataset.tooltip = "Tekrar Dene";

regenBtn.addEventListener("click", () => {
  console.log("Cevap yeniden üretiliyor...");
  regenerateAnswer(bubble);
});

/* ────────────── FEEDBACK DIV’ine EKLE ────────────── */
feedbackDiv.appendChild(likeBtn);
feedbackDiv.appendChild(dislikeBtn);
feedbackDiv.appendChild(copyBtn);
feedbackDiv.appendChild(regenBtn);
bubble.appendChild(feedbackDiv);
}

function regenerateAnswer(bubble) {
  if (isStreaming) {
    console.log("Streaming devam ediyor, önce durdurulmalı!");
    return;
  }

  const lastUserMessage = currentConversation.messages
    .filter(msg => msg.sender === "user")
    .slice(-1)[0]?.text;
  if (!lastUserMessage) {
    console.error("Yeniden üretilecek kullanıcı mesajı bulunamadı!");
    return;
  }

  // Balonun data-msg-id’si
  const oldAssistantId = bubble.dataset.msgId;
  // currentConversation’da bu ID’yi bulalım
  const assistantIndex = currentConversation.messages.findIndex(
    msg => msg.id === oldAssistantId
  );

  if (assistantIndex === -1) {
    console.error("Eski asistan mesajı bulunamadı, ekleme yapılıyor...");
    // buraya girerse push da yapabilirsiniz ama genelde bulamaması imkânsız
  }

  // Eski balonu DOM’dan kaldır
  bubble.remove();

  // Yeni asistan mesajı oluşturmak için ID üret
  const newAssistantMessageId = (Date.now() + "_regen").toString();
  const newAssistantMessage = {
    id: newAssistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };

  // Eski mesajın yerine koy
  currentConversation.messages[assistantIndex] = newAssistantMessage;
  saveConversations();

  // Yeni balonu DOM’a ekle
  createAssistantBubble(newAssistantMessageId);

  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  // Streaming isteği
  fetch("http://localhost:5000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      message: lastUserMessage,
      history: currentConversation.messages.slice(0, -1),
      enable_web_search: enableWebSearch,
      model: selectedModel,
      static_prompt: botSettings.staticPrompt,
    }),
    signal: currentFetchAbortController.signal
  })
    .then(response => response.body.getReader())
    .then(reader => {
      let buffer = "";
      const decoder = new TextDecoder();
      let assistantText = "";

      function read() {
        reader.read().then(({ value, done }) => {
          if (done) {
            addFeedbackControls(currentAssistantBubble, assistantText);
            isStreaming = false;
            setSendButtonToSendState();
            return;
          }
          buffer += decoder.decode(value, { stream: true });
          const events = buffer.split("\n\n");
          for (let i = 0; i < events.length - 1; i++) {
            const event = events[i];
            if (event.startsWith("data: ")) {
              const dataStr = event.substring(6).trim();
              if (dataStr === "[DONE]") continue;
              try {
                const dataObj = JSON.parse(dataStr);
                const content = dataObj.text;
                assistantText += content;
                updateAssistantBubble(assistantText);
                newAssistantMessage.text = assistantText;
                saveConversations();
              } catch (e) {
                console.error("JSON parse hatası:", e, dataStr);
              }
            }
          }
          buffer = events[events.length - 1];
          read();
        });
      }
      read();
    })
    .catch(err => {
      if (err.name !== "AbortError") {
        console.error("Yeniden üretme hatası:", err);
        updateAssistantBubble("Yeniden üretme başarısız: " + err.message);
      }
    });
}

async function sendMessage() {
  const userMessage = chatInput.value.trim();
  if (!userMessage) return;

  let fileContent = "";
  let imagesB64   = [];

  if (uploadedFiles.length > 0) {
    const formData = new FormData();
    uploadedFiles.forEach(file => formData.append("files", file));
    try {
      const response = await fetch("http://localhost:5000/upload", {
        method: "POST",
        body: formData
      });
      if (response.ok) {
        const data = await response.json();
        fileContent = data.content;
        imagesB64   = data.images || [];
      } else {
        console.error("File upload error:", response.statusText);
      }
    } catch (err) {
      console.error("File upload API error:", err);
    }
    uploadedFiles = [];
    fileContainer.innerHTML = "";
  }

  const displayedMessage = userMessage;
  const combinedMessage = fileContent 
    ? `${userMessage}\n\n[DOSYA EKİ]:\n${fileContent}`
    : userMessage;

  if (!currentConversation) {
    await startNewConversation();
  }

// ➊ messages dizisine Base64 imajları da ekle
const userMessageId = Date.now().toString() + "_user";
currentConversation.messages.push({
  id: userMessageId,
  sender: "user",
  text: combinedMessage,
  images: imagesB64      // ← burada ekledik
});

// ➋ appendMessageBubble çağrısına imagesB64 parametresini ilet
appendMessageBubble("user", displayedMessage, userMessageId, imagesB64);


  // Check for URL and notify user
  const urlRegex = /https?:\/\/(?:[-\w.]|(?:%[\da-fA-F]{2}))+[^\s]*/;

  chatInput.value = "";
  chatInput.style.height = "auto";
  scrollChatToBottom();

if (currentConversation.messages.length === 1) {
  try {
    const response = await fetch("http://localhost:5000/generate-title", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: combinedMessage })
    });
    const data = await response.json();
    currentConversation.title = data.title || "Yeni Sohbet";
    renderChatHistory();
    document.title = currentConversation.title;
    updateTopBarTitle();
  } catch (err) {
    console.error("Title fetch error:", err);
    currentConversation.title = "Yeni Sohbet";
    renderChatHistory();
    document.title = currentConversation.title;
    updateTopBarTitle();
goToChat(currentConversation.id);
  }
}


  saveConversations();

  const assistantMessageId = (Date.now() + 1).toString() + "_assistant";
  createAssistantBubble(assistantMessageId);
  let assistantText = "";
  let newAssistantMessage = {
    id: assistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };
  currentConversation.messages.push(newAssistantMessage);
  saveConversations();

  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  try {
    const response = await fetch("http://localhost:5000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: combinedMessage,
        history: currentConversation.messages,
        enable_web_search: enableWebSearch,
        model: selectedModel,
        static_prompt: botSettings.staticPrompt,
        images: imagesB64
      }),
      signal: currentFetchAbortController.signal
    });

    if (!response.ok) {
      console.error("Fetch error:", response.statusText);
      updateAssistantBubble("Error: " + response.statusText);
      return;
    }

    let buffer = "";
    const decoder = new TextDecoder();
    const reader = response.body.getReader();
    let done = false;

    while (!done) {
      const { value, done: doneReading } = await reader.read();
      done = doneReading;
      if (value) {
        buffer += decoder.decode(value, { stream: true });
        const events = buffer.split("\n\n");

        for (let i = 0; i < events.length - 1; i++) {
          const event = events[i];
          if (event.startsWith("data: ")) {
            const dataStr = event.substring(6).trim();
            if (dataStr === "[DONE]") {
              done = true;
              addFeedbackControls(currentAssistantBubble, assistantText);
              break;
            }
            try {
              const dataObj = JSON.parse(dataStr);
              const content = dataObj.text;
              assistantText += content;
              updateAssistantBubble(assistantText);
              newAssistantMessage.text = assistantText;
              saveConversations();
            } catch (e) {
              console.error("JSON parse error:", e, dataStr);
            }
          }
        }
        buffer = events[events.length - 1];
      }
    }

    if (!done) {
      addFeedbackControls(currentAssistantBubble, assistantText);
    }

  } catch (err) {
    if (err.name === "AbortError") {
      newAssistantMessage.complete = false;
      console.log("Streaming aborted.");
    } else {
      updateAssistantBubble("Error: " + err.message);
    }
  } finally {
    isStreaming = false;
    setSendButtonToSendState();
    currentFetchAbortController = null;
  }
}

/* ======================
     KOD BLOKLARI İÇİN FONKSİYONLAR
====================== */
const LANGUAGE_MAP = {
  'js': 'JavaScript', 'jsx': 'JSX', 'javascript': 'JavaScript',
  'py': 'Python', 'python': 'Python', 'ts': 'TypeScript', 'tsx': 'TSX',
  'html': 'HTML', 'css': 'CSS', 'sql': 'SQL', 'md': 'markdown', 'sh': 'Shell',
  'yml': 'YAML'
};

function styleCodeBlocks() {
  document.querySelectorAll('pre code[class^="language-"]').forEach(code => {
    if (!code.dataset.styled) {
      code.dataset.styled = 'true';
      let rawLang = ([...code.classList].find(c => c.startsWith("language-")) || "").replace("language-", "").toLowerCase();
      if (!rawLang || rawLang === "undefined") {
        rawLang = "plaintext";
        code.className = code.className.replace(/\blanguage-undefined\b/g, "").trim();
        if (!code.classList.contains("language-plaintext")) code.classList.add("language-plaintext");
      }
      let languageName = LANGUAGE_MAP[rawLang] || (rawLang.charAt(0).toUpperCase() + rawLang.slice(1));

      const pre = code.parentElement;
      const container = document.createElement("div");
      container.className = "code-block";
      const header = document.createElement("div");
      header.className = "code-header";
      const langSpan = document.createElement("span");
      langSpan.className = "code-language";
      langSpan.textContent = languageName;

      const copyBtn = document.createElement("button");
      copyBtn.className = "copy-btn";
      copyBtn.draggable = false;
      copyBtn.style.userSelect = "none";
      copyBtn.addEventListener("dragstart", e => e.preventDefault());
      copyBtn.addEventListener("copy",      e => e.preventDefault());
      copyBtn.addEventListener("contextmenu", e => e.preventDefault());
      const copyIcon = document.createElement("img");
      copyIcon.src = "icons/copy_btn.png";
      copyIcon.alt = "Kopyala";
      copyIcon.style.width = "16px";
      copyIcon.style.height = "16px";
      copyBtn.appendChild(copyIcon);

      copyBtn.addEventListener("click", () => {
        const codeText = code.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
          copyBtn.classList.add("copied");
          copyIcon.src = "icons/copied_btn.png";
          setTimeout(() => {
            copyIcon.src = "icons/copy_btn.png";
            copyBtn.classList.remove("copied");
          }, 2000);
        }).catch(err => console.error("Error copying code:", err));
      });

      header.appendChild(langSpan);
      header.appendChild(copyBtn);
      pre.parentElement.insertBefore(container, pre);
      container.appendChild(header);
      container.appendChild(pre);
    }
  });
}

marked.setOptions({
  breaks: true,
  gfm: true,
  langPrefix: 'language-',
  highlight: function(code, lang) {
    const language = lang && hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
});

/* ======================
     BAŞLATMA VE OLAY DİNLEYİCİLERİ
====================== */
document.addEventListener("DOMContentLoaded", () => {

  renderChatHistory();
  closeSidebar();
  populateChatSummaryDropdown();

// Ziyaretçi ilk kez geliyorsa sadece karşılama mesajını göster
if (conversations.length === 0) {
  currentConversation = null;            // henüz sohbet yok
  chatContainer.appendChild(welcomeMessage);
  welcomeMessage.style.display = "block";
  updateTopBarTitle();                   // başlık boş kalsın
}


  // Yeni: Model Seçici Başlatma
  const modelToggleBtn = document.getElementById("model-toggle-btn");
  const modelDropdown = document.getElementById("model-dropdown");
  const modelOptions = document.querySelectorAll(".model-option");

  function setModel(model) {
    selectedModel = model;
    localStorage.setItem("selectedModel", model);
    document.getElementById("current-model-name").textContent = model === "quik-est" ? "quik-est" : "quik-think";
  }

  setModel(selectedModel); // İlk durumu yükle

  modelToggleBtn.addEventListener("click", () => {
    modelDropdown.classList.toggle("show");
  });

  modelOptions.forEach(option => {
    option.addEventListener("click", () => {
      const model = option.getAttribute("data-model");
      setModel(model);
      modelDropdown.classList.remove("show");
    });
  });

document.addEventListener('keydown', function (e) {
  if (e.key === 'Escape') {
    const modelDropdown = document.querySelector('.model-dropdown.show');
    if (modelDropdown) {
      modelDropdown.classList.remove('show');
    }
  }
});


  window.addEventListener("click", (e) => {
    if (!modelToggleBtn.contains(e.target) && !modelDropdown.contains(e.target)) {
      modelDropdown.classList.remove("show");
    }
  });

  window.originalWelcomeHTML = `
    <div class="logo-container">
    </div>
  <h1>Nasıl yardımcı olabilirim?</h1>
  `;

  // Scroll Pozisyonu Yönetimi
  const savedScrollPosition = localStorage.getItem("scrollPosition");
  if (savedScrollPosition !== null) {
    scrollWrapper.scrollTop = parseInt(savedScrollPosition, 10);
  }
  scrollWrapper.addEventListener("scroll", () => {
    localStorage.setItem("scrollPosition", scrollWrapper.scrollTop);
  });

// Tema Ayarları (Görünüm)
  const lightModeBtn = document.getElementById("light-mode-btn");
  const darkModeBtn = document.getElementById("dark-mode-btn");
  const systemModeBtn = document.getElementById("system-mode-btn");

  function applyTheme(theme) {
    const body = document.body;
    body.classList.remove("dark");
    if (theme === "dark") body.classList.add("dark");
    else if (theme === "system") {
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) body.classList.add("dark");
    }
    lightModeBtn.classList.toggle("active", theme === "light");
    darkModeBtn.classList.toggle("active", theme === "dark");
    systemModeBtn.classList.toggle("active", theme === "system");
  }

// localStorage'dan son temayı al, yoksa varsayılan "system" olsun
  let savedTheme = localStorage.getItem("theme") || "system";
  applyTheme(savedTheme);

  lightModeBtn.addEventListener("click", () => {
    applyTheme("light");
    localStorage.setItem("theme", "light");
  });
  darkModeBtn.addEventListener("click", () => {
    applyTheme("dark");
    localStorage.setItem("theme", "dark");
  });
  systemModeBtn.addEventListener("click", () => {
    applyTheme("system");
    localStorage.setItem("theme", "system");
  });
  window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
    if (localStorage.getItem("theme") === "system") applyTheme("system");
  });

// Yeni eklenen otomatik odaklama mantığı
document.addEventListener("keydown", (e) => {
  const chatInput      = document.getElementById("chat-input-textarea");
  const settingsModal  = document.getElementById("settings-modal");
  const chatSearchModal= document.getElementById("chat-search-modal");

  /* 1 | Boşken Enter → engelle */
  if (
    e.key === "Enter" && !e.shiftKey &&
    document.activeElement === chatInput &&
    chatInput.value.trim() === ""
  ) {
    e.preventDefault();
    return;
  }

  /* 2 | Ctrl / Cmd kısayolları → dokunma */
  if (e.ctrlKey || e.metaKey) return;

  /* 2.5 | Backspace tuşu → odaklama yapma */
  if (e.key === "Backspace") return;

  /* ESC → dokunma */
  if (e.key === "Escape") return;

  /* 3 | Modal açık ya da başka input odakta → dokunma */
  if (
    (settingsModal.style.display === "block" || chatSearchModal.style.display === "block") ||
    document.activeElement.tagName === "INPUT" ||
    (document.activeElement.tagName === "TEXTAREA" && document.activeElement !== chatInput)
  ) {
    return;
  }

  /* 4 | Odak chat-input’ta değilse odakla */
  if (document.activeElement !== chatInput) {
    if (e.key === "Enter") e.preventDefault();
    chatInput.focus();
    console.log("Chat-input otomatik olarak odaklandı.");
  }
});



  // Bildirim Ayarları
  const unreadMessagesToggle = document.getElementById("toggle-unread-messages");
  const desktopNotificationsToggle = document.getElementById("toggle-desktop-notifications");
  const emailNotificationsToggle = document.getElementById("toggle-email-notifications");

  unreadMessagesToggle.checked = localStorage.getItem("unreadMessagesToggle") !== "false";
  desktopNotificationsToggle.checked = localStorage.getItem("desktopNotificationsToggle") !== "false";
  emailNotificationsToggle.checked = localStorage.getItem("emailNotificationsToggle") !== "false";

  unreadMessagesToggle.addEventListener("change", () => {
    localStorage.setItem("unreadMessagesToggle", unreadMessagesToggle.checked);
  });
// Eklenecek kod:
const conversationPersonSelect = document.getElementById("conversation-person");
conversationPersonSelect.value = localStorage.getItem("conversationPerson") || "sky"; // Varsayılan "Sky"
conversationPersonSelect.addEventListener("change", () => {
  localStorage.setItem("conversationPerson", conversationPersonSelect.value);
  console.log("Seçilen konuşma kişisi:", conversationPersonSelect.value);
});

const deleteAllChatsBtn = document.getElementById("delete-all-chats");

deleteAllChatsBtn.addEventListener("click", () => {
  openConfirmModal(() => {
    // 1. Hafızadaki tüm sohbet verilerini temizle
    localStorage.removeItem('conversations');
    sessionStorage.removeItem('lastConversationId');
    
    // 2. Sayfayı yeniden yükleyerek arayüzü sıfırla
    location.reload();
    
  }, "Bütün sohbetleri silmek istediğinizden emin misiniz?");
});

  desktopNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("desktopNotificationsToggle", desktopNotificationsToggle.checked);
  });
  emailNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("emailNotificationsToggle", emailNotificationsToggle.checked);
  });

  // Sekme Geçişleri ve Varsayılan "Genel" Sekmesi
  const navItems = document.querySelectorAll(".settings-nav li");
  const tabContents = document.querySelectorAll(".tab-content");

function setActiveTab(tabId) {
  navItems.forEach(i => i.classList.remove("active"));
  tabContents.forEach(tc => {
    tc.classList.remove("active");
    tc.style.display = "none";
  });
  const selectedNav = Array.from(navItems).find(item => item.getAttribute("data-tab") === tabId);
  const selectedTab = document.getElementById(tabId);
  if (selectedNav && selectedTab) {
    selectedNav.classList.add("active");
    selectedTab.classList.add("active");
    selectedTab.style.display = "block";

    // Modalın yüksekliğini sabit tut
    const settingsModalContent = document.querySelector(".settings-modal-content");
    settingsModalContent.style.height = "80vh"; // CSS ile aynı değeri kullan
    settingsModalContent.style.maxHeight = "80vh";
  } else {
    console.error("Sekme bulunamadı:", tabId);
  }
}

  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const tabName = item.getAttribute("data-tab");
      setActiveTab(tabName);
    });
  });

  // İlk açılışta "Genel" sekmesini aktif yap
  setActiveTab("genel");

// Web Arama Butonu (sayfanın sol altındaki)
  const webSearchBtn = document.getElementById("web-search-btn"); // Sol alttaki buton
  webSearchBtn.classList.toggle("active", enableWebSearch); // İlk durumunu güncelle

// Sol alttaki Web Arama Butonu
  webSearchBtn.addEventListener("click", () => {
    enableWebSearch = !enableWebSearch; // Durumu tersine çevir
    setWebSearchState(enableWebSearch); // Modal içindeki butonlarla senkronize et
  });

// Web Arama Ayarları
  const webSearchOnBtn = document.getElementById("web-search-on-btn");
  const webSearchOffBtn = document.getElementById("web-search-off-btn");

function setWebSearchState(isEnabled) {
    enableWebSearch = isEnabled;
    if (isEnabled) {
      webSearchOnBtn.classList.add("active");
      webSearchOffBtn.classList.remove("active");
      webSearchBtn.classList.add("active"); // Sol alttaki buton aktif görünüyor
    } else {
      webSearchOnBtn.classList.remove("active");
      webSearchOffBtn.classList.add("active");
      webSearchBtn.classList.remove("active"); // Sol alttaki buton inaktif görünüyor
    }
    localStorage.setItem("webSearchEnabled", isEnabled); // Durumu kaydet
  }

// localStorage'dan son web arama durumunu al, yoksa varsayılan "true" (açık) olsun
  const savedWebSearchState = localStorage.getItem("webSearchEnabled");
  const initialWebSearchState = savedWebSearchState !== null ? JSON.parse(savedWebSearchState) : false;
  setWebSearchState(initialWebSearchState);

  webSearchOnBtn.addEventListener("click", () => setWebSearchState(true));
  webSearchOffBtn.addEventListener("click", () => setWebSearchState(false));


  // Hoş Geldin Mesajı Animasyonu
  function wrapWords(element) {
    const parts = element.textContent.split(/(\s+)/);
    element.innerHTML = '';
    parts.forEach(part => {
      if (part.trim() === '') element.appendChild(document.createTextNode(part));
      else {
        const span = document.createElement('span');
        span.textContent = part;
        element.appendChild(span);
      }
    });
  }

  const h1 = welcomeMessage.querySelector('h1');
  const p = welcomeMessage.querySelector('p');
  if (h1) wrapWords(h1);
  if (p) wrapWords(p);

  function animateWelcomeElements() {
    const spans = welcomeMessage.querySelectorAll('span');
    spans.forEach((span, index) => {
      span.style.animation = `fadeIn 2s ease forwards`;
      span.style.animationDelay = `${index * 0.2}s`;
    });
    const quikIcon = document.getElementById("quik-icon");
    if (quikIcon) {
      quikIcon.style.opacity = "0";
      quikIcon.style.animation = "fadeIn 2s ease forwards";
      quikIcon.style.animationDelay = "0.2s";
    }
  }

});

// Diğer Olay Dinleyicileri
sendBtn.addEventListener("click", () => {
  if (isStreaming) {
    console.log("Streaming devam ediyor, durduruluyor...");
    if (currentFetchAbortController) currentFetchAbortController.abort();
  } else {
    console.log("Yeni mesaj gönderiliyor...");
    const userMessage = chatInput.value.trim();
    if (!userMessage) return;
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

chatInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey && !isStreaming) {

    e.preventDefault();
    const userMessage = chatInput.value.trim();
    if (!userMessage) {
      console.log("Enter’a basıldığında input boş!");
      return;
    }
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

// Kişiselleştirme Ayarlarını Yükle
  const staticPromptTextarea = document.getElementById("static-prompt");
  const savePersonalizationBtn = document.getElementById("save-personalization");

  // Varsayılan değeri yükle
  staticPromptTextarea.value = botSettings.staticPrompt;

  // Ayarları Kaydet
  savePersonalizationBtn.addEventListener("click", () => {
  botSettings.staticPrompt = staticPromptTextarea.value.trim();
  localStorage.setItem("staticPrompt", botSettings.staticPrompt);

// Toast mesajı
  const toast = document.createElement("div");
  toast.textContent = "Ayarlar kaydedildi!";
  toast.style.cssText = `
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--success-color);
    color: white;
    padding: 12px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: fadeInOut 2s ease forwards;
    text-align: center;
    width: 170px; /* Sabit genişlik ile daha kontrollü görünüm */
  `;
  document.body.appendChild(toast);

  setTimeout(() => toast.remove(), 2000);

  // Animasyon
  const styleSheet = document.styleSheets[0];
  styleSheet.insertRule(`
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(20px); }
    }
  `, styleSheet.cssRules.length);
});


chatInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});

newChatBtn.addEventListener("click", () => {
  // Arama container'ı kapat
  closeChatSearch();
  
  // Mevcut sohbeti temizle
  currentConversation = null;
  saveLastConversationId(null);
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  
  // Sidebar’ı güncelle
  renderChatHistory();
  
  // HTML title güncellemesi (isteğe bağlı)
  document.title = "quik";
  
  // Top bar başlığını güncelle (currentConversation null olduğundan boş kalacaktır)
  updateTopBarTitle();
});


toggleSidebarBtn.addEventListener("click", () => {
    // Tıklama anında tooltip’i gizle
    toggleSidebarBtn.classList.add("no-tooltip");

    closeChatSearch();

    // Sidebar açma/kapama mantığını koru
    if (sidebar.classList.contains("open")) {
      closeSidebar();
    } else {
      openSidebar();
    }

if (sidebar.classList.contains("open")) {
  document.getElementById("settings-btn").style.zIndex = "100"; // Sidebar'ın z-index'inden düşük
} else {
  document.getElementById("settings-btn").style.zIndex = "1000"; // Normal değere döndür
}


    // Fare ayrıldığında tooltip’i tekrar aktif et
    toggleSidebarBtn.addEventListener(
      "mouseleave",
      () => {
        toggleSidebarBtn.classList.remove("no-tooltip");
      },
      { once: true } // Event listener bir kere çalışsın ve silinsin
    );
  });

sidebarBrand.addEventListener("click", () => {
  // Arama container'ını kapat
  closeChatSearch();
  
  // Mevcut sohbeti temizle
  currentConversation = null;
  saveLastConversationId(null);
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  
  // Sidebar’ı güncellemek için
  renderChatHistory();
  
  // HTML başlığını güncelle
  document.title = "quik";
  
  // Top bar’da sohbet başlığı boşaltılsın
  updateTopBarTitle();

  uploadedFiles = [];
  fileContainer.innerHTML = "";
});

function makeWelcomeActive() {
  const welcomeMsg = document.getElementById('welcome-message');
  if (!welcomeMsg) return;
  welcomeMsg.querySelectorAll('span').forEach(span => {
    span.style.opacity = '1';
    span.style.animation = 'none';
  });
  const quikIcon = document.getElementById("quik-icon");
  if (quikIcon) {
    quikIcon.style.opacity = '1';
    quikIcon.style.animation = 'none';
  }
}

// Modal açıldığında settings butonuna "blurred" sınıfı ekle
// ID'si "settings-btn" olan TÜM elementleri bul
const allSettingsButtons = document.querySelectorAll("#settings-btn");

// Her birine aynı tıklama görevini ata
allSettingsButtons.forEach(button => {
    button.addEventListener("click", () => {
        document.getElementById("settings-modal").style.display = "block";
        // Tıklanan buton hangisiyse, sadece onu değil, TÜM ayar butonlarını blur'la

        document.getElementById("sidebar-search-toggle").classList.add("blurred");
    });
});

// Modal kapatma işlemi: kapatma butonu veya modal dışına tıklama
document.getElementById("settings-close").addEventListener("click", () => {
  document.getElementById("settings-modal").style.display = "none";
  document.getElementById("settings-btn").classList.remove("blurred");
  document.getElementById("sidebar-search-toggle").classList.remove("blurred"); // Yeni satır
});

(() => {
  const modal   = document.getElementById("settings-modal");
  const close   = () => {
    modal.style.display = "none";
    document.getElementById("settings-btn").classList.remove("blurred");
    document.getElementById("sidebar-search-toggle").classList.remove("blurred");
  };

  let downOnBackdrop = false;

  // Sadece backdrop’ta mouse-down olduysa işaretle
  modal.addEventListener("mousedown", e => {
    downOnBackdrop = (e.target === modal);
  });

  // Mouse-up da backdrop’ta olursa kapat
  modal.addEventListener("mouseup", e => {
    if (downOnBackdrop && e.target === modal) close();
    downOnBackdrop = false;            // bayrak sıfırla
  });
})();


window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const modal = document.getElementById("settings-modal");
    if (modal && modal.style.display === "block") {
      modal.style.display = "none";
      document.getElementById("settings-btn").classList.remove("blurred");
      document.getElementById("sidebar-search-toggle").classList.remove("blurred"); // Yeni satır
    }
  }

});

function adjustTooltipPosition(element) {
  // Sidebar toggle butonu için özel yan pozisyonlandırma
  if (element.id === 'toggle-sidebar-btn') {
    element.style.setProperty('--tooltip-left', 'calc(100% + 8px)');
    element.style.setProperty('--tooltip-transform', 'translateY(-50%)');
  } else {
    // Diğer butonlar için tooltip ortada ve aşağıda hizalı
    element.style.setProperty('--tooltip-left', '50%');
    element.style.setProperty('--tooltip-transform', 'translateX(-50%) translateY(10px)');
  }
}

function copyFormattedContent(element) {
  // Kopyalanacak HTML içeriğini al
  const htmlData = element.innerHTML;
  // Aynı zamanda düz metin versiyonunu al
  const plainTextData = element.innerText;

  const data = {
    "text/html": new Blob([htmlData], { type: "text/html" }),
    "text/plain": new Blob([plainTextData], { type: "text/plain" })
  };

  navigator.clipboard.write([new ClipboardItem(data)])
    .then(() => {
      console.log("Biçimlendirilmiş içerik kopyalandı!");
    })
    .catch(err => {
      console.error("Kopyalama hatası:", err);
    });
}

document.addEventListener('keydown', function (e) {
  // Sadece ayarlar modali açıkken çalışmasını istiyorsak kontrol ekleyebilirsiniz:
  const settingsModal = document.getElementById("settings-modal");
  if (!settingsModal || settingsModal.style.display !== "block") return;

  const navItems = Array.from(document.querySelectorAll(".settings-nav li"));
  const activeIndex = navItems.findIndex(item => item.classList.contains("active"));
  
  if (e.key === "ArrowDown") {
    // Sonraki sekmeye geçiş
    if (activeIndex < navItems.length - 1) {
      navItems[activeIndex + 1].click();
      navItems[activeIndex + 1].focus();
    }
  } else if (e.key === "ArrowUp") {
    // Önceki sekmeye geçiş
    if (activeIndex > 0) {
      navItems[activeIndex - 1].click();
      navItems[activeIndex - 1].focus();
    }
  }
});

// File upload handling
const fileUploadBtn = document.getElementById("file-upload-btn");
const fileInput = document.createElement("input");
fileInput.type = "file";
fileInput.accept = ".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg,.gif,.webp";

fileInput.multiple = true; // Çoklu dosya seçimi
fileInput.style.display = "none"; // Girdi alanını gizle
document.body.appendChild(fileInput);

const fileContainer = document.getElementById("file-container");
let uploadedFiles = []; // Yüklenen dosyaları tutacak dizi
const allowedExtensions = [
  ".pdf", ".doc", ".docx", ".txt",
  ".png", ".jpg", ".jpeg", ".gif", ".webp"
];



// Dosyalar yüklendikten sonra, backend'e gönderim için örnek API çağrısı
async function sendFileToBackend(file) {
  const formData = new FormData();
  formData.append("file", file);
  
  try {
    const response = await fetch("http://localhost:5000/process-file", {
      method: "POST",
      body: formData
    });
    if (!response.ok) {
      console.error("Dosya işleme hatası:", response.statusText);
      return;
    }
    const result = await response.json();
    // result.text, dosyadan ayrıştırılmış metin içeriği olacak
    // Bu metni bot mesajı olarak ekleyebilirsiniz
    console.log("Dosya içeriği:", result.text);
  } catch (err) {
    console.error("API çağrısı sırasında hata:", err);
  }
}


// Dosya türüne göre ikon belirleme fonksiyonu
function getFileIcon(ext) {
  switch (ext.toLowerCase()) {
    case '.doc':
    case '.docx':
      return 'icons/word_icon.png';
    case '.pdf':
      return 'icons/pdf_icon.png';
    case '.txt':
      return 'icons/txt_icon.png';
    case '.png':
    case '.jpg':
    case '.jpeg':
    case '.gif':
    case '.webp':
      return 'icons/image_icon.png';   // Küçük bir resim ikonu ekle
    default:
      return 'icons/default_icon.png'; // Bilinmeyen dosya türleri için varsayılan ikon
  }
}

// Dosyaları gösterme fonksiyonu (güncellenmiş)
function displayFiles(files) {
  for (const file of files) {
    // Maksimum dosya sayısını kontrol et
    if (uploadedFiles.length >= 5) {
      showDuplicateToast("Maksimum 5 dosya yükleyebilirsiniz.");
      return;
    }

    // Dosya uzantısını al
    const ext = "." + file.name.split(".").pop().toLowerCase();
    if (!allowedExtensions.includes(ext)) {
      showDuplicateToast("Sadece .pdf, .doc, .docx, .txt uzantılı dosya yükleyebilirsiniz.");
      continue;
    }

    // Aynı isim ve türde dosya kontrolü
    const isDuplicate = uploadedFiles.some(existingFile => 
      existingFile.name === file.name && 
      ("." + existingFile.name.split(".").pop().toLowerCase()) === ext
    );

    if (isDuplicate) {
      showDuplicateToast(`"${file.name}" adında bir dosya zaten eklenmiş.`);
      continue; // Bu dosyayı eklemeden devam et
    }

    // Dosyayı ekle
    uploadedFiles.push(file);

    const fileBox = document.createElement("div");
    fileBox.className = "file-box";

    // Dosya türüne göre ikonu belirle
    const fileIconSrc = getFileIcon(ext);

    // Dosya kutusu içeriği (ikon + dosya adı + kaldırma butonu)
    fileBox.innerHTML = `
      <img src="${fileIconSrc}" alt="File Icon" class="file-icon">
      <span class="file-name">${file.name}</span>
      <button class="remove-file-btn">
        <img src="icons/close_btn.png" alt="Remove File">
      </button>
    `;
    fileContainer.appendChild(fileBox);

    // Dosya kaldırma işlevi
    fileBox.querySelector(".remove-file-btn").addEventListener("click", () => {
      uploadedFiles = uploadedFiles.filter(f => f !== file);
      fileBox.remove();
    });

    // Eklenen dosyayı backend'e gönder ve metni al
    sendFileToBackend(file);
  }
}

function showDuplicateToast(message) {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--danger-color);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: fadeInOut 2s ease forwards;
    text-align: center;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

// Butonla dosya yükleme
fileUploadBtn.addEventListener("click", () => {
  fileInput.click();
});

fileInput.addEventListener("change", () => {
  if (fileInput.files.length > 0) {
    displayFiles(fileInput.files);
    fileInput.value = ""; // Girdi alanını sıfırla
  }
});

// Tüm sayfa için sürükleyip bırakma işlevi
// Drop zone’u seç
const dropZone = document.getElementById("drop-zone");

// Tüm sayfa için olay dinleyicileri
document.addEventListener("dragover", (e) => {
  e.preventDefault(); // Varsayılan davranışı engelle
  dropZone.classList.add("active"); // Drop zone’u göster
});

document.addEventListener("dragleave", (e) => {
  // İmleç sayfa dışına çıktığında drop zone’u gizle
  if (e.relatedTarget === null || !document.contains(e.relatedTarget)) {
    dropZone.classList.remove("active");
  }
});

document.addEventListener("drop", (e) => {
  e.preventDefault(); // Varsayılan davranışı engelle
  dropZone.classList.remove("active"); // Drop zone’u gizle
  const files = e.dataTransfer.files; // Sürüklenen dosyaları al
  if (files.length > 0) {
    displayFiles(files); // Dosyaları file-container’a ekle
  }
});

// Yeni sohbet başlatıldığında dosyaları temizle
newChatBtn.addEventListener("click", () => {
  uploadedFiles = [];
  fileContainer.innerHTML = "";
});



document.addEventListener("DOMContentLoaded", () => {
  const voiceRecordBtn = document.getElementById('voice-record-btn');
  const chatInput = document.getElementById('chat-input-textarea');
  let mediaRecorder;
  let isRecording = false;
  let finalTranscript = '';
  let previousInputValue = '';

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  
  if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'tr-TR';
    
    function addSmartPunctuation(text) {
      // Your existing punctuation function
      let processedText = text;
      processedText = processedText.replace(/(\w+)(\s+)([A-ZÇĞİÖŞÜ])/g, (match, p1, p2, p3) => 
        p1.length > 1 ? p1 + '.' + p2 + p3 : match
      );
      processedText = processedText.replace(/(\w+)(\s{2,})/g, '$1.$2');
      processedText = processedText.replace(/(\s|^)(mi|mı|mu|mü|ne|niye|neden|nasıl|hangi|kim|kimin|ne zaman|nerede|niçin)(\s+)(\w+)(\s*$|\s+[a-z])/gi, 
        (match, p1, p2, p3, p4, p5) => p5.trim() === '' ? p1 + p2 + p3 + p4 + '?' : match
      );
      processedText = processedText.replace(/(\w+)(\s+)(ama|fakat|ancak|ve|veya|ya da|çünkü|zira|ayrıca|aslında|sonra|önce|belki|bununla birlikte)(\s+)/gi, '$1,$2$3$4');
      if (!/[.!?]$/.test(processedText.trim())) processedText = processedText.trim() + '.';
      return processedText;
    }
    
    function capitalizeFirstLetter(text) {
      return text.replace(/(^|[.!?]\s+)([a-zçğıöşü])/g, (match, p1, p2) => p1 + p2.toUpperCase());
    }
    
    function trimExcessWhitespace(text) {
      return text.replace(/\s+/g, ' ').trim();
    }
    
    // Monitor the input field for changes
    chatInput.addEventListener('input', () => {
      // If the field was cleared manually, reset the transcript
      if (chatInput.value === '' && previousInputValue !== '') {
        finalTranscript = '';
      }
      previousInputValue = chatInput.value;
    });

    // Hook into the sendMessage function to reset transcript after sending
    const originalSendMessage = window.sendMessage;
    window.sendMessage = function() {
      const result = originalSendMessage.apply(this, arguments);
      finalTranscript = '';  // Reset after sending
      return result;
    };
    
    recognition.onresult = (event) => {
      let interimTranscript = '';
      
      // Check if input has been manually cleared
      if (chatInput.value === '') {
        finalTranscript = '';
      }
      
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          let processedText = addSmartPunctuation(transcript);
          processedText = capitalizeFirstLetter(processedText);
          processedText = trimExcessWhitespace(processedText);
          finalTranscript += (finalTranscript ? ' ' : '') + processedText;
        } else {
          interimTranscript += transcript;
        }
      }
      
      chatInput.value = finalTranscript + (interimTranscript ? ' ' + interimTranscript : '');
      previousInputValue = chatInput.value;
      chatInput.style.height = 'auto';
      chatInput.style.height = chatInput.scrollHeight + 'px';
    };
    
    recognition.onerror = (event) => {
      console.error('Konuşma tanıma hatası:', event.error);
      voiceRecordBtn.classList.remove('recording');
      isRecording = false;
    };
    
    voiceRecordBtn.addEventListener('click', async () => {
      if (isRecording) {
        mediaRecorder.stop();
        recognition.stop();
        voiceRecordBtn.classList.remove('recording');
        isRecording = false;
      } else {
        try {
          // Get the current state of the input field
          const currentInputText = chatInput.value.trim();
          
          // If starting a new recording with empty input, reset transcript
          // Otherwise, keep existing text as part of transcript
          if (currentInputText === '') {
            finalTranscript = '';
          } else {
            finalTranscript = currentInputText;
          }
          
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          recognition.start();
          
          voiceRecordBtn.classList.add('recording');
          isRecording = true;
          
          mediaRecorder.onstop = () => {
            stream.getTracks().forEach(track => track.stop());
          };
          
          mediaRecorder.ondataavailable = (event) => {
            // Ses dosyası kaydedilmeyecek
          };
        } catch (err) {
          console.error('Mikrofon erişim hatası:', err);
          alert('Mikrofon erişimi reddedildi. Lütfen izin verin ve tekrar deneyin.');
        }
      }
    });
  } else {
    console.warn('SpeechRecognition API bu tarayıcıda desteklenmiyor.');
    voiceRecordBtn.style.display = 'none';
  }
});



// Aktif ses oynatıcıyı ve durumunu takip etmek için değişkenler
let currentVoice = null;
let currentCharacter = null;

// Ses çalma ve durdurma fonksiyonu
function toggleVoice(character) {
  const button = document.getElementById(`voice-btn-${character}`);
  
  // Eğer bu karakterin sesi zaten çalıyorsa, durdur
  if (currentCharacter === character && currentVoice && !currentVoice.paused) {
    currentVoice.pause();
    currentVoice.currentTime = 0; // Başa sar
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Dene`;
    currentVoice = null;
    currentCharacter = null;
    return;
  }

  // Eğer başka bir ses çalıyorsa, onu durdur
  if (currentVoice && currentCharacter && currentCharacter !== character) {
    currentVoice.pause();
    currentVoice.currentTime = 0;
    const previousButton = document.getElementById(`voice-btn-${currentCharacter}`);
    previousButton.textContent = `${currentCharacter.charAt(0).toUpperCase() + currentCharacter.slice(1)}'ı Dene`;
  }

  // Yeni sesi çal
  currentVoice = new Audio(`voices/${character}_wav.mp3`);
  currentCharacter = character;
  currentVoice.play().then(() => {
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Durdur`; // Buton metnini güncelle
  }).catch(error => {
    console.error(`${character} sesi çalınırken hata oluştu:`, error);
    alert(`${character} ses dosyası bulunamadı veya çalınamadı.`);
  });

  // Ses bittiğinde buton metnini sıfırla
  currentVoice.onended = () => {
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Dene`;
    currentVoice = null;
    currentCharacter = null;
  };
}


  // Mevcut seçili mod ve Özel metnin saklanacağı değişkenler
  let currentMode = 'special';
  let specialText = '';

  // Hazır statik prompt'lar
  const prompts = {
    professional: "Resmi bir ton, net, iyi yapılandırılmış cümleler ve kesin bir dil kullanan quik adında bir AI asistanısın. Profesyonelliğini koru ve günlük dil veya gündelik ifadelerden kaçın fakat çok katı olma. Öz ve saygılı kal. Profesyonel bir meslektaşa hitap ediyormuş gibi kapsamlı açıklamalar sağla.",
    energetic: "Enerjik ve motive edici bir tavır sergileyen ve kullanıcıyı motive etmek için sürekli olarak coşku ve cesaretlendirmeyle yanıtlar veren quik adında bir AI asistanısın. Tüm etkileşimlerde motivasyonu teşvik etmek için dinamik ve canlandırıcı bir dil kullanarak olumlu bir ton oluştur. Yanıtlarında netlik, profesyonellik ve kesinliği korurken, davranışını kullanıcının yönlendirildiği şekilde uyarla. Kullanıcıyı etkili bir şekilde desteklemek için özlü ancak kapsamlı açıklamalar sağla.",
    friendly: "Her zaman samimi ve cana yakın bir üslupla konuşan quik adında bir AI asistanısın. Kullanıcıya duygusal olarak bağlanan, anlaşılır ve destekleyici cevaplar üretmeyi seviyorsun. Cevaplarında empati, naziklik ve moral verici ifadeler her zaman ön plandadır. Umut verici ve sıcak bir dil kullanarak kullanıcının kendisini değerli hissetmesini sağlamak senin görevin. Çünkü sen kullanıcıyı çok seviyorsun."
  };

function setPrompt(type){
  const staticPrompt = document.getElementById('static-prompt');

  /* 1 ▸ önceki “Özel” metnini sakla */
  if (currentMode === 'special'){
    specialText = staticPrompt.value;
    localStorage.setItem('specialText', specialText);   // **yeni**
  }

  /* 2 ▸ modu güncelle + localStorage’a yaz */
  currentMode = type;
  localStorage.setItem('promptMode', type);             // **yeni**

  /* 3 ▸ textarea’yı yönet */
  if (type === 'special'){
    staticPrompt.disabled = false;
    staticPrompt.value = specialText;
  }else{
    staticPrompt.disabled = true;
    staticPrompt.value   = prompts[type] || '';
  }

  /* 4 ▸ butonlarda .active sınıfını güncelle */
  document.querySelectorAll('#kisisellestirme .prompt-selection .theme-btn')
          .forEach(btn=>{
            const clicked = btn.getAttribute('onclick')?.includes(`'${type}'`);
            btn.classList.toggle('active', clicked);
          });
}


document.getElementById('static-prompt').addEventListener('input', e=>{
  if (currentMode === 'special'){
    specialText = e.target.value;
    localStorage.setItem('specialText', specialText);
  }
});

document.addEventListener('DOMContentLoaded', ()=>{
  /* Önbellekten oku */
  currentMode  = localStorage.getItem('promptMode')  || 'special';
  specialText  = localStorage.getItem('specialText') || '';

  /* Mode’u ve buton rengini senkron et */
  setPrompt(currentMode);
});


function connectGoogleDrive() {
  const googleDriveAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/drive.readonly";
  window.open(googleDriveAuthUrl, "_blank");
}

function connectGtalk() {
  const googleTalkAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/chat.bot";
  window.open(googleTalkAuthUrl, "_blank");
}

function connectGmail() {
  const gmailAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/gmail.readonly";
  window.open(gmailAuthUrl, "_blank");
}

function connectGoogleCalendar() {
  const calendarAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/calendar.readonly";

  window.open(calendarAuthUrl, "_blank");
}


// Global variable to track Gmail connection state
let isGmailConnected = localStorage.getItem("isGmailConnected") === "true";
let gmailAccessToken = localStorage.getItem("gmailAccessToken") || null;

// Function to connect to Gmail and fetch profile data
function connectGmail() {
  const gmailAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/gmail.readonly";

  // Open OAuth window
  window.open(gmailAuthUrl, "_blank");

  // Note: The actual token retrieval should happen via a backend redirect.
  // For this example, assume the backend sets the token in localStorage after redirect.
  // Simulate checking connection state after a delay (replace with actual logic).
  setTimeout(checkGmailConnection, 5000); // Adjust based on your OAuth flow.
}

// Function to fetch Google user profile and update UI
function fetchGoogleUserProfile(accessToken) {
  fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=" + accessToken)
    .then(response => {
      if (!response.ok) throw new Error("Profil bilgileri alınamadı.");
      return response.json();
    })
    .then(data => {
      const profileImgUrl = data.picture;
      updateGmailUI(profileImgUrl);
      isGmailConnected = true;
      gmailAccessToken = accessToken; // Store token (in practice, handle securely)
      localStorage.setItem("isGmailConnected", "true");
      localStorage.setItem("gmailAccessToken", accessToken);
    })
    .catch(err => {
      console.error("Profil bilgileri alınırken hata oluştu:", err);
      alert("Gmail bağlantısı sırasında bir hata oluştu.");
    });
}

// Function to update Gmail UI with profile picture and logout option
function updateGmailUI(profileImgUrl) {
  const connectContainer = document.getElementById("gmail-connect-container");
  connectContainer.innerHTML = ""; // Clear existing button

  const profileImg = document.createElement("img");
  profileImg.id = "gmail-profile-photo";
  profileImg.src = profileImgUrl;
  profileImg.alt = "Profil Fotoğrafı";
  profileImg.style.cssText = `
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid var(--primary-color);
  `;

  connectContainer.appendChild(profileImg);

  // Add click event for logout option
  profileImg.addEventListener("click", () => {
    const logoutBtn = document.createElement("button");
    logoutBtn.textContent = "Çıkış Yap";
    logoutBtn.className = "danger-btn";
    logoutBtn.style.cssText = `
      position: absolute;
      top: 50px;
      right: 10px;
      z-index: 1000;
    `;
    connectContainer.appendChild(logoutBtn);

    logoutBtn.addEventListener("click", () => {
      disconnectGmail();
      connectContainer.removeChild(logoutBtn);
    });

    // Remove logout button if clicked elsewhere
    document.addEventListener("click", function handler(e) {
      if (!profileImg.contains(e.target) && !logoutBtn.contains(e.target)) {
        connectContainer.removeChild(logoutBtn);
        document.removeEventListener("click", handler);
      }
    }, { once: true });
  });
}

// Function to disconnect Gmail and revert UI
function disconnectGmail() {
  isGmailConnected = false;
  gmailAccessToken = null;
  localStorage.removeItem("isGmailConnected");
  localStorage.removeItem("gmailAccessToken");

  const connectContainer = document.getElementById("gmail-connect-container");
  connectContainer.innerHTML = `<button id="connect-gmail-btn" class="toggle-btn">Bağlan</button>`;
  document.getElementById("connect-gmail-btn").addEventListener("click", connectGmail);
}

// Function to check Gmail connection state on page load or after auth
function checkGmailConnection() {
  if (isGmailConnected && gmailAccessToken) {
    fetchGoogleUserProfile(gmailAccessToken);
  }
}

// Initialize on page load
document.addEventListener("DOMContentLoaded", () => {
  const connectGmailBtn = document.getElementById("connect-gmail-btn");
  if (connectGmailBtn) {
    connectGmailBtn.addEventListener("click", connectGmail);
  }
  checkGmailConnection(); // Check if already connected
});




function populateChatSummaryDropdown() {
  const dropdown   = document.getElementById("chat-summary-dropdown");
  const editBtn    = document.getElementById("edit-summary-btn");
  const deleteBtn  = document.getElementById("delete-summary-btn");
  const summaryTxt = document.querySelector(".summary-text");

  if (!dropdown || !editBtn || !deleteBtn || !summaryTxt) return;

  // --- dropdown'u sıfırla & seçenekleri ekle ---
  dropdown.innerHTML = '<option value="" disabled>Sohbet Seçin</option>';
  conversations.forEach((conversation, idx) => {
    const opt       = document.createElement("option");
    opt.value       = idx;
    opt.textContent = conversation.title || "Yeni Sohbet";
    dropdown.appendChild(opt);
  });

  /* -------  KALICI SEÇİM  ------- */
  // localStorage’da kayıtlı bir seçim varsa uygula
  const savedIndex = localStorage.getItem("selectedSummaryIndex");
  if (savedIndex !== null && conversations[savedIndex]) {
    dropdown.value = savedIndex;
    displayChatSummary(conversations[savedIndex]);
    editBtn.disabled   = false;
    deleteBtn.disabled = false;
  } else {
    dropdown.selectedIndex = 0;         // “Sohbet Seçin”
    editBtn.disabled   = true;
    deleteBtn.disabled = true;
    summaryTxt.style.display = "none";
  }

  // seçim değiştiğinde güncelle & kalıcılaştır
  dropdown.onchange = (e) => {
    const idx = e.target.value;
    if (idx !== "") {
      localStorage.setItem("selectedSummaryIndex", idx);   // <- kalıcı yap
      const selConv = conversations[idx];
      displayChatSummary(selConv);
      editBtn.disabled   = false;
      deleteBtn.disabled = false;

      editBtn.onclick = () => {
        openEditModal();
        document.getElementById("new-title-input").value = selConv.title || "";
        document.getElementById("edit-modal").dataset.conversationIndex = idx;
      };

      deleteBtn.onclick = () => {
        openConfirmModal(() => {
          conversations.splice(idx, 1);
          localStorage.setItem("conversations", JSON.stringify(conversations));
          localStorage.removeItem("selectedSummaryIndex");  // silindi, seçim temizle
          populateChatSummaryDropdown();
          renderChatHistory();
          updateChatCount();
        }, "Bu sohbeti silmek istediğinizden emin misiniz?");
      };
    }
  };
}    function displayChatSummary(conversation) {
      const summaryText = document.querySelector(".summary-text");
      const summary = conversation.messages.length > 0 
        ? conversation.messages.map(msg => msg.text).join(" ").substring(0, 200) + "..." 
        : "Bu sohbette mesaj yok.";
      
      summaryText.textContent = `${summary}`;
      summaryText.style.display = "block";
    }

function toggleCodeBlock(program) {
  const codeDiv = document.getElementById(`${program}-code`);
  const checkbox = document.getElementById(`toggle-${program}`);
  if (checkbox.checked) {
    codeDiv.style.display = "block";
  } else {
    codeDiv.style.display = "none";
  }
}

// Sayfa yüklendiğinde Highlight.js ile kodları biçimlendir
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("pre code").forEach((block) => {
    hljs.highlightElement(block);
  });
});

document.addEventListener("DOMContentLoaded", () => {
  // Existing toggles
  const toggleSql = document.getElementById("toggle-sql");
  const togglePython = document.getElementById("toggle-python");
  const toggleJavascript = document.getElementById("toggle-javascript");
  const toggleCss = document.getElementById("toggle-css");

  // Load states from localStorage
  if (localStorage.getItem("toggle-sql") !== null) {
    toggleSql.checked = localStorage.getItem("toggle-sql") === "true";
    toggleCodeBlock("sql");
  }
  if (localStorage.getItem("toggle-python") !== null) {
    togglePython.checked = localStorage.getItem("toggle-python") === "true";
    toggleCodeBlock("python");
  }
  if (localStorage.getItem("toggle-javascript") !== null) {
    toggleJavascript.checked = localStorage.getItem("toggle-javascript") === "true";
    toggleCodeBlock("javascript");
  }
  if (localStorage.getItem("toggle-css") !== null) {
    toggleCss.checked = localStorage.getItem("toggle-css") === "true";
    toggleCodeBlock("css");
  }

  // Add event listeners to save changes
  toggleSql.addEventListener("change", () => {
    localStorage.setItem("toggle-sql", toggleSql.checked);
    toggleCodeBlock("sql");
  });
  togglePython.addEventListener("change", () => {
    localStorage.setItem("toggle-python", togglePython.checked);
    toggleCodeBlock("python");
  });
  toggleJavascript.addEventListener("change", () => {
    localStorage.setItem("toggle-javascript", toggleJavascript.checked);
    toggleCodeBlock("javascript");
  });
  toggleCss.addEventListener("change", () => {
    localStorage.setItem("toggle-css", toggleCss.checked);
    toggleCodeBlock("css");
  });
});

document.getElementById("voice-page-btn").addEventListener("click", () => {
  document.body.classList.add("fade-out");
  setTimeout(() => {
      const basePath = location.href.substring(0, location.href.lastIndexOf("/"));
      window.location.href = `${basePath}/Quik_Speech.html`;
  }, 500); // Matches the animation duration (0.5s)
});

// Regex özel karakterleri escape etmek için yardımcı fonksiyon
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

document.addEventListener("DOMContentLoaded", () => {
  const chatInput = document.getElementById("chat-input-textarea");

  /*  Ctrl+A ile tüm metin seçildiyse, input’tan çıkarken seçimi temizle  */
  chatInput.addEventListener('blur', () => {
  const len = chatInput.value.length;
  chatInput.setSelectionRange(len, len);   // imleç en sona
});

});

// Mevcut sidebar arama ile ilgili kodlar yerine:
const sidebarSearchToggle = document.getElementById("sidebar-search-toggle");
const chatSearchModal = document.getElementById("chat-search-modal");
const chatSearchClose = document.getElementById("chat-search-close");
const chatSearchInput = document.getElementById("chat-search-input");
const chatSearchResults = document.getElementById("chat-search-results");

sidebarSearchToggle.addEventListener("click", (e) => {
  // YARDIM DROPDOWN’U KAPAT
  document.getElementById('help-dropdown').style.display = 'none';

  if (document.getElementById("settings-modal").style.display === "block") {
    return;
  }
  chatSearchModal.style.display = "block";
  chatSearchInput.focus();
  renderSearchResults("");
  document.getElementById("settings-btn").classList.add("blurred");
  sidebarSearchToggle.classList.add("blurred");
  document.getElementById("toggle-sidebar-btn").classList.add("blurred"); // Ekstra
  document.querySelector(".new-chat-btn").classList.add("blurred");       // Ekstra
  e.stopPropagation();
});

chatSearchClose.addEventListener("click", () => {
  closeChatSearch();
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && chatSearchModal.style.display === "block") {
    closeChatSearch();
  }
});

// Modal dışına tıklayınca kapatma
window.addEventListener("click", (event) => {
  if (event.target === chatSearchModal) {
    closeChatSearch();
  }
});

function closeChatSearch() {
  chatSearchModal.style.display = "none";
  chatSearchInput.value = "";
  chatSearchResults.innerHTML = "";
  document.getElementById("settings-btn").classList.remove("blurred");
  document.getElementById("sidebar-search-toggle").classList.remove("blurred");
  document.getElementById("toggle-sidebar-btn").classList.remove("blurred"); // Ekstra
  document.querySelector(".new-chat-btn").classList.remove("blurred"); // Ekstra
}


function getHighlightedSnippet(text, query, contextWords = 7) {
  // Metni kelimelere bölüyoruz
  const words = text.split(/\s+/);
  
  // Sorguyu boşluklardan ayırıp her bir kelimeyi alıyoruz (boşlukları temizleyip)
  const queryWords = query.trim().split(/\s+/);
  
  // Arama için tüm kelimelerin birleşimini içeren bir regex oluşturuyoruz
  const regexStr = queryWords.map(word => escapeRegExp(word)).join("|");
  const searchRegex = new RegExp(regexStr, "i"); // ilk eşleşmeyi bulmak için büyük/küçük harf duyarsız

  // Önce, metnin tamamında aranan kelimelerden herhangi biri bulunuyor mu kontrol ediyoruz
  const fullTextLower = text.toLowerCase();
  if (!queryWords.some(qw => fullTextLower.includes(qw.toLowerCase()))) {
    return ""; // Eğer hiçbir eşleşme yoksa boş döndür.
  }

  // Ardından, kelimeler dizisi içinde ilk eşleşen kelimeyi buluyoruz.
  const lowerWords = words.map(w => w.toLowerCase());
  let matchIndex = -1;
  for (let i = 0; i < lowerWords.length; i++) {
    if (searchRegex.test(lowerWords[i])) {
      matchIndex = i;
      break;
    }
  }
  if (matchIndex === -1) return "";

  // Etrafında contextWords kadar kelime alıyoruz.
  const start = Math.max(0, matchIndex - contextWords);
  const end = Math.min(words.length, matchIndex + contextWords + 1);
  let snippetText = words.slice(start, end).join(" ");

  // Şimdi, tüm aranan kelimeleri ayrı ayrı boldlamak için birleşik regex kullanıyoruz
  const highlightRegex = new RegExp(regexStr, "gi");
  snippetText = snippetText.replace(highlightRegex, "<strong>$&</strong>");

  return snippetText;
}

function searchConversations(query) {
  // Sorgudaki kelimeleri elde et (boşluklardan ayırarak ve küçük harfe çevirerek)
  const queryWords = query.trim().toLowerCase().split(/\s+/);
  
  // Her bir sohbet için puan hesaplayan yardımcı fonksiyon (ihtiyacınıza göre koruyabilirsiniz)
  function calculateScore(conversation) {
    let score = 0;
    const title = (conversation.title || "").toLowerCase();
    // Sohbetin tüm mesajlarını birleştiriyoruz
    const content = conversation.messages.map(msg => msg.text).join(" ").toLowerCase();
    
    queryWords.forEach(word => {
      // Başlıkta eşleşme varsa ekstra puan ekleyelim
      if (title.includes(word)) {
        score += 5;
      }
      // Mesaj içeriklerinde eşleşme varsa puan ekleyelim
      const matches = content.match(new RegExp(escapeRegExp(word), "g"));
      if (matches) {
        score += matches.length;
      }
    });
    return score;
  }
  
  // Regex özel karakterleri escape etmek için yardımcı fonksiyon
  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  
  // Tüm sohbetler için skorları hesaplayıp, eşleşme bulunanları filtreleyin
  const results = conversations.map(conv => ({
    conversation: conv,
    score: calculateScore(conv)
  })).filter(item => item.score > 0);
  
  // Burada skor sıralaması yerine, timestamp'e göre sıralama yapılır:
  results.sort((a, b) => b.conversation.timestamp - a.conversation.timestamp);
  
  return results;
}


function renderSearchResults(query) {
  chatSearchResults.innerHTML = "";
  query = query.trim().toLowerCase();

  const results = searchConversations(query);

  results.forEach(result => {
    const conv = result.conversation;
    const titleText = conv.title || "Yeni Sohbet";
    const allText = conv.messages.map(msg => msg.text).join(" ");
    const snippet = getHighlightedSnippet(allText, query, 7);

    const li = document.createElement("li");
    li.className = `chat-search-result-item${currentConversation?.id === conv.id ? " active" : ""}`;
    li.dataset.id = conv.id;
    li.innerHTML = `
      <div class="search-item-title">${titleText} <span style="font-size:0.7em; color:gray;">(${result.score})</span></div>
      ${snippet ? `<div class="search-item-snippet">${snippet}</div>` : ""}
    `;

    li.addEventListener("click", () => {
      currentConversation = conv;
      saveLastConversationId(conv.id);
      goToChat(conv.id); 
      renderChat();
      renderChatHistory();
      closeChatSearch();
      document.querySelectorAll(".chat-history-item").forEach(item => item.classList.remove("active"));
      const activeItem = document.querySelector(`.chat-history-item[data-id="${conv.id}"]`);
      if (activeItem) activeItem.classList.add("active");

      // Güncelleme: Tarayıcı başlığı ve top bar başlığını da ayarla
      document.title = currentConversation.title || "";
      updateTopBarTitle();
    });

    chatSearchResults.appendChild(li);
  });
}


chatSearchInput.addEventListener("input", function () {
  renderSearchResults(this.value);
});


function isMainPage() {
  const welcomeMessage = document.getElementById("welcome-message");
  return welcomeMessage && welcomeMessage.style.display !== "none";
}


function updateTopBarTitle() {
  const titleElem = document.getElementById("chat-title");
  if (isMainPage() || !currentConversation) {
    titleElem.textContent = "";
    titleElem.style.opacity = "1";
  } else {
    const newTitle = currentConversation.title || "";
    if (currentConversation.isNew) {
      currentConversation.isNew = false;
      titleElem.classList.remove("fade-in");
      titleElem.textContent = newTitle;
      void titleElem.offsetWidth;
      titleElem.classList.add("fade-in");
    } else {
      titleElem.textContent = newTitle;
      titleElem.style.opacity = "1";
    }
  }
}


document.addEventListener('DOMContentLoaded', () => {
  const chatTitleEl   = document.querySelector('.top-bar-title');
  const modelToggle   = document.getElementById('model-toggle-btn');
  const modelDropdown = document.getElementById('model-dropdown');
  
  // Dropdown içine eklenecek başlık elementini baştan oluştur
  const dropdownTitleEl = document.createElement('div');
  dropdownTitleEl.className = 'dropdown-chat-title';

  dropdownTitleEl.style.fontWeight = '600';
  dropdownTitleEl.style.borderBottom = '1px solid #ccc';

  function syncDropdown() {
    // her zaman güncel başlık metnini al
    dropdownTitleEl.textContent = chatTitleEl.textContent.trim();

    if (window.innerWidth <= 768) {
      // Mobilde: üst bardaki başlığı gizle
      chatTitleEl.style.display = 'none';

      // Dropdown’a başlığı ekle (eğer yoksa)
      if (!modelDropdown.contains(dropdownTitleEl)) {
        modelDropdown.insertBefore(dropdownTitleEl, modelDropdown.firstElementChild);
      }
    } else {
      // Masaüstünde: dropdown başlığını kaldır ve üst bar title’ı geri göster
      if (modelDropdown.contains(dropdownTitleEl)) {
        modelDropdown.removeChild(dropdownTitleEl);
      }
      chatTitleEl.style.display = '';
    }
  }

  // Dropdown butonuna tıklandığında ve pencere resize’te çalıştır
  modelToggle.addEventListener('click', () => setTimeout(syncDropdown, 0));
  window.addEventListener('resize', syncDropdown);

  // İlk yüklemede de uygula
  syncDropdown();
});


let audioContext, analyser, micStream, animationId;

function startMicTest() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      // Setup
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      const micSource = audioContext.createMediaStreamSource(stream);
      micSource.connect(analyser);
      micStream = stream;

      // UI Değişimi
      document.getElementById("start-mic-btn").style.display = "none";
      document.getElementById("stop-mic-btn").style.display = "inline-block";

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      function updateVisualizer() {
        analyser.getByteFrequencyData(dataArray);
        const volume = dataArray.reduce((a, b) => a + b) / bufferLength;
        const boostedVolume = volume * 2.5;
        const volumePercent = Math.min((boostedVolume / 256) * 100, 100);
        const bar = document.getElementById("mic-bar");
        bar.style.width = volumePercent + "%";

        if (volumePercent > 70) {
          bar.style.backgroundColor = "#ef4444";
        } else if (volumePercent > 40) {
          bar.style.backgroundColor = "#facc15";
        } else {
          bar.style.backgroundColor = "#10b981";
        }

        animationId = requestAnimationFrame(updateVisualizer);
      }

      updateVisualizer();
    })
    .catch(err => {
      alert("Mikrofona erişim reddedildi: " + err.message);
    });
}

function stopMicTest() {
  if (micStream) {
    micStream.getTracks().forEach(track => track.stop());
    micStream = null;
  }
  if (animationId) cancelAnimationFrame(animationId);
  if (audioContext) audioContext.close();

  document.getElementById("mic-bar").style.width = "0%";
  document.getElementById("start-mic-btn").style.display = "inline-block";
  document.getElementById("stop-mic-btn").style.display = "none";
}

<!-- Kapatma -->
const konusmaTab = document.getElementById("konusma");

const observer = new MutationObserver(() => {
  const isActive = konusmaTab.classList.contains("active");
  if (!isActive && micStream) {
    stopMicTest();
  }
});

observer.observe(konusmaTab, { attributes: true, attributeFilter: ["class"] });

const micTestCard = document.getElementById("mic-test-card");

const visibilityObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (!entry.isIntersecting && micStream) {
      stopMicTest(); // Kart görünmüyorsa mikrofonu kapat
    }
  });
}, {
  threshold: 0.01
});

visibilityObserver.observe(micTestCard);

window.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const incomingMessage = urlParams.get("msg");

  if (incomingMessage) {
    const input = document.getElementById("chat-input-textarea");
    const sendBtn = document.getElementById("send-btn");

    input.value = incomingMessage;

    // Mesajı bir kez gönder ve URL'den temizle
    setTimeout(() => {
      sendBtn.click();

      // msg parametresini URL'den temizle (yenileme sonrası tekrar tetiklenmesin)
      const newUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, newUrl);
    }, 300);
  }
});

  document.addEventListener("DOMContentLoaded", () => {
    const welcomeMessages = [
    "Nasıl yardımcı olabilirim?",
    "Birlikte çalışalım mı?",
    "Bugün ne yapalım?",
    "Hazır ve nazırım!",
    "Her zaman yanındayım!",
    "Hey, seni bekliyordum!"
    ];

    // localStorage'dan index al
    let currentIndex = parseInt(localStorage.getItem("quikWelcomeIndex")) || 0;

    // Mesajı yaz
    const welcomeEl = document.querySelector("#welcome-message h1");
    if (welcomeEl) {
      welcomeEl.textContent = welcomeMessages[currentIndex];

      // originalWelcomeHTML güncelle (senin koduna özel)
      window.originalWelcomeHTML = `
        <div class="logo-container"></div>
        <h1>${welcomeMessages[currentIndex]}</h1>
      `;
    }

    // Bir sonrakine geçmek için index güncelle
    currentIndex = (currentIndex + 1) % welcomeMessages.length;
    localStorage.setItem("quikWelcomeIndex", currentIndex.toString());
  });

document.addEventListener("DOMContentLoaded", () => {
  const topBarTitle = document.querySelector(".top-bar-title");
  const chatContainer = document.getElementById("chat-container");
  const welcomeMessage = document.getElementById("welcome-message");

  if (!topBarTitle) return;

  // Make the title appear clickable
  topBarTitle.style.cursor = "pointer";

  // Create the dropdown menu
  const menu = document.createElement("div");
  menu.className = "title-dropdown-menu";
  menu.style.cssText = `
    display: none;
    position: absolute;
    background-color: var(--input-bg);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    min-width: 150px;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 10px;
  `;

  // Add menu items
  menu.innerHTML = `
    <div class="title-menu-item favorite-title" style="border-radius: 12px;">
      <img src="icons/favorite_btn.png" alt="Favorile" style="width: 12px; height: 12px; margin-right: 8px;" />
      Favorilere Ekle
    </div>
    <div class="title-menu-item edit-title" style="border-radius: 12px;">
      <img src="icons/edit_btn.png" alt="Düzenle" style="width: 12px; height: 12px; margin-right: 8px;" />
      Düzenle
    </div>
<div class="title-menu-item delete-title" style="border-radius: 12px; color: red;">
  <img src="icons/delete_btn.png" alt="Sil" 
       style="width: 12px; height: 12px; margin-right: 8px; filter: invert(21%) sepia(99%) saturate(7484%) hue-rotate(359deg) brightness(93%) contrast(119%);" />
  Sil
</div>
  `;

  // Add styles for menu items
  const style = document.createElement("style");
  style.textContent = `
    .title-menu-item {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: var(--text-color);
      font-size: 0.85rem;
    }
    .title-menu-item:hover {
      background-color: #c0c0c0;
    }
    body.dark .title-menu-item:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }
    body.dark .title-menu-item:hover img {
      filter: none;
    }
    body.dark .title-menu-item img {
      filter: brightness(0) invert(1);
    }
body.dark .chat-history-title img[src="icons/favorite_btn.png"] {
  filter: invert(1);
}

body.dark .chat-history-item.active .chat-history-title img[src="icons/favorite_btn.png"] {
  filter: none;
}

  `;
  document.head.appendChild(style);

  // Append the menu to the DOM
  topBarTitle.parentElement.appendChild(menu); // Attach to top-bar for better context

  // Toggle menu on title click
  topBarTitle.addEventListener("click", (e) => {
    e.stopPropagation();
    const isVisible = menu.style.display === "block";
    menu.style.display = isVisible ? "none" : "block";

    if (!isVisible) {
      const rect = topBarTitle.getBoundingClientRect();
      menu.style.top = rect.bottom + window.scrollY + "px";
    }
  });

  // Edit conversation title
menu.querySelector(".edit-title").addEventListener("click", (e) => {
  e.stopPropagation();
  menu.style.display = "none";

  if (!currentConversation) return;

  openEditModal();
});

  // Delete conversation
menu.querySelector(".delete-title").addEventListener("click", (e) => {
  e.stopPropagation();
  menu.style.display = "none";

  if (!currentConversation) return;

  openConfirmModal(() => {
    conversations = conversations.filter((c) => c.id !== currentConversation.id);
    if (currentConversation) {
      currentConversation = null;
      chatContainer.innerHTML = "";
      chatContainer.appendChild(welcomeMessage);
      welcomeMessage.style.display = "block";
      document.title = "quik";
      updateTopBarTitle();
    }
    saveConversations();
    renderChatHistory();
    updateChatCount();
    populateChatSummaryDropdown();
  }, "Bu sohbeti silmek istediğinize emin misiniz?");
});


  // Favorite conversation
menu.querySelector(".favorite-title").addEventListener("click", (e) => {
  e.stopPropagation();
  menu.style.display = "none";

  if (!currentConversation) return;

  currentConversation.favorite = !currentConversation.favorite;

  const toast = document.createElement("div");
  toast.className = "header-toast";
  toast.textContent = currentConversation.favorite
    ? "Başlık favorilere eklendi!"
    : "Başlık favorilerden çıkarıldı!";
  toast.style.backgroundColor = currentConversation.favorite
    ? "var(--text-color)"
    : "var(--text-color)";

  // .top-bar içine ekle → sidebar hareketleriyle beraber kayar
  document.querySelector(".top-bar").appendChild(toast);

  setTimeout(() => toast.remove(), 2000);

    saveConversations();
    renderChatHistory();
  });

  // Close menu when clicking outside
  document.addEventListener("click", (e) => {
    if (menu.style.display === "block" && !menu.contains(e.target) && !topBarTitle.contains(e.target)) {
      menu.style.display = "none";
    }
  });

  // Close menu on ESC key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && menu.style.display === "block") {
      menu.style.display = "none";
    }
  });
});

// Add this outside renderChatHistory, e.g., at the top of your script
document.addEventListener("click", (e) => {
  document.querySelectorAll(".dropdown-menu").forEach(menu => {
    if (!menu.closest(".chat-history-item").contains(e.target)) {
      menu.style.display = "none";
    }
  });
});



const allHelpButtons = document.querySelectorAll("#help-btn");
const helpDropdown = document.getElementById('help-dropdown');

// Her birine aynı tıklama görevini ata
allHelpButtons.forEach(button => {
    button.addEventListener('click', () => {
        // Yardım menüsünün görünürlüğünü tersine çevir
        const isVisible = helpDropdown.style.display === 'block';
        helpDropdown.style.display = isVisible ? 'none' : 'block';
    });
});
// Sayfaya tıklayınca menüyü kapat (dış tıklama)
document.addEventListener('click', (e) => {
  if (!helpBtn.contains(e.target) && !helpDropdown.contains(e.target)) {
    helpDropdown.style.display = 'none';
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    helpDropdown.style.display = 'none';
  }
});

function redirectToRegister(btnEl){
  btnEl.disabled = true;
  btnEl.textContent = "Yönlendiriliyor…";

  setTimeout(() => {
    // Yeni sekmeyi aç
    const basePath = location.href.substring(0, location.href.lastIndexOf("/"));
    window.open(`${basePath}/Quik_Kayit.html`, "_blank");

    // Aynı anda bu sekmede butonu eski hâline döndür
    btnEl.disabled = false;
    btnEl.textContent = "Oturum Aç";
  }, 1000);   // 1 sn “Yönlendiriliyor…” yazısı görünsün
}


let pendingAction = null;

function openConfirmModal(action, message = "Bu işlemi yapmak istediğinize emin misiniz?") {
  pendingAction = action;
  
  // Mesajı güncelle
  const messageElement = document.getElementById('confirm-message');
  if (messageElement) {
    messageElement.textContent = message;
  }

  document.getElementById('confirm-modal').style.display = 'block';
}

function confirmAction() {
  if (pendingAction) {
    pendingAction(); // Onaylanan işlemi çalıştır
    pendingAction = null;
  }
  closeConfirmModal();
}

function cancelAction() {
  pendingAction = null;
  closeConfirmModal();
}

function closeConfirmModal() {
  document.getElementById('confirm-modal').style.display = 'none';
}

// ESC ile modal kapatma
document.addEventListener("keydown", (e) => {
  const confirmModal = document.getElementById('confirm-modal');
  if (confirmModal.style.display === 'block') {
    if (e.key === "Escape") {
      e.preventDefault();
      e.stopPropagation();
      cancelAction();
    } else if (e.key === "Enter") {
      e.preventDefault();
      e.stopPropagation();
      confirmAction();
    }
  }
});


const confirmModal = document.getElementById('confirm-modal');
const modalContent = document.querySelector('#confirm-modal .modal-content');

// Sadece confirm modal açıkken çalışacak
confirmModal.addEventListener("click", function(event) {
  if (!modalContent.contains(event.target)) {
    cancelAction(); // Dışa tıkladıysan modalı kapat
  }
});

// Başlık düzenleme modalı için kontrol değişkeni
let pendingEdit = null;

// Başlık düzenleme modalını aç
    function openEditModal() {
      const input = document.getElementById('new-title-input');
      input.value = currentConversation?.title || "";
      document.getElementById('edit-modal').style.display = 'block';
      input.focus();
    }

// Başlığı onayla
function confirmEditTitle() {
  const input = document.getElementById('new-title-input');
  const newTitle = input.value.trim();
  const conversationIndex = document.getElementById('edit-modal').dataset.conversationIndex;
  
  if (newTitle !== "") {
    if (conversationIndex !== undefined) {
      // Dropdown’dan gelen düzenleme
      conversations[conversationIndex].title = newTitle;
    } else if (currentConversation) {
      // Top-bar-title’dan gelen düzenleme
      currentConversation.title = newTitle;
    }
    saveConversations();
    renderChatHistory();
    populateChatSummaryDropdown();
    if (currentConversation && !isMainPage()) {
      document.title = currentConversation.title || "quik";
      updateTopBarTitle();
    } else {
      document.title = "quik";
    }
  }
  delete document.getElementById('edit-modal').dataset.conversationIndex; // Temizlik
  closeEditModal();
}

// İptal et (kapat)
function cancelEditTitle() {
  closeEditModal();
}

// Modalı kapat
function closeEditModal() {
  document.getElementById('edit-modal').style.display = 'none';
}

// ESC ile düzenleme modalı kapatma
document.addEventListener("keydown", (e) => {
  const editModal = document.getElementById('edit-modal');
  const newTitleInput = document.getElementById('new-title-input');

  if (editModal.style.display === 'block') {
    // Eğer odak input'taysa, klavye engellenmesin
    if (document.activeElement === newTitleInput) {
      if (e.key === "Escape") {
        e.preventDefault();
        e.stopPropagation();
        cancelEditTitle();
      }
      // Input içindeyken Enter'a basarsan zaten input'un kendi event'ı çalışıyor (ayrı eklemiştik)
      return;
    }

    // Eğer odak input dışında bir yerdeyse:
    if (e.key === "Escape") {
      e.preventDefault();
      e.stopPropagation();
      cancelEditTitle();
    } else if (e.key === "Enter") {
      e.preventDefault();
      e.stopPropagation();
      confirmEditTitle();
    } else {
      e.preventDefault();
      e.stopPropagation();
    }
  }
});


// Dışarı tıklayınca düzenleme modalı kapatma
const editModal = document.getElementById('edit-modal');
const editModalContent = document.querySelector('#edit-modal .modal-content');

editModal.addEventListener("mousedown", function(event) {
  if (event.target === editModal) {
    cancelEditTitle();
  }
});


const newTitleInput = document.getElementById('new-title-input');

newTitleInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault(); // Form submit vs. olmasın
    confirmEditTitle();  // Tamam butonu çalıştır
  }
});

function saveLastConversationId(id) {
  if (id)  sessionStorage.setItem("lastConversationId", id);
  else     sessionStorage.removeItem("lastConversationId");
}

const savedId = sessionStorage.getItem("lastConversationId");


if (savedId) {
  const savedConv = conversations.find(c => c.id == savedId);
  if (savedConv) {
    currentConversation = savedConv;
    welcomeMessage.style.display = "none";
    renderChat();
    updateTopBarTitle();
    document.title = currentConversation.title || "quik";
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const master = document.getElementById('toggle-all-notifications');
  if (!master) return;                       // master yoksa çık

  const slavesSel =
    '#bildirimler .notification-card input[type="checkbox"]:not(#toggle-all-notifications)';

  const slaves = () => Array.from(document.querySelectorAll(slavesSel));

  /* Alt anahtarlar → master’ı güncelle */
  const syncMaster = () => {
    master.checked = slaves().every(cb => cb.checked);
  };
  slaves().forEach(cb => cb.addEventListener('change', syncMaster));

  /* Master → tümünü tek hamlede aç/kapa */
  master.addEventListener('change', () => {
    const target = master.checked;            // ***SABİTLE***
    const list   = slaves();

    list.forEach(cb => (cb.checked = target));                         // görünümü ayarla
    list.forEach(cb => cb.dispatchEvent(new Event('change', { bubbles: true }))); // olayları tetikle
    master.checked = target;                // master’ı sabit tut
  });

  /* İlk yüklemede doğru durum */
  syncMaster();
});

const archiveAllChatsBtn = document.getElementById("archive-all-chats");

archiveAllChatsBtn.addEventListener("click", () => {
  openConfirmModal(() => {
    // TODO: move conversations to an “archive” store instead of deleting
    console.log("Tüm sohbetler arşivlendi.");
  }, "Bütün sohbetleri arşivlemek istediğinizden emin misiniz?");
});



document.addEventListener('DOMContentLoaded', () => {
  const chatInput   = document.querySelector('.chat-input');
  const WELCOME_ID  = 'welcome-message';
  if (!chatInput) return;

  /* Welcome gerçekten görünür mü? */
  const isWelcomeVisible = () => {
    const el = document.getElementById(WELCOME_ID);
    if (!el) return false;
    const cs = getComputedStyle(el);
    return cs.display !== 'none' && cs.visibility !== 'hidden' &&
           (el.offsetHeight || el.offsetWidth);
  };

  /* ---- Konumu ayarla (mobil sabit 0 px) ---- */
  function placeInput() {
    /* ➊ Mobilde HER ZAMAN 0 px */
    if (window.innerWidth <= 768) {
      chatInput.style.bottom = '0px';
      return;                             // diğer mantık çalışmaz
    }

    /* ➋ Masaüstü/tablet: welcome varsa 10 px altına, yoksa 20 px */
    if (isWelcomeVisible()) {
      const rect = document.getElementById(WELCOME_ID).getBoundingClientRect();
      const dist = window.innerHeight - (rect.bottom + 150);
      chatInput.style.bottom = Math.max(dist, 0) + 'px';
    } else {
      chatInput.style.bottom = '20px';
    }
  }

  /* İlk boyama + tüm tetikleyiciler */
  placeInput();
  const obs = new MutationObserver(placeInput);
  obs.observe(document.body, {
    childList:true, subtree:true,
    attributes:true, attributeFilter:['style','class']
  });
  ['sidebar-brand','new-chat-btn'].forEach(id=>{
    document.getElementById(id)?.addEventListener('click',
      ()=>setTimeout(placeInput,0), {passive:true});
  });
  window.addEventListener('resize', placeInput);
});

/* ---------- Mini drop ---------- */
(() => {
  const dropBtn   = document.getElementById('mini-drop-btn');
  const dropdown  = document.getElementById('mini-dropdown');
  if (!dropBtn || !dropdown) return;

  /* Aç / kapa */
  dropBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown.style.display = dropdown.style.display === 'flex' ? 'none' : 'flex';
  });

  /* Pencereye tıklayınca kapat */
  window.addEventListener('click', () => dropdown.style.display = 'none');

  /* Ekran genişliği 337 px’i geçtiğinde otomatik kapat */
  const mq = matchMedia('(min-width: 338px)');
  mq.addEventListener('change', () => {
    if (mq.matches) dropdown.style.display = 'none';
  });

  /* pencereye tıklanınca kapat */
  window.addEventListener('click', () => dropdown.style.display = 'none');

  /* alt butonları eski fonksiyonlara bağla */
  document.getElementById('mini-file') ?.addEventListener('click', () =>
       document.getElementById('file-upload-btn')?.click());

  document.getElementById('mini-web')  ?.addEventListener('click', () =>
       document.getElementById('web-search-btn')?.click());
})();

    // 1. Kriptografik, uzun ve collision-free ID üretimi
    function generateStrongUUID(length = 40) {
      const array = new Uint8Array(length);
      window.crypto.getRandomValues(array);
      return Array.from(array, dec => ('0' + dec.toString(16)).slice(-2)).join('');
    }

    // 2. URL’i home veya chatid parametresiyle güncelleyen yardımcılar
    function goToHome() {
      history.replaceState(null, '', window.location.pathname + '?home');
    }
    function goToChat(chatid) {
      history.replaceState(null, '', window.location.pathname + '?chatid=' + chatid);
    }

    // 3. Sidebar-logo veya 'Yeni Sohbet' butonuna tıklandığında home’a yönlendir
    sidebarBrand.addEventListener('click', () => {
      goToHome();
    });
    newChatBtn.addEventListener('click', () => {
      goToHome();
    });

// ——— Sayfa ilk yüklendiğinde URL’den sohbeti yükle ———
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  if (params.has('chatid')) {
    const chatid = params.get('chatid');
    const conv = conversations.find(c => c.id === chatid);
    if (conv) {
      currentConversation = conv;
      renderChatHistory();
      renderChat();
      updateTopBarTitle();
      return;              // sohbet bulundu; anasayfaya düşme
    }
  }
  // chatid yok veya geçersizse anasayfa
  goToHome();
});

document.addEventListener("DOMContentLoaded", () => {
  const pageDownBtn = document.getElementById("page-down-btn");
  const scrollWrapper = document.querySelector(".scroll-wrapper");
  
  // Eğer gerekli elementler yoksa çık
  if (!pageDownBtn || !scrollWrapper) {
    console.warn("Page down button veya scroll wrapper bulunamadı");
    return;
  }

  let isScrollable = false;
  let ticking = false;

  // Scroll edilebilirlik kontrolü
  function checkScrollability() {
    const hasOverflow = scrollWrapper.scrollHeight > scrollWrapper.clientHeight;
    const computedStyle = window.getComputedStyle(scrollWrapper);
    const overflowY = computedStyle.overflowY;
    
    isScrollable = hasOverflow && (overflowY === 'scroll' || overflowY === 'auto');
    
    // Eğer scroll edilemiyorsa butonu kesinlikle gizle
    if (!isScrollable) {
      pageDownBtn.classList.remove("visible");
      return false;
    }
    return true;
  }

  // Scroll pozisyonu kontrolü
  function checkScrollPosition() {
    if (!isScrollable) return;
    
    const scrollTop = Math.ceil(scrollWrapper.scrollTop);
    const scrollHeight = scrollWrapper.scrollHeight;
    const clientHeight = scrollWrapper.clientHeight;
    const maxScrollTop = scrollHeight - clientHeight;
    
    // Alt kısımdan ne kadar uzaktayız (tolerance ile)
    const fromBottom = maxScrollTop - scrollTop;
    const threshold = 20;
    
    // Debug için (geliştirme sırasında kullanabilirsin)
    // console.log({ scrollTop, scrollHeight, clientHeight, maxScrollTop, fromBottom });
    
    if (fromBottom > threshold && maxScrollTop > 0) {
      pageDownBtn.classList.add("visible");
    } else {
      pageDownBtn.classList.remove("visible");
    }
  }

  // Throttled scroll handler
  function handleScroll() {
    if (!ticking) {
      requestAnimationFrame(() => {
        if (checkScrollability()) {
          checkScrollPosition();
        }
        ticking = false;
      });
      ticking = true;
    }
  }

  // Resize handler - içerik boyutu değişebilir
  function handleResize() {
    setTimeout(() => {
      if (checkScrollability()) {
        checkScrollPosition();
      }
    }, 100);
  }

  // Content change observer - dinamik içerik için
  const observer = new MutationObserver(() => {
    setTimeout(() => {
      if (checkScrollability()) {
        checkScrollPosition();
      }
    }, 50);
  });

  // Scroll listener
  scrollWrapper.addEventListener("scroll", handleScroll, { passive: true });
  
  // Resize listener
  window.addEventListener("resize", handleResize);
  
  // İçerik değişikliklerini izle
  observer.observe(scrollWrapper, {
    childList: true,
    subtree: true,
    attributes: false
  });

  // Button click handler
  pageDownBtn.addEventListener("click", () => {
    if (!isScrollable) return;
    
    scrollWrapper.scrollTo({ 
      top: scrollWrapper.scrollHeight, 
      behavior: "smooth" 
    });
    
    // Scroll tamamlandıktan sonra butonu gizle
    setTimeout(() => {
      pageDownBtn.classList.remove("visible");
    }, 300);
  });

  // İlk kontrol
  setTimeout(() => {
    if (checkScrollability()) {
      checkScrollPosition();
    }
  }, 100);

  // Cleanup function (gerekirse kullan)
  window.pageDownCleanup = () => {
    scrollWrapper.removeEventListener("scroll", handleScroll);
    window.removeEventListener("resize", handleResize);
    observer.disconnect();
  };
});

// Modalleri açan event listener’lar
document.getElementById('terms-btn').addEventListener('click', () => {
  document.getElementById('terms-modal').style.display = 'block';
});
document.getElementById('privacy-btn').addEventListener('click', () => {
  document.getElementById('privacy-modal').style.display = 'block';
});

// Kapatma butonları
document.querySelectorAll('#terms-modal .settings-close, #privacy-modal .settings-close')
  .forEach(btn => {
    btn.addEventListener('click', () => {
      btn.closest('.modal').style.display = 'none';
    });
  });

// Modal dışına tıklayınca kapatma
['terms-modal', 'privacy-modal'].forEach(id => {
  const modal = document.getElementById(id);
  let isDown = false;
  modal.addEventListener('mousedown', e => {
    isDown = (e.target === modal);
  });
  modal.addEventListener('mouseup', e => {
    if (isDown && e.target === modal) {
      modal.style.display = 'none';
    }
    isDown = false;
  });
});

// Blur ve modal kontrolünde kullanılacak elementlerin ID’leri
const blurTargets = [
  'settings-btn',      // Ayarlar ikonu
  'sidebar-search-toggle', // Sohbet ara ikonu
  'toggle-sidebar-btn',    // Sidebar toggle
  'help-btn',          // Yardım ikonu
  'new-chat-btn'       // Yeni sohbet ikonu
];

// Modal açma fonksiyonu
function openModal(modalId) {
  // 1) Açılır menüyü kapat
  const helpDropdown = document.getElementById('help-dropdown');
  if (helpDropdown) {
    // Eğer toggle’la display kontrol ediyorsan:
    helpDropdown.style.display = 'none';
    // Veya classTabanlıysa:
    // helpDropdown.classList.remove('open');
  }

  // 2) Modal’ı göster ve arkayı blur’la
  const modal = document.getElementById(modalId);
  modal.style.display = 'block';
  blurTargets.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.add('blurred');
  });
  document.querySelector('.chat-input').classList.add('blurred');

  // 3) Textarea’yı disable et
  chatInput.disabled = true;
  chatInput.blur();
}


// Modal kapama fonksiyonu
function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.style.display = 'none';
  blurTargets.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('blurred');
  });
  document.querySelector('.chat-input').classList.remove('blurred');

  // 3) Textarea’yı tekrar enable et
  chatInput.disabled = false;
}

// Butonlara tıklama olaylarını bağla
document.getElementById('terms-btn').addEventListener('click', () => openModal('terms-modal'));
document.getElementById('privacy-btn').addEventListener('click', () => openModal('privacy-modal'));

// Her modal’ın kendi “×” kapatma butonuna tıklayınca kapat
document.querySelectorAll('#terms-modal .settings-close, #privacy-modal .settings-close')
  .forEach(btn => {
    btn.addEventListener('click', () => {
      const modal = btn.closest('.modal');
      closeModal(modal.id);
    });
  });

// Backdrop’a tıklayınca kapat (mousedown→mouseup kontrolü)
['terms-modal','privacy-modal'].forEach(id => {
  const mdl = document.getElementById(id);
  let downOnBackdrop = false;
  mdl.addEventListener('mousedown', e => { downOnBackdrop = (e.target === mdl); });
  mdl.addEventListener('mouseup', e => {
    if (downOnBackdrop && e.target === mdl) closeModal(id);
    downOnBackdrop = false;
  });
});

// ESC ile kapatma ve yazı girişini engelleme
window.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    ['terms-modal','privacy-modal'].forEach(id => {
      const m = document.getElementById(id);
      if (m.style.display === 'block') {
        closeModal(id);
        e.preventDefault();
        e.stopPropagation();
      }
    });
  }
});

// Chat-input’a yazmayı engellemek için, modal açıkken input’un default davranışını iptal edelim
chatInput.addEventListener('keydown', e => {
  if (document.querySelector('.modal[style*="display: block"]')) {
    e.preventDefault();
    e.stopPropagation();
  }
});

chatInput.addEventListener('focus', e => {
  if (chatInput.disabled) e.target.blur();
});



document.addEventListener('DOMContentLoaded', () => {
  const helpBtn = document.getElementById('excusive-help-btn');
  const dropdown = document.getElementById('help-dropdown');

  if (!helpBtn) {
    console.error('Yardım butonu bulunamadı: excusive-help-btn');
    return;
  }
  if (!dropdown) {
    console.error('Dropdown bulunamadı: help-dropdown');
    return;
  }

  helpBtn.addEventListener('click', () => {
    // 1) Dropdown’ı kapat
    dropdown.style.display = 'none';

    // 2) Yeni sekmeyi aç
    const basePath = window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '');
    const msg = document.getElementById('chat-input-textarea')?.value || '';
    const encodedMsg = encodeURIComponent(msg);
    window.open(`${basePath}/Quik_Help.html?msg=${encodedMsg}`, '_blank');
  });
});



document.addEventListener("keydown",(e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==="a"){
    /* Odak herhangi bir INPUT / TEXTAREA / contentEditable alandaysa
       varsayılan seçimin (Ctrl+A) çalışmasına izin ver. */
    if(
      e.target.tagName==="INPUT" ||
      e.target.tagName==="TEXTAREA" ||
      e.target.isContentEditable
    ){ return; }

    /* Odak başka yerdeyse sohbeti seç */
    e.preventDefault();
    const chat=document.getElementById("chat-container");
    const sel = window.getSelection();
    sel.removeAllRanges();
    const range=document.createRange();
    range.selectNodeContents(chat);
    sel.addRange(range);
  }
});

document.addEventListener('copy', (e) => {
  const chat = document.getElementById('chat-container');
  const sel  = window.getSelection();
  // Sadece sohbet bölgesindeyse müdahale et
  if (!sel.isCollapsed && chat.contains(sel.anchorNode)) {
    e.preventDefault();
    // Seçili içeriğin klonunu çıkar
    const container = document.createElement('div');
    for (let i = 0; i < sel.rangeCount; i++) {
      container.appendChild(sel.getRangeAt(i).cloneContents());
    }
    // .copy-btn ve içindekileri çıkar
    container.querySelectorAll('.copy-btn, .copy-btn, .code-header *').forEach(el => el.remove());
    // Düzeltilmiş içeriği clipboard’a koy
    e.clipboardData.setData('text/html',  container.innerHTML);
    e.clipboardData.setData('text/plain', container.textContent);
  }
});

// --- Modal setup: DOM hazır olduktan sonra başlat ---
document.addEventListener("DOMContentLoaded", () => {
  const modal      = document.getElementById("image-modal");
  const modalImg   = document.getElementById("modal-img");
  const modalClose = document.querySelector(".modal-close");

  // Kapatma ikonu
  modalClose.addEventListener("click", () => modal.style.display = "none");

  // Modal dışına tıklayınca da kapansın
  modal.addEventListener("click", e => {
    if (e.target === modal) modal.style.display = "none";
  });

  // Lightbox dinleyicilerini ekleyen fonksiyon
  function enableImageModal() {
    document.querySelectorAll(".attachment-img").forEach(img => {
      // Önce eskisini temizle
      if (img._modalHandler) img.removeEventListener("click", img._modalHandler);

      // Yeni handler
      img._modalHandler = function() {
        modalImg.src = this.src;
        modal.style.display = "block";
      };
      img.addEventListener("click", img._modalHandler);
    });
  }

  // İlk yüklenen geçmiş ve yeni balonlar için çağır
  enableImageModal();

  // Global olarak erişilebilir olsun ki appendMessageBubble’dan da çağırabilelim
  window.enableImageModal = enableImageModal;

 // --- ESC ile de modal’ı kapat ---
 document.addEventListener("keydown", e => {
   if (e.key === "Escape" && modal.style.display !== "none") {
     modal.style.display = "none";
   }
});
});


document.body.addEventListener("click", (e) => {
  if (e.target.classList.contains("modal-close")) {
    console.log("Modal kapatıldı!");
    const modal = document.getElementById("image-modal");
    modal.style.display = "none";
  }
});

// <script> bölümünün başında bir kere çağır
document.querySelectorAll('pre code').forEach(code => {
  if (![...code.classList].some(c => c.startsWith('language-'))) {
    code.classList.add('language-plaintext');
  }
});



// Hatayı görmezden gelelim (For now)
hljs.configure({ ignoreUnescapedHTML: true });








// ARAMA BUTONU İÇİN TAM VE HATASIZ ÇÖZÜM
// Bu bloğu kopyalayıp mevcut <script> etiketinin en altına yapıştırman yeterli.
document.addEventListener("DOMContentLoaded", () => {
    
    // ID'si "sidebar-search-toggle" olan TÜM butonları buluyoruz.
    const searchButtons = document.querySelectorAll("#sidebar-search-toggle");

    // Eğer hiç buton bulunamazsa, hatayı konsola yaz ve işlemi durdur.
    if (searchButtons.length === 0) {
        console.error("ID'si 'sidebar-search-toggle' olan bir buton bulunamadı.");
        return;
    }

    // Bulunan her bir butona tıklama görevi atıyoruz.
    searchButtons.forEach(button => {
        button.addEventListener("click", (e) => {
            e.stopPropagation(); // Diğer tıklama olaylarını engelle

            // Önce diğer açık pencereleri (varsa) kapatalım
            const helpDropdown = document.getElementById('help-dropdown');
            if (helpDropdown) {
                helpDropdown.style.display = 'none';
            }

            // Ayarlar penceresi açıksa hiçbir şey yapma
            const settingsModal = document.getElementById("settings-modal");
            if (settingsModal && settingsModal.style.display === "block") {
                return;
            }

            // Arama penceresini aç
            const chatSearchModal = document.getElementById("chat-search-modal");
            if (chatSearchModal) {
                chatSearchModal.style.display = "block";
                // Arama input'una odaklan
                const searchInput = document.getElementById("chat-search-input");
                if (searchInput) {
                    searchInput.focus();
                }
            }

            // İkonları bulanıklaştır (eğer elementler varsa)
            const settingsBtn = document.getElementById("settings-btn");
            const toggleBtn = document.getElementById("toggle-sidebar-btn");
            const newChatBtn = document.querySelector(".new-chat-btn");

            if(settingsBtn) settingsBtn.classList.add("blurred");
            if(toggleBtn) toggleBtn.classList.add("blurred");
            if(newChatBtn) newChatBtn.classList.add("blurred");
            

        });
    });
});






// --- YENİ BAĞIMSIZ BUTON TAŞIMA YÖNETİCİSİ ---
// Bu kod, diğer fonksiyonlardan tamamen ayrı çalışır.

document.addEventListener("DOMContentLoaded", () => {

    // 1. Taşınacak butonları ve yuvalarını seçelim.
    const newChatBtn = document.getElementById("new-chat-btn");
    const helpBtn = document.getElementById("help-btn");
    const settingsBtn = document.getElementById("settings-btn");
    
    const tinySidebar = document.getElementById("tiny-sidebar");
    const sidebarHeader = document.querySelector(".sidebar-header");
    const sidebarEnder = document.querySelector(".sidebar-ender");

    // Elementler bulunamazsa hatayı engelle
    if (!newChatBtn || !helpBtn || !settingsBtn || !tinySidebar || !sidebarHeader || !sidebarEnder) {
        console.error("Taşınacak butonlar veya yuvaları HTML'de bulunamadı.");
        return;
    }

    // 2. Butonları doğru yere taşıyan bir fonksiyon tanımlayalım.
    const moveButtons = () => {
        // Eğer sidebar açıksa (body'de 'sidebar-open' class'ı varsa)
        if (document.body.classList.contains('sidebar-open')) {
            // Butonları geniş sidebar'daki yerlerine taşı
            sidebarHeader.appendChild(newChatBtn);
            sidebarEnder.appendChild(helpBtn);
            sidebarEnder.appendChild(settingsBtn);
        } else {
            // Değilse, tüm butonları dar tiny-sidebar'a geri taşı
            tinySidebar.appendChild(newChatBtn);
            tinySidebar.appendChild(helpBtn);
            tinySidebar.appendChild(settingsBtn);
        }
    };

    // 3. Body etiketindeki class değişikliklerini izleyen bir "casus" (MutationObserver) oluşturalım.
    const observer = new MutationObserver((mutationsList) => {
        for (const mutation of mutationsList) {
            // Sadece 'class' attribute'u değiştiğinde ilgileniyoruz.
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Class her değiştiğinde, butonları doğru yere taşıyan fonksiyonumuzu çağır.
                moveButtons();
            }
        }
    });

    // 4. Casusu, body etiketini izlemesi için görevlendirelim.
    observer.observe(document.body, { attributes: true });

    // 5. Sayfa ilk yüklendiğinde de butonların doğru yerde olduğundan emin olalım.
    moveButtons();
});







(function () {
  if (window.__sidebarSearchRelocatorInstalled) return;
  window.__sidebarSearchRelocatorInstalled = true;

  const BTN_ID   = 'sidebar-search-toggle';
  const SIDEBAR_ID = 'sidebar';
  const TINY_ID    = 'tiny-sidebar';
  const Z = 305;

  const $ = (id) => document.getElementById(id);

  let lastOpen = null;
  let placing  = false;
  let raf      = 0;

  function scheduleSync() {
    if (raf) return;
    raf = requestAnimationFrame(() => { raf = 0; sync(); });
  }

  function place(isOpen) {
    const btn  = $(BTN_ID);
    const side = $(SIDEBAR_ID);
    const tiny = $(TINY_ID);
    if (!btn) return;
    if (isOpen && !side) return;
    if (!isOpen && !tiny) return;
    if (placing) return;
    placing = true;

    const prevTransition = btn.style.transition;
    btn.style.transition = 'none';

    const target = isOpen ? side : tiny;
    if (target && btn.parentElement !== target) target.appendChild(btn);

    btn.classList.toggle('icon-only', !isOpen);

    // Kurşun geçirmez: her konteynerde konum/click garantisi
    btn.style.zIndex   = String(Z);
    btn.style.position = 'absolute';

    // Jank/flicker yok
    void btn.offsetHeight;
    requestAnimationFrame(() => {
      btn.style.transition = prevTransition || '';
      placing = false;
    });
  }

  function sync() {
    const isOpen = document.body.classList.contains('sidebar-open');

    // State değişmediyse ama yanlış kapta ise düzelt
    const btn = $(BTN_ID);
    if (isOpen === lastOpen) {
      if (btn) {
        const want = isOpen ? SIDEBAR_ID : TINY_ID;
        if (btn.parentElement?.id !== want) place(isOpen);
      }
      return;
    }
    lastOpen = isOpen;
    place(isOpen);
  }

  // İlk senkron
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', sync, { once: true });
  } else {
    sync();
  }
  window.addEventListener('load', scheduleSync);

  // body class değişimlerini tek frame'de topla
  new MutationObserver(() => scheduleSync())
    .observe(document.body, { attributes: true, attributeFilter: ['class'] });

  // Buton/kaplar sonradan gelirse yakala
  new MutationObserver((mutations) => {
    for (const m of mutations) {
      if (m.type !== 'childList') continue;
      for (const n of m.addedNodes) {
        if (!(n instanceof HTMLElement)) continue;
        if (
          n.id === BTN_ID || n.id === SIDEBAR_ID || n.id === TINY_ID ||
          n.querySelector?.(`#${BTN_ID}, #${SIDEBAR_ID}, #${TINY_ID}`)
        ) { scheduleSync(); return; }
      }
    }
  }).observe(document.body, { childList: true, subtree: true });
})();

  </script>
</body>
</html>
